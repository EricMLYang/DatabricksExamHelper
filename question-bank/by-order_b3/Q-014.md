# Question #014

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-014`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
Which of the following statements regarding cloning tables on Databricks is correct?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** Changes made to either deep or shallow clones affect the source table.
- **B.** Any changes made to shallow clones affect only the clones themselves and not the source table. While, changes made to deep clones affect the source table.
- **C.** Any changes made to either deep or shallow clones affect only the clones themselves and not the source table.
- **D.** Any changes made to deep clones affect only the clones themselves and not the source table. While, changes made to shallow clones affect the source table.

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Delta-Lake`, `Delta-Utility`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`, `Logical-Trap`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Data Architecture

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `C`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** C
- **ç¤¾ç¾¤å…±è­˜:** C

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Delta Lake Clone
**é—œéµæ¦‚å¿µ:** Deep Clone vs Shallow Cloneã€è³‡æ–™ç¨ç«‹æ€§
**é¡Œç›®é—œéµå­—ï¼š**
- **cloning tables**: è¡¨æ ¼å…‹éš†
- **deep or shallow clones**: æ·±æ·ºå…‹éš†
- **affect the source table**: å½±éŸ¿ä¾†æºè¡¨

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ C æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**ç„¡è«– Deep Clone æˆ– Shallow Cloneï¼Œå°å…‹éš†çš„ä¿®æ”¹éƒ½ä¸æœƒå½±éŸ¿ä¾†æºè¡¨ã€‚**

#### Clone çš„è³‡æ–™ç¨ç«‹æ€§
```
é—œéµæ¦‚å¿µï¼šClone å¾Œçš„è¡¨æ˜¯ç¨ç«‹çš„ï¼

ä¾†æºè¡¨ (source)        å…‹éš†è¡¨ (clone)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åŸå§‹è³‡æ–™    â”‚      â”‚   ç¨ç«‹å‰¯æœ¬    â”‚
â”‚  (ä¸å—å½±éŸ¿)   â”‚  â†’   â”‚  (ç¨ç«‹è¿½è¹¤)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                      ä¿®æ”¹åªå½±éŸ¿å…‹éš†è¡¨
```

#### Deep Clone vs Shallow Clone
| ç‰¹æ€§ | Deep Clone | Shallow Clone |
|------|------------|---------------|
| **è³‡æ–™è¤‡è£½** | è¤‡è£½å¯¦éš›è³‡æ–™æª”æ¡ˆ | åªè¤‡è£½ metadata |
| **å„²å­˜ç©ºé–“** | éœ€è¦é¡å¤–ç©ºé–“ | å¹¾ä¹ä¸éœ€è¦ |
| **ä¿®æ”¹å½±éŸ¿ä¾†æº** | âŒ ä¸å½±éŸ¿ | âŒ ä¸å½±éŸ¿ |
| **ç¨ç«‹æ€§** | å®Œå…¨ç¨ç«‹ | å®Œå…¨ç¨ç«‹ |

#### å…‹éš†èªæ³•
```sql
-- Deep Cloneï¼šè¤‡è£½è³‡æ–™å’Œ metadata
CREATE TABLE my_clone DEEP CLONE source_table;

-- Shallow Cloneï¼šåªè¤‡è£½ metadataï¼ˆåƒç…§åŸå§‹è³‡æ–™æª”æ¡ˆï¼‰
CREATE TABLE my_clone SHALLOW CLONE source_table;

-- å°å…‹éš†è¡¨çš„ä¿®æ”¹
INSERT INTO my_clone VALUES (1, 'new');
UPDATE my_clone SET col = 'updated';
DELETE FROM my_clone WHERE id = 1;

-- ä»¥ä¸Šä¿®æ”¹éƒ½ä¸æœƒå½±éŸ¿ source_tableï¼
```

#### ä¿®æ”¹è¿½è¹¤æ©Ÿåˆ¶
```
Shallow Clone ä¿®æ”¹åŸç†ï¼š

åˆå§‹ç‹€æ…‹ï¼š
â”œâ”€â”€ source_table â†’ file_001.parquet, file_002.parquet
â””â”€â”€ clone_table â†’ (åƒç…§) file_001.parquet, file_002.parquet

ä¿®æ”¹ clone_table å¾Œï¼š
â”œâ”€â”€ source_table â†’ file_001.parquet, file_002.parquetï¼ˆä¸è®Šï¼‰
â””â”€â”€ clone_table â†’ file_001.parquet, file_003.parquetï¼ˆæ–°å¢æª”æ¡ˆï¼‰

Delta Log ç¨ç«‹è¿½è¹¤ï¼Œä¸æœƒäº’ç›¸å½±éŸ¿ï¼
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A. Changes made to either deep or shallow clones affect the source table
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **å®Œå…¨éŒ¯èª¤**
- å…©ç¨®å…‹éš†çš„ä¿®æ”¹éƒ½ä¸æœƒå½±éŸ¿ä¾†æºè¡¨
- Clone å¾Œçš„è¡¨æ˜¯å®Œå…¨ç¨ç«‹çš„

### B. Shallow clones ä¸å½±éŸ¿ï¼ŒDeep clones å½±éŸ¿
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **é‚è¼¯é¡›å€’**
- Deep Clone è¤‡è£½äº†è³‡æ–™ï¼Œæ›´ä¸å¯èƒ½å½±éŸ¿ä¾†æº
- é€™å€‹é¸é …å®Œå…¨éŒ¯èª¤

### D. Deep clones ä¸å½±éŸ¿ï¼ŒShallow clones å½±éŸ¿
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **å¸¸è¦‹èª¤è§£**
- å¾ˆå¤šäººèª¤ä»¥ç‚º Shallow Clone å› ç‚ºå…±äº«è³‡æ–™æª”æ¡ˆï¼Œä¿®æ”¹æœƒå½±éŸ¿ä¾†æº
- ä½†å¯¦éš›ä¸Š **Delta Log æ˜¯ç¨ç«‹çš„**ï¼Œä¿®æ”¹æœƒç”¢ç”Ÿæ–°æª”æ¡ˆ
- Shallow Clone çš„ä¿®æ”¹ä¹Ÿä¸æœƒå½±éŸ¿ä¾†æºè¡¨

```
èª¤è§£ä¾†æºï¼š
â”œâ”€â”€ Shallow Clone å…±äº«åº•å±¤è³‡æ–™æª”æ¡ˆ
â”œâ”€â”€ ä½† Delta Transaction Log æ˜¯ç¨ç«‹çš„
â”œâ”€â”€ ä¿®æ”¹æœƒç”¢ç”Ÿæ–°çš„è³‡æ–™æª”æ¡ˆï¼ˆcopy-on-writeï¼‰
â””â”€â”€ åŸå§‹æª”æ¡ˆä¸æœƒè¢«æ”¹è®Š
```

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€ŒClone éƒ½ç¨ç«‹ï¼Œä¿®æ”¹ä¸å›å‚³ã€**

### Clone æ¯”è¼ƒåœ–
```
Deep Cloneï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ source_tableâ”‚     â”‚ clone_table â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è³‡æ–™æª”æ¡ˆ A  â”‚     â”‚ è³‡æ–™æª”æ¡ˆ A' â”‚  â† è¤‡è£½ä¸€ä»½
â”‚ è³‡æ–™æª”æ¡ˆ B  â”‚     â”‚ è³‡æ–™æª”æ¡ˆ B' â”‚
â”‚ Delta Log   â”‚     â”‚ Delta Log   â”‚  â† ç¨ç«‹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Shallow Cloneï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ source_tableâ”‚     â”‚ clone_table â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è³‡æ–™æª”æ¡ˆ A â†â”€â”€â”€â”€â”€â”€â”€â”€ åƒç…§        â”‚
â”‚ è³‡æ–™æª”æ¡ˆ B â†â”€â”€â”€â”€â”€â”€â”€â”€ åƒç…§        â”‚
â”‚ Delta Log   â”‚     â”‚ Delta Log   â”‚  â† ç¨ç«‹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Clone ä½¿ç”¨å ´æ™¯
| å ´æ™¯ | å»ºè­°é¡å‹ |
|------|----------|
| ç”Ÿç”¢è³‡æ–™å‚™ä»½ | Deep Clone |
| é–‹ç™¼æ¸¬è©¦ç’°å¢ƒ | Shallow Clone |
| è³‡æ–™ç‰ˆæœ¬å¿«ç…§ | Deep Clone |
| å¿«é€Ÿå»ºç«‹æ¸¬è©¦è¡¨ | Shallow Clone |

### è¨˜æ†¶é‡é»
```
é—œéµè¨˜æ†¶ï¼š
â”œâ”€â”€ Clone å¾Œçš„è¡¨æ˜¯ç¨ç«‹çš„
â”œâ”€â”€ ç„¡è«– Deep æˆ– Shallow
â”œâ”€â”€ ä¿®æ”¹å…‹éš†è¡¨ â‰  ä¿®æ”¹ä¾†æºè¡¨
â””â”€â”€ Delta Log ä¿è­‰è³‡æ–™ç¨ç«‹æ€§
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Clone a Delta Lake table](https://docs.databricks.com/delta/clone.html)
- [Deep Clone vs Shallow Clone](https://docs.databricks.com/delta/clone.html#deep-clone-vs-shallow-clone)
- [Delta Lake Clone Semantics](https://docs.delta.io/latest/delta-utility.html#clone-a-delta-table)

---

**[è¿”å›é¡Œç›®](#question-014)**
