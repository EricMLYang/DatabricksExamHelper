# Question #013

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-013`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
A data engineering team at a supply chain company uses Lakeflow Declarative Pipelines to manage inventory data. The team maintains an append-only streaming table, inventory_raw, that stores raw inventory status information, with columns: product_id, quantity, and event_timestamp.

A data engineer is tasked with creating a new table, inventory_latest, to capture near real-time changes in product inventory levels from inventory_raw. The new table will include the columns: product_id, current_quantity, and updated_timestamp.

Which of the following types of objects would be most suitable to implement the inventory_latest table?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** Live table
- **B.** Temporary view
- **C.** Materialized view
- **D.** Streaming table

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Lakeflow-DLP`, `Spark-Streaming`, `Delta-Lake`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Data Architecture

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `D`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** D
- **ç¤¾ç¾¤å…±è­˜:** D

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Lakeflow Declarative Pipelines / Table Types
**é—œéµæ¦‚å¿µ:** Streaming Table vs Materialized View
**é¡Œç›®é—œéµå­—ï¼š**
- **near real-time changes**: è¿‘å³æ™‚æ›´æ–°
- **append-only streaming table**: ä¾†æºæ˜¯ä¸²æµè¡¨
- **capture changes**: æ•æ‰è®Šæ›´

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ D æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**Streaming Table** æœ€é©åˆè™•ç†**è¿‘å³æ™‚**çš„è³‡æ–™è®Šæ›´ï¼Œç‰¹åˆ¥æ˜¯å¾ append-only ä¾†æºæŒçºŒæ›´æ–°ã€‚

#### Streaming Table ç‰¹æ€§
| ç‰¹æ€§ | èªªæ˜ |
|------|------|
| **è™•ç†æ¨¡å¼** | å¢é‡è™•ç†ï¼ˆIncrementalï¼‰ |
| **æ›´æ–°é »ç‡** | è¿‘å³æ™‚ï¼ˆNear Real-timeï¼‰ |
| **è³‡æ–™ä¾†æº** | Append-only ä¸²æµä¾†æº |
| **ç‹€æ…‹è¿½è¹¤** | æ”¯æ´ CDC å’Œç‹€æ…‹ç®¡ç† |

#### é©ç”¨å ´æ™¯åˆ†æ
```
é¡Œç›®éœ€æ±‚ï¼š
â”œâ”€â”€ ä¾†æºï¼šappend-only streaming table (inventory_raw)
â”œâ”€â”€ ç›®æ¨™ï¼šæ•æ‰è¿‘å³æ™‚åº«å­˜è®Šæ›´
â””â”€â”€ è¼¸å‡ºï¼šæœ€æ–°çš„åº«å­˜ç‹€æ…‹ (inventory_latest)

æœ€ä½³é¸æ“‡ï¼šStreaming Table
â”œâ”€â”€ å¯ä»¥æŒçºŒè™•ç†æ–°é€²è³‡æ–™
â”œâ”€â”€ æ”¯æ´ APPLY CHANGES é€²è¡Œ CDC
â”œâ”€â”€ ä¸éœ€è¦é‡æ–°è¨ˆç®—æ•´å¼µè¡¨
â””â”€â”€ æä¾›è¿‘å³æ™‚æ›´æ–°èƒ½åŠ›
```

#### LDP å¯¦ä½œç¯„ä¾‹
```python
import dlt

# å®šç¾© Streaming Table
@dlt.table
def inventory_latest():
    return (
        dlt.read_stream("inventory_raw")
        .groupBy("product_id")
        .agg(
            F.last("quantity").alias("current_quantity"),
            F.max("event_timestamp").alias("updated_timestamp")
        )
    )

# æˆ–ä½¿ç”¨ APPLY CHANGES é€²è¡Œ CDC
dlt.create_streaming_table("inventory_latest")

dlt.apply_changes(
    target = "inventory_latest",
    source = "inventory_raw",
    keys = ["product_id"],
    sequence_by = "event_timestamp",
    columns = ["product_id", "quantity AS current_quantity", "event_timestamp AS updated_timestamp"]
)
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A. Live table
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **Live Table å·²æ›´åç‚º Materialized View**
- åœ¨æ–°ç‰ˆ LDP ä¸­ï¼ŒLive Table é€™å€‹è¡“èªå·²è¢«æ£„ç”¨
- ç¾åœ¨çµ±ä¸€ä½¿ç”¨ Streaming Table å’Œ Materialized View

### B. Temporary view
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **è‡¨æ™‚è¦–åœ–ä¸æŒä¹…åŒ–è³‡æ–™**
- æ¯æ¬¡æŸ¥è©¢éƒ½éœ€è¦é‡æ–°è¨ˆç®—
- ä¸é©åˆéœ€è¦æŒçºŒè¿½è¹¤ç‹€æ…‹çš„å ´æ™¯
- ç„¡æ³•æ”¯æ´è¿‘å³æ™‚æ›´æ–°

### C. Materialized view
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- Materialized View æ˜¯**æ‰¹æ¬¡è™•ç†**å°å‘
- é©åˆé å…ˆè¨ˆç®—èšåˆçµæœ
- æ›´æ–°é »ç‡è¼ƒä½ï¼ˆæ’ç¨‹åŸ·è¡Œï¼‰
- **ä¸æ˜¯ç‚ºè¿‘å³æ™‚å ´æ™¯è¨­è¨ˆ**

```
Streaming Table vs Materialized Viewï¼š
â”œâ”€â”€ Streaming Table
â”‚   â”œâ”€â”€ å¢é‡è™•ç†
â”‚   â”œâ”€â”€ è¿‘å³æ™‚æ›´æ–°
â”‚   â””â”€â”€ é©åˆ CDC å’Œå³æ™‚è¿½è¹¤
â””â”€â”€ Materialized View
    â”œâ”€â”€ æ‰¹æ¬¡è™•ç†
    â”œâ”€â”€ æ’ç¨‹æ›´æ–°
    â””â”€â”€ é©åˆé è¨ˆç®—èšåˆ
```

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€Œå³æ™‚è¿½è¹¤ç”¨ Streamingï¼Œæ‰¹æ¬¡èšåˆç”¨ Materializedã€**

### LDP ç‰©ä»¶é¡å‹æ¯”è¼ƒ
| é¡å‹ | è™•ç†æ¨¡å¼ | æ›´æ–°é »ç‡ | é©ç”¨å ´æ™¯ |
|------|----------|----------|----------|
| **Streaming Table** | å¢é‡ | è¿‘å³æ™‚ | CDCã€å³æ™‚è¿½è¹¤ |
| **Materialized View** | æ‰¹æ¬¡ | æ’ç¨‹ | é è¨ˆç®—ã€èšåˆå ±è¡¨ |
| **View** | ç„¡ | å³æ™‚è¨ˆç®— | é‚è¼¯å°è£ |

### åˆ¤æ–·é¸æ“‡ä¾æ“š
```
å¦‚ä½•é¸æ“‡ LDP ç‰©ä»¶é¡å‹ï¼Ÿ

Q1: éœ€è¦è¿‘å³æ™‚æ›´æ–°å—ï¼Ÿ
â”œâ”€â”€ æ˜¯ â†’ Streaming Table
â””â”€â”€ å¦ â†’ ç¹¼çºŒ Q2

Q2: éœ€è¦é è¨ˆç®—èšåˆçµæœå—ï¼Ÿ
â”œâ”€â”€ æ˜¯ â†’ Materialized View
â””â”€â”€ å¦ â†’ View
```

### LDP è¡“èªæ¼”é€²
```
èˆŠè¡“èª â†’ æ–°è¡“èªï¼š
â”œâ”€â”€ Live Table â†’ Materialized View
â”œâ”€â”€ Streaming Live Table â†’ Streaming Table
â””â”€â”€ DLT â†’ Lakeflow Declarative Pipelines
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Streaming Tables](https://docs.databricks.com/delta-live-tables/streaming.html)
- [Materialized Views](https://docs.databricks.com/delta-live-tables/materialized-views.html)
- [APPLY CHANGES](https://docs.databricks.com/delta-live-tables/cdc.html)

---

**[è¿”å›é¡Œç›®](#question-013)**
