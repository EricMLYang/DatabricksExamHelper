# Question #017

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-017`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
The data engineering team is looking for a simple solution to share part of a large Delta Lake table with the data science team. Only department-specific columns in the table need to be shared, but with different names. In addition, there is some sensitive data that must be filtered out before sharing.

Which of the following objects can be created to meet the specified requirements?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** A new Delta Table created using CTAS statement on the existing table
- **B.** A new Delta Table created using SHALLOW CLONE from the existing table
- **C.** A new Delta Table created using DEEP CLONE from the existing table
- **D.** A stored view on the existing table

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Delta-Lake`, `Spark-SQL`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Scenario-Based`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Data Architecture

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `D`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** D
- **ç¤¾ç¾¤å…±è­˜:** D

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** View vs Table / Data Sharing
**é—œéµæ¦‚å¿µ:** æ¬„ä½é‡å‘½åã€è³‡æ–™éæ¿¾ã€ç°¡å–®æ–¹æ¡ˆ
**é¡Œç›®é—œéµå­—ï¼š**
- **simple solution**: ç°¡å–®æ–¹æ¡ˆ
- **different names**: æ¬„ä½é‡å‘½å
- **filtered out**: éæ¿¾æ•æ„Ÿè³‡æ–™

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ D æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**Stored View** æ˜¯æœ€ç°¡å–®çš„è§£æ±ºæ–¹æ¡ˆï¼Œå¯ä»¥ï¼š
- é¸æ“‡ç‰¹å®šæ¬„ä½ä¸¦é‡å‘½å
- ä½¿ç”¨ WHERE éæ¿¾æ•æ„Ÿè³‡æ–™
- ä¸éœ€è¦é¡å¤–å„²å­˜ç©ºé–“
- è³‡æ–™æ°¸é èˆ‡ä¾†æºåŒæ­¥

#### View å¯¦ä½œç¯„ä¾‹
```sql
-- å»ºç«‹ View
CREATE VIEW data_science_sales AS
SELECT
    product_id AS item_id,           -- é‡å‘½åæ¬„ä½
    category AS product_category,    -- é‡å‘½åæ¬„ä½
    quantity,
    sale_date
FROM sales_table
WHERE sensitivity_level = 'public'   -- éæ¿¾æ•æ„Ÿè³‡æ–™
  AND department = 'sales';          -- åªåŒ…å«ç‰¹å®šéƒ¨é–€
```

#### View çš„å„ªå‹¢
| å„ªå‹¢ | èªªæ˜ |
|------|------|
| **ç°¡å–®** | ä¸€å€‹ CREATE VIEW èªå¥ |
| **ç„¡é¡å¤–å„²å­˜** | ä¸è¤‡è£½è³‡æ–™ |
| **å³æ™‚åŒæ­¥** | ä¾†æºæ›´æ–°ï¼ŒView è‡ªå‹•åæ˜  |
| **æ¬„ä½é‡å‘½å** | ä½¿ç”¨ AS åˆ¥å |
| **è³‡æ–™éæ¿¾** | ä½¿ç”¨ WHERE æ¢ä»¶ |

#### éœ€æ±‚å°æ‡‰
```
é¡Œç›®éœ€æ±‚ â†’ View è§£æ³•ï¼š
â”œâ”€â”€ é¸æ“‡ç‰¹å®šæ¬„ä½ â†’ SELECT column1, column2
â”œâ”€â”€ æ¬„ä½é‡å‘½å â†’ SELECT col AS new_name
â”œâ”€â”€ éæ¿¾æ•æ„Ÿè³‡æ–™ â†’ WHERE sensitive = false
â””â”€â”€ ç°¡å–®æ–¹æ¡ˆ â†’ ä¸€å€‹ CREATE VIEW èªå¥
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A. CTAS statement
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- CTAS æœƒ**è¤‡è£½è³‡æ–™**
- éœ€è¦é¡å¤–å„²å­˜ç©ºé–“
- è³‡æ–™ä¸æœƒè‡ªå‹•åŒæ­¥
- ä¸æ˜¯ã€Œç°¡å–®æ–¹æ¡ˆã€

```sql
-- CTAS æœƒè¤‡è£½è³‡æ–™
CREATE TABLE new_table AS
SELECT * FROM source_table;

-- å•é¡Œï¼š
-- 1. è³‡æ–™é‡è¤‡
-- 2. éœ€è¦ç¶­è­·åŒæ­¥
-- 3. é¡å¤–å„²å­˜æˆæœ¬
```

### B. SHALLOW CLONE
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **ç„¡æ³•é¸æ“‡ç‰¹å®šæ¬„ä½**
- **ç„¡æ³•é‡å‘½åæ¬„ä½**
- **ç„¡æ³•éæ¿¾è³‡æ–™**
- Clone æ˜¯è¤‡è£½æ•´å¼µè¡¨

```sql
-- Shallow Clone é™åˆ¶
CREATE TABLE clone SHALLOW CLONE source_table;

-- ç„¡æ³•ï¼š
-- SELECT specific_columns
-- WHERE filter_condition
-- AS rename
```

### C. DEEP CLONE
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- èˆ‡ SHALLOW CLONE ç›¸åŒçš„é™åˆ¶
- ç„¡æ³•é¸æ“‡æ¬„ä½ã€é‡å‘½åã€éæ¿¾
- é‚„éœ€è¦æ›´å¤šå„²å­˜ç©ºé–“

```
Clone çš„ç”¨é€”ï¼š
â”œâ”€â”€ å‚™ä»½è¡¨æ ¼
â”œâ”€â”€ æ¸¬è©¦ç’°å¢ƒ
â”œâ”€â”€ æ™‚é–“æ—…è¡Œå¿«ç…§
â””â”€â”€ ä¸é©ç”¨æ–¼ï¼šæ¬„ä½é¸æ“‡/é‡å‘½å/éæ¿¾
```

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€Œé¸æ¬„ä½ã€æ”¹åå­—ã€éæ¿¾è³‡æ–™ç”¨ Viewã€**

### è³‡æ–™å…±äº«æ–¹æ¡ˆæ¯”è¼ƒ
| æ–¹æ¡ˆ | é¸æ“‡æ¬„ä½ | é‡å‘½å | éæ¿¾ | é¡å¤–å„²å­˜ | è¤‡é›œåº¦ |
|------|----------|--------|------|----------|--------|
| **View** | âœ… | âœ… | âœ… | âŒ | ä½ |
| CTAS | âœ… | âœ… | âœ… | âœ… | ä¸­ |
| Shallow Clone | âŒ | âŒ | âŒ | ä½ | ä½ |
| Deep Clone | âŒ | âŒ | âŒ | é«˜ | ä½ |

### View é©ç”¨å ´æ™¯
```
ä½¿ç”¨ View çš„æƒ…æ³ï¼š
â”œâ”€â”€ éœ€è¦æ¬„ä½é‡å‘½å
â”œâ”€â”€ éœ€è¦è³‡æ–™éæ¿¾
â”œâ”€â”€ éœ€è¦é¸æ“‡ç‰¹å®šæ¬„ä½
â”œâ”€â”€ å¸Œæœ›è³‡æ–™è‡ªå‹•åŒæ­¥
â””â”€â”€ è¿½æ±‚ç°¡å–®è§£æ±ºæ–¹æ¡ˆ

ä¸é©åˆ View çš„æƒ…æ³ï¼š
â”œâ”€â”€ éœ€è¦ç¨ç«‹çš„è³‡æ–™å‰¯æœ¬
â”œâ”€â”€ éœ€è¦ä¸åŒçš„è³‡æ–™ç”Ÿå‘½é€±æœŸ
â”œâ”€â”€ æŸ¥è©¢éå¸¸è¤‡é›œä¸”é »ç¹
â””â”€â”€ éœ€è¦å°è³‡æ–™é€²è¡Œä¿®æ”¹
```

### View èªæ³•é€Ÿè¨˜
```sql
CREATE VIEW view_name AS
SELECT
    col1 AS new_name1,    -- é‡å‘½å
    col2 AS new_name2
FROM source_table
WHERE condition = value;   -- éæ¿¾
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [CREATE VIEW](https://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-create-view.html)
- [CTAS](https://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-create-table-using.html)
- [Delta Lake Clone](https://docs.databricks.com/delta/clone.html)

---

**[è¿”å›é¡Œç›®](#question-017)**
