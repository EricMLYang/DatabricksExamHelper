# Question #007

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-007`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
A data engineer executed a query that took a long time. To investigate, they use the Query Profiler associated with this query to check the Total wall-clock duration metric.

Which of the following statements correctly describe what this metric measures?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** The total time from the start of scheduling to the end of query execution
- **B.** The time spent on actual query execution
- **C.** The total time spent on query optimization and file pruning
- **D.** The time spent on query scheduling

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Databricks-SQL`, `Spark-Performance`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Performance Optimization

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `A`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** A
- **ç¤¾ç¾¤å…±è­˜:** A

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Query Profiler / Performance Metrics
**é—œéµæ¦‚å¿µ:** Wall-clock durationã€æŸ¥è©¢æ•ˆèƒ½åˆ†æ
**é¡Œç›®é—œéµå­—ï¼š**
- **Total wall-clock duration**: ç¸½å¯¦éš›æ™‚é–“
- **Query Profiler**: æŸ¥è©¢æ•ˆèƒ½åˆ†æå™¨
- **scheduling to execution**: å®Œæ•´ç”Ÿå‘½é€±æœŸ

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ A æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**Total wall-clock duration** æ¸¬é‡çš„æ˜¯å¾æ’ç¨‹é–‹å§‹åˆ°åŸ·è¡ŒçµæŸçš„**å®Œæ•´æ™‚é–“**ã€‚

#### Wall-clock Duration çš„å®šç¾©
```
æŸ¥è©¢ç”Ÿå‘½é€±æœŸï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Total Wall-Clock Duration                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Scheduling â”‚ Optimization  â”‚ Actual Execution         â”‚
â”‚    Time    â”‚ & Pruning     â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Start                                           End   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŒ…å«çš„éšæ®µ
| éšæ®µ | èªªæ˜ |
|------|------|
| **Scheduling** | æ’ç¨‹æŸ¥è©¢ã€åˆ†é…è³‡æº |
| **Optimization** | æŸ¥è©¢å„ªåŒ–ã€ç”ŸæˆåŸ·è¡Œè¨ˆåŠƒ |
| **File Pruning** | æª”æ¡ˆè£å‰ªã€Data Skipping |
| **Execution** | å¯¦éš›åŸ·è¡ŒæŸ¥è©¢ |

#### ç‚ºä»€éº¼å« "Wall-clock"ï¼Ÿ
```
Wall-clock = ã€Œç‰†ä¸Šçš„æ™‚é˜ã€= å¯¦éš›ç¶“éçš„æ™‚é–“

æ„æ€æ˜¯ï¼š
â”œâ”€â”€ å¾ä½ æŒ‰ä¸‹ã€ŒåŸ·è¡Œã€
â”œâ”€â”€ åˆ°çœ‹åˆ°çµæœ
â””â”€â”€ ä¸­é–“ç¶“éçš„å¯¦éš›æ™‚é–“

ä¸åŒæ–¼ CPU timeï¼ˆåªè¨ˆç®— CPU å·¥ä½œæ™‚é–“ï¼‰
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### B. The time spent on actual query execution
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- é€™åªæ˜¯ **Execution Time**ï¼Œæ˜¯ wall-clock çš„ä¸€éƒ¨åˆ†
- Wall-clock é‚„åŒ…å«æ’ç¨‹å’Œå„ªåŒ–æ™‚é–“
- åœ¨ Query Profiler ä¸­æœ‰å–®ç¨çš„ execution time æŒ‡æ¨™

### C. The total time spent on query optimization and file pruning
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- é€™åªæ˜¯ **Planning/Optimization Time**
- Wall-clock é‚„åŒ…å«æ’ç¨‹å’Œå¯¦éš›åŸ·è¡Œæ™‚é–“
- é€™æ˜¯ wall-clock çš„å­é›†

### D. The time spent on query scheduling
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- é€™åªæ˜¯ **Scheduling Time**
- Wall-clock é‚„åŒ…å«å„ªåŒ–å’ŒåŸ·è¡Œæ™‚é–“
- é€™æ˜¯ wall-clock çš„å­é›†

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€ŒWall-clock çœ‹å…¨ç¨‹ï¼Œå¾æ’ç¨‹åˆ°å®Œæˆã€**

### Query Profiler å¸¸è¦‹æŒ‡æ¨™
| æŒ‡æ¨™ | èªªæ˜ | ç¯„åœ |
|------|------|------|
| **Total wall-clock duration** | å®Œæ•´æ™‚é–“ | æ’ç¨‹ â†’ åŸ·è¡Œå®Œæˆ |
| Scheduling time | æ’ç¨‹æ™‚é–“ | æ’ç¨‹éšæ®µ |
| Planning time | å„ªåŒ–æ™‚é–“ | å„ªåŒ–éšæ®µ |
| Execution time | åŸ·è¡Œæ™‚é–“ | åŸ·è¡Œéšæ®µ |

### æ™‚é–“é—œä¿‚
```
Total wall-clock duration â‰ˆ
    Scheduling time +
    Planning time +
    Execution time

æ³¨æ„ï¼šå¯èƒ½æœ‰é‡ç–Šå’Œå…¶ä»–é–‹éŠ·
```

### æ•ˆèƒ½åˆ†ææŠ€å·§
```
æŸ¥è©¢æ…¢ï¼ŸæŸ¥çœ‹ Query Profilerï¼š

1. Wall-clock duration å¾ˆé•·
   â”œâ”€â”€ Scheduling time é•· â†’ è³‡æºä¸è¶³
   â”œâ”€â”€ Planning time é•· â†’ è¤‡é›œæŸ¥è©¢
   â””â”€â”€ Execution time é•· â†’ è³‡æ–™é‡å¤§æˆ–æ•ˆèƒ½å•é¡Œ

2. å¸¸è¦‹å„ªåŒ–æ–¹å‘ï¼š
   â”œâ”€â”€ å¢åŠ å¢é›†è³‡æº
   â”œâ”€â”€ å„ªåŒ–æŸ¥è©¢é‚è¼¯
   â”œâ”€â”€ ä½¿ç”¨ Z-ORDER/Liquid Clustering
   â””â”€â”€ æª¢æŸ¥ Data Skipping æ•ˆç‡
```

### Wall-clock vs CPU Time
| æŒ‡æ¨™ | èªªæ˜ |
|------|------|
| **Wall-clock** | å¯¦éš›ç¶“éçš„æ™‚é–“ï¼ˆäººæ„Ÿå—åˆ°çš„æ™‚é–“ï¼‰ |
| **CPU time** | CPU å·¥ä½œçš„æ™‚é–“ï¼ˆå¯èƒ½ä¸¦è¡Œï¼‰ |

```
ä¾‹å¦‚ï¼š
â”œâ”€â”€ Wall-clock = 10 ç§’ï¼ˆä½ ç­‰äº† 10 ç§’ï¼‰
â””â”€â”€ CPU time = 40 ç§’ï¼ˆ4 å€‹ CPU å„å·¥ä½œ 10 ç§’ï¼‰
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Query Profiler](https://docs.databricks.com/sql/admin/query-profile.html)
- [Monitor Query Performance](https://docs.databricks.com/sql/admin/performance.html)
- [SQL Warehouse Monitoring](https://docs.databricks.com/sql/admin/sql-endpoints.html#monitoring)

---

**[è¿”å›é¡Œç›®](#question-007)**
