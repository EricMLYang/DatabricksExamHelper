# Question 24

## Question
A data engineer uses the following code to process CDC data in Lakeflow Declarative Pipelines:



```

- CREATE OR REFRESH STREAMING TABLE cdc_target;
-  
- CREATE FLOW cdc_flow AS AUTO CDC INTO users_target
- FROM stream(users_raw)
- KEYS (user_id)
- APPLY AS DELETE WHEN operation = "DELETE"
- SEQUENCE BY updated_timestamp
- COLUMNS *;
```





After running this code, the data engineer noticed that two objects were created the metastore in addition to the users_target table:
- 

A view named users_target.
- 

A table named __apply_changes_storage_users_target.




Which of the following correctly explains the purpose of these objects?

## Options
- A. These objects are used for internal CDC processing leveraging sequence_by along with extra information such as, tombstones and versions required to handle out-of-order data. (Correct)
- B. The view users_target is a materialized snapshot of the raw data, while the table __apply_changes_storage_users_target stores user activity logs for auditing purposes. 
- C. The users_target view is a virtual index on the target table to speed up queries, and __apply_changes_storage_users_target is a backup of the original users_target index. 
- D. The view users_target and the table __apply_changes_storage_users_target are temporary objects created for write optimization and are deleted immediately after the pipeline runs. 

## Explanation
In Lakeflow Declarative Pipelines*, when you create a CDC (Change Data Capture) flow with operations like `APPLY AS DELETE` and `SEQUENCE BY`, the system needs a way to manage incremental updates, including insertions, updates, and deletions, while maintaining the correct order of events based on sequence keys. The __apply_changes_storage_users_target table is an internal storage table that keeps track of these changes along with "tombstone" markers for deleted rows and versioning metadata to ensure that out-of-order or late-arriving events are applied correctly. This internal table is not meant for direct querying but is essential for maintaining CDC consistency.




The users_target view, on the other hand, is a virtual layer over this internal table that presents the current state of the data as a clean, queryable snapshot. This allows the CDC logic to remain encapsulated and transparent.




* Databricks has recenlty open-sourced this solution, integrating it into the Apache Spark ecosystem under the name Spark Declarative Pipelines (SDP).
