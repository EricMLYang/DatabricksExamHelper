Question 114
A data team's Structured Streaming job is configured to calculate running aggregates for item sales to update a downstream marketing dashboard. The marketing team has introduced a new promotion, and they would like to add a new field to track the number of times this promotion code is used for each item. A junior data engineer suggests updating the existing query as follows. Note that proposed changes are in bold.
Original query:
df.groupBy("item")
.agg (count("item").alias ("total_count"),
mean ("sale_price").alias ("avg_price"))
.writeStream
.outputMode ("complete")
.option("checkpointLocation", "/item_agg/_checkpoint")
.start("/item_agg")
Proposed query:
df.groupBy("item")
.agg (count("item").alias ("total_count"),
mean ("sale_price").alias("avg_price"),
count("promo_code = 'NEW_MEMBER'").alias("new_member_promo"))
.writeStream
.outputMode ("complete")
.option('mergeSchema', 'true')
.option("checkpointLocation", "/item_agg/_checkpoint")
.start("/item_agg")
Which step must also be completed to put the proposed query into production?
A. Specify a new checkpoint Location B. Remove .option('mergeSchema', 'true') from the streaming write C. Increase the shuffle partitions to account for additional aggregates D. Run REFRESH TABLE delta.'/item_agg'
Correct Answer: A
Community Vote/Discussion:
• 社群投票分佈：A (100%)
• 討論重點：
    ◦ 社群用戶 Deb9753 解釋，當更新 Streaming Job 的 schema（特別是涉及狀態存儲的聚合查詢）時，指定一個新的 Checkpoint location 是必要的，這樣可以確保查詢使用新架構重新開始，避免舊 Checkpoint 的狀態與新 Schema 不相容的問題。
    ◦ 用戶 MDWPartners 補充，每個查詢必須有不同的 Checkpoint location，多個查詢不應共用同一位置