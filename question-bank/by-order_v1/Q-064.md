# Question #64

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-064`

### ä¾†æº
**ä¾†æº:** Real Exam Recall

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

A Delta Lake table was created with the below query:

```sql
CREATE TABLE prod.sales_by_store
AS (
  SELECT *
  FROM prod.sales a
  INNER JOIN prod.store b
  ON a.store_id = b.store_id
)
```

Consider the following query:

```sql
DROP TABLE prod.sales_by_store
```

If this statement is executed by a workspace admin, which result will occur?

### é¸é …

- **A.** Nothing will occur until a COMMIT command is executed.
- **B.** The table will be removed from the catalog but the data will remain in storage.
- **C.** The table will be removed from the catalog and the data will be deleted.
- **D.** An error will occur because Delta Lake prevents the deletion of production data.
- **E.** Data will be marked as deleted but still recoverable with Time Travel.

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `DROP-TABLE`, `Managed-Tables`, `External-Tables`, `Data-Deletion`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Managed-vs-External-Behavior`, `Data-Persistence`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** `Delta Lake`

---

## ç­”æ¡ˆèˆ‡è§£æé€£çµ

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `C`

---

## ğŸ“ è€ƒé»è­˜åˆ¥

### ä¸»è¦è€ƒé»
**æ ¸å¿ƒæŠ€è¡“:** DROP TABLE æŒ‡ä»¤å° Managed Tables çš„è¡Œç‚º
**çŸ¥è­˜é ˜åŸŸ:** Delta Lake è¡¨æ ¼ç®¡ç†èˆ‡è³‡æ–™ç”Ÿå‘½é€±æœŸ
**é—œéµæ¦‚å¿µ:** Managed Table vs External Tableã€CREATE TABLE AS SELECTã€è³‡æ–™èˆ‡ metadata åˆ†é›¢

### æ¬¡è¦è€ƒé»
- CREATE TABLE AS SELECT å»ºç«‹çš„è¡¨æ ¼é¡å‹
- DROP TABLE åœ¨ä¸åŒè¡¨æ ¼é¡å‹ä¸‹çš„è¡Œç‚ºå·®ç•°
- Unity Catalog ä¸­çš„è¡¨æ ¼ç®¡ç†æ©Ÿåˆ¶

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ C æ˜¯æ­£ç¢ºçš„ï¼Ÿ

**æŠ€è¡“åŸç†:**
ä½¿ç”¨ `CREATE TABLE ... AS SELECT` èªæ³•å»ºç«‹çš„è¡¨æ ¼æ˜¯ **Managed Table**ï¼ˆå—ç®¡ç†è¡¨æ ¼ï¼‰ã€‚å°æ–¼ Managed Tableï¼ŒDatabricks è² è²¬ç®¡ç†è¡¨æ ¼çš„ metadata å’Œå¯¦éš›è³‡æ–™æª”æ¡ˆã€‚ç•¶åŸ·è¡Œ `DROP TABLE` æ™‚ï¼š
1. è¡¨æ ¼å¾ catalog ä¸­ç§»é™¤ï¼ˆmetadata åˆªé™¤ï¼‰
2. åº•å±¤çš„è³‡æ–™æª”æ¡ˆä¹Ÿæœƒè¢«ç‰©ç†åˆªé™¤

**ç¬¦åˆéœ€æ±‚:**
é¡Œç›®ä¸­çš„å»ºè¡¨èªå¥æ²’æœ‰æŒ‡å®š `LOCATION` å­å¥ï¼Œé€™è¡¨ç¤ºï¼š
- è³‡æ–™å„²å­˜åœ¨ Databricks çš„é è¨­å—ç®¡ç†ä½ç½®
- Databricks å®Œå…¨æ§åˆ¶è³‡æ–™çš„ç”Ÿå‘½é€±æœŸ
- DROP TABLE æœƒåŒæ™‚æ¸…ç† metadata å’Œè³‡æ–™

**å¯¦å‹™æ‡‰ç”¨:**
```sql
-- é€™ç¨®å»ºè¡¨æ–¹å¼å»ºç«‹çš„æ˜¯ Managed Table
CREATE TABLE prod.sales_by_store
AS (SELECT * FROM prod.sales a INNER JOIN prod.store b ON a.store_id = b.store_id)

-- åŸ·è¡Œ DROP TABLE æœƒå®Œå…¨åˆªé™¤è¡¨æ ¼å’Œè³‡æ–™
DROP TABLE prod.sales_by_store; -- âš ï¸ è³‡æ–™ç„¡æ³•å¾©åŸ
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### é¸é … A - éœ€è¦ COMMIT æŒ‡ä»¤æ‰åŸ·è¡Œ

**éŒ¯èª¤åŸå› :** æ··æ·†äº†äº‹å‹™ç®¡ç†æ¦‚å¿µ

**è©³ç´°åˆ†æ:**
DROP TABLE æ˜¯ DDLï¼ˆData Definition Languageï¼‰æ“ä½œï¼Œä¸éœ€è¦æ˜ç¢ºçš„ COMMITï¼š
- DDL æ“ä½œé€šå¸¸æ˜¯è‡ªå‹•æäº¤çš„
- Databricks SQL æ²’æœ‰å‚³çµ±è³‡æ–™åº«çš„æ˜ç¢ºäº‹å‹™æ§åˆ¶æ©Ÿåˆ¶
- é€™å€‹æ¦‚å¿µæ›´é©ç”¨æ–¼å‚³çµ±çš„ RDBMS ç’°å¢ƒ

**æ˜“æ··æ·†é»:**
å°‡å‚³çµ±è³‡æ–™åº«çš„äº‹å‹™æ¦‚å¿µå¥—ç”¨åˆ° Databricks ç’°å¢ƒã€‚

---

### é¸é … B - åªç§»é™¤ catalogï¼Œè³‡æ–™ä¿ç•™

**éŒ¯èª¤åŸå› :** æ··æ·†äº† Managed Table å’Œ External Table çš„è¡Œç‚º

**è©³ç´°åˆ†æ:**
é€™å€‹è¡Œç‚ºæè¿°çš„æ˜¯ External Table çš„ DROP è¡Œç‚ºï¼Œè€Œä¸æ˜¯ Managed Tableï¼š
- External Tableï¼šåªç§»é™¤ metadataï¼Œè³‡æ–™æª”æ¡ˆä¿ç•™åœ¨å¤–éƒ¨å„²å­˜
- Managed Tableï¼šåŒæ™‚ç§»é™¤ metadata å’Œè³‡æ–™æª”æ¡ˆ
- é¡Œç›®ä¸­å»ºç«‹çš„æ˜¯ Managed Tableï¼Œæ‰€ä»¥è³‡æ–™æœƒè¢«åˆªé™¤

**æ˜“æ··æ·†é»:**
ä¸äº†è§£ä¸åŒè¡¨æ ¼é¡å‹åœ¨ DROP TABLE æ™‚çš„è¡Œç‚ºå·®ç•°ã€‚

---

### é¸é … D - é˜²æ­¢ç”Ÿç”¢è³‡æ–™åˆªé™¤éŒ¯èª¤

**éŒ¯èª¤åŸå› :** èª¤è§£ Delta Lake çš„ä¿è­·æ©Ÿåˆ¶

**è©³ç´°åˆ†æ:**
é›–ç„¶é¡Œç›®å‚™è¨»ä¸­æåˆ°é€™å€‹ç­”æ¡ˆï¼Œä½†å¯¦éš›ä¸Šï¼š
- Delta Lake æ²’æœ‰å…§å»ºé˜²æ­¢ DROP TABLE çš„ä¿è­·æ©Ÿåˆ¶
- ä¿è­·ç”Ÿç”¢è³‡æ–™ä¸»è¦é€éæ¬Šé™æ§åˆ¶å’Œæœ€ä½³å¯¦è¸ï¼Œè€ŒéæŠ€è¡“é™åˆ¶
- workspace admin é€šå¸¸æœ‰è¶³å¤ æ¬Šé™åŸ·è¡Œ DROP TABLE æ“ä½œ
- é€™ç¨®ä¿è­·æ›´å¤šæ˜¯çµ„ç¹”å±¤é¢çš„æ”¿ç­–ï¼Œè€ŒéæŠ€è¡“é™åˆ¶

**æ˜“æ··æ·†é»:**
å°‡å®‰å…¨æœ€ä½³å¯¦è¸èˆ‡æŠ€è¡“å¯¦ä½œé™åˆ¶æ··æ·†ã€‚

---

### é¸é … E - æ¨™è¨˜åˆªé™¤ä½†å¯ç”¨ Time Travel å¾©åŸ

**éŒ¯èª¤åŸå› :** èª¤è§£ Time Travel çš„é©ç”¨ç¯„åœ

**è©³ç´°åˆ†æ:**
Time Travel é©ç”¨æ–¼è¡¨æ ¼å…§å®¹çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œè€Œä¸æ˜¯è¡¨æ ¼æœ¬èº«çš„å­˜åœ¨ï¼š
- Time Travel å¯ä»¥å¾©åŸè³‡æ–™çš„æ­·å²ç‰ˆæœ¬ï¼ˆINSERTã€UPDATEã€DELETEï¼‰
- ä½†ç„¡æ³•å¾©åŸå·²ç¶“ DROP çš„è¡¨æ ¼çµæ§‹
- DROP TABLE æœƒç‰©ç†åˆªé™¤ transaction logï¼ŒTime Travel å¤±å»åŸºç¤

**æ˜“æ··æ·†é»:**
å°‡è³‡æ–™ç‰ˆæœ¬æ§åˆ¶èˆ‡è¡¨æ ¼ç”Ÿå‘½é€±æœŸç®¡ç†æ··ç‚ºä¸€è«‡ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•èˆ‡è§£é¡ŒæŠ€å·§

### è¨˜æ†¶å£è¨£
**ã€ŒAS SELECT å»ºç®¡ç†è¡¨ï¼ŒDROP TABLE è³‡æ–™æ°æ°ã€**
- CREATE TABLE AS SELECT â†’ Managed Table
- Managed Table + DROP TABLE â†’ è³‡æ–™å®Œå…¨åˆªé™¤

### è§£é¡Œæ­¥é©Ÿ
1. **è­˜åˆ¥è¡¨æ ¼é¡å‹** - çœ‹å»ºè¡¨èªå¥æ˜¯å¦æœ‰ LOCATION å­å¥
2. **åˆ¤æ–·ç®¡ç†æ–¹å¼** - ç„¡ LOCATION = Managed Table
3. **ç¢ºå®š DROP è¡Œç‚º** - Managed Table çš„ DROP TABLE æœƒåˆªé™¤è³‡æ–™
4. **æ’é™¤å…¶ä»–æ¦‚å¿µ** - æ’é™¤äº‹å‹™ã€Time Travelã€ä¿è­·æ©Ÿåˆ¶ç­‰å¹²æ“¾

### å¸¸è¦‹é™·é˜±è­¦ç¤º
âš ï¸ **é™·é˜± 1:** æ··æ·† Managed èˆ‡ External Table çš„ DROP è¡Œç‚º - é—œéµåœ¨å»ºè¡¨æ™‚æ˜¯å¦æŒ‡å®š LOCATION
âš ï¸ **é™·é˜± 2:** ä»¥ç‚º Delta Lake æœ‰å…§å»ºè³‡æ–™ä¿è­·æ©Ÿåˆ¶ - ä¿è­·ä¸»è¦ä¾†è‡ªæ¬Šé™å’Œæ”¿ç­–ï¼ŒéæŠ€è¡“é™åˆ¶

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶èˆ‡å»¶ä¼¸é–±è®€

### å®˜æ–¹æ–‡ä»¶
1. **[DROP TABLE](https://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-drop-table.html)** - DROP TABLE èªæ³•èˆ‡è¡Œç‚ºèªªæ˜
2. **[Managed vs External Tables](https://docs.databricks.com/data/tables.html)** - å…©ç¨®è¡¨æ ¼é¡å‹çš„è©³ç´°æ¯”è¼ƒ
3. **[CREATE TABLE AS SELECT](https://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-create-table-using.html)** - CTAS èªæ³•èˆ‡å»ºç«‹çš„è¡¨æ ¼ç‰¹æ€§

### å»¶ä¼¸é–±è®€
- [Unity Catalog Table Management Best Practices](https://docs.databricks.com/data-governance/unity-catalog/index.html)

### ç›¸é—œé¡Œç›®
- å…¶ä»– CREATE TABLE èªæ³•ç›¸é—œé¡Œç›®
- Unity Catalog æ¬Šé™ç®¡ç†ç›¸é—œé¡Œç›®
- Delta Lake è¡¨æ ¼ç®¡ç†ç›¸é—œé¡Œç›®

---

## ç›¸é—œè³‡æº

### å®˜æ–¹æ–‡ä»¶
- [DROP TABLE](https://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-drop-table.html)
- [Managed vs External Tables](https://docs.databricks.com/data/tables.html)
