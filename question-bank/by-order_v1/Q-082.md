# Q-082

## é¡Œç›®è³‡è¨Š

**ID:** `Q-082`  
**ä¾†æº:** Official Practice Exam  
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

A junior data engineer has manually configured a series of jobs using the Databricks Jobs UI. Upon reviewing their work, the engineer realizes that they are listed as the "Owner" for each job. They attempt to transfer "Owner" privileges to the "DevOps" group, but cannot successfully accomplish this task.

Which statement explains what is preventing this privilege transfer?

### é¸é …

**A.** Databricks jobs must have exactly one owner; "Owner" privileges cannot be assigned to a group.

**B.** The creator of a Databricks job will always have "Owner" privileges; this configuration cannot be changed.

**C.** Other than the default "admins" group, only individual users can be granted privileges on jobs.

**D.** A user can only transfer job ownership to a group if they are also a member of that group.

**E.** Only workspace administrators can grant "Owner" privileges to a group.

---

## æ¨™ç±¤ (Tags)

### Topic Tags
- `Databricks-Workflows`
- `Access-Control`
- `Security`

### Trap Tags
- `Concept-Confusion`

### Level Tag
- `L2-Intermediate`

---

---

# é¡Œç›®è§£æ

## é¡Œç›®å›é¡§

**é¡Œç›® ID:** `Q-082`  
**é¡Œç›®é€£çµ:** [é»æ­¤è¿”å›é¡Œç›®](#q-082)  
**æ­£è§£:** `A`

---

## ğŸ“ è€ƒé»è­˜åˆ¥

### ä¸»è¦è€ƒé»
**æ ¸å¿ƒæŠ€è¡“:** Databricks Jobs æ¬Šé™ç®¡ç†  
**çŸ¥è­˜é ˜åŸŸ:** ç¶­é‹èˆ‡è‡ªå‹•åŒ– / å­˜å–æ§åˆ¶  
**é—œéµæ¦‚å¿µ:**
- Job Owner çš„å”¯ä¸€æ€§è¦æ±‚
- å€‹äººç”¨æˆ¶ï¼ˆUserï¼‰èˆ‡ç¾¤çµ„ï¼ˆGroupï¼‰çš„æ¬Šé™å·®ç•°
- Job æ¬Šé™å±¤ç´šï¼ˆOwner, Can Manage, Can Viewï¼‰

### æ¬¡è¦è€ƒé»
- Databricks Workflows æ¬Šé™æ¨¡å‹
- ç¾¤çµ„æ¬Šé™çš„é™åˆ¶
- æ¬Šé™è½‰ç§»çš„è¦å‰‡

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ A æ˜¯æ­£ç¢ºçš„ï¼Ÿ

**æŠ€è¡“åŸç†:**

Databricks Jobs çš„ Owner æ¬Šé™å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

1. **å”¯ä¸€æ€§è¦æ±‚**ï¼šæ¯å€‹ Job å¿…é ˆæœ‰ä¸”åªèƒ½æœ‰**ä¸€å€‹ Owner**ï¼Œé€™å€‹ Owner å¿…é ˆæ˜¯**å€‹äººç”¨æˆ¶**ï¼ˆUserï¼‰ï¼Œè€Œä¸èƒ½æ˜¯ç¾¤çµ„ï¼ˆGroupï¼‰ã€‚

2. **å®Œæ•´æ§åˆ¶æ¬Š**ï¼šOwner æ“æœ‰ Job çš„å®Œæ•´æ§åˆ¶æ¬Šï¼ŒåŒ…æ‹¬ï¼š
   - ä¿®æ”¹ Job é…ç½®
   - åŸ·è¡Œ Job
   - åˆªé™¤ Job
   - ç®¡ç† Job æ¬Šé™
   - è½‰ç§» Owner æ¬Šé™çµ¦å…¶ä»–**å€‹äººç”¨æˆ¶**

3. **ç¾¤çµ„é™åˆ¶**ï¼šé›–ç„¶ç¾¤çµ„å¯ä»¥è¢«æˆäºˆå…¶ä»–æ¬Šé™ï¼ˆå¦‚ "Can Manage" æˆ– "Can View"ï¼‰ï¼Œä½†**ä¸èƒ½è¢«è¨­å®šç‚º Owner**ã€‚

**ç¬¦åˆéœ€æ±‚:**

é¡Œç›®ä¸­å·¥ç¨‹å¸«ç„¡æ³•å°‡ Owner æ¬Šé™è½‰ç§»çµ¦ "DevOps" ç¾¤çµ„ï¼Œæ­£æ˜¯å› ç‚ºé•åäº†ã€ŒOwner å¿…é ˆæ˜¯å€‹äººç”¨æˆ¶ã€çš„é™åˆ¶ã€‚

**å¯¦å‹™æ‡‰ç”¨:**

```python
# é€é Databricks API æŸ¥çœ‹ Job æ¬Šé™
import requests

# æŸ¥çœ‹ Job çš„æ¬Šé™è¨­å®š
response = requests.get(
    f"{databricks_url}/api/2.0/permissions/jobs/{job_id}",
    headers={"Authorization": f"Bearer {token}"}
)

permissions = response.json()
print(permissions)

# è¼¸å‡ºç¯„ä¾‹ï¼š
# {
#   "object_id": "/jobs/123",
#   "object_type": "job",
#   "access_control_list": [
#     {
#       "user_name": "engineer@company.com",  # Owner æ˜¯å€‹äººç”¨æˆ¶
#       "all_permissions": [
#         {
#           "permission_level": "IS_OWNER",
#           "inherited": false
#         }
#       ]
#     },
#     {
#       "group_name": "DevOps",               # ç¾¤çµ„åªèƒ½æœ‰å…¶ä»–æ¬Šé™
#       "all_permissions": [
#         {
#           "permission_level": "CAN_MANAGE",  # ä¸èƒ½æ˜¯ IS_OWNER
#           "inherited": false
#         }
#       ]
#     }
#   ]
# }
```

**æ­£ç¢ºçš„æ¬Šé™è½‰ç§»æ–¹å¼ï¼š**

```python
# æ–¹å¼ 1ï¼šè½‰ç§» Owner çµ¦å¦ä¸€å€‹å€‹äººç”¨æˆ¶
# åœ¨ Databricks UI ä¸­ï¼š
# Jobs â†’ [é¸æ“‡ Job] â†’ Permissions â†’ Change Owner â†’ [é¸æ“‡å€‹äººç”¨æˆ¶]

# æ–¹å¼ 2ï¼šé€é API è½‰ç§» Owner
import requests

# è½‰ç§» Owner çµ¦å¦ä¸€å€‹ç”¨æˆ¶
payload = {
    "access_control_list": [
        {
            "user_name": "devops-lead@company.com",  # æ–°çš„ Ownerï¼ˆå¿…é ˆæ˜¯å€‹äººç”¨æˆ¶ï¼‰
            "permission_level": "IS_OWNER"
        }
    ]
}

response = requests.put(
    f"{databricks_url}/api/2.0/permissions/jobs/{job_id}",
    headers={"Authorization": f"Bearer {token}"},
    json=payload
)

# æ–¹å¼ 3ï¼šæˆäºˆç¾¤çµ„ Can Manage æ¬Šé™ï¼ˆæ¬¡ä½³æ–¹æ¡ˆï¼‰
payload = {
    "access_control_list": [
        {
            "user_name": "engineer@company.com",    # ä¿ç•™å€‹äºº Owner
            "permission_level": "IS_OWNER"
        },
        {
            "group_name": "DevOps",                 # ç¾¤çµ„ç²å¾—ç®¡ç†æ¬Šé™
            "permission_level": "CAN_MANAGE"        # åƒ…æ¬¡æ–¼ Owner çš„æ¬Šé™
        }
    ]
}

response = requests.put(
    f"{databricks_url}/api/2.0/permissions/jobs/{job_id}",
    headers={"Authorization": f"Bearer {token}"},
    json=payload
)
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### é¸é … Bï¼šå»ºç«‹è€…æ°¸é ä¿æœ‰ Owner æ¬Šé™

**ç‚ºä»€éº¼éŒ¯èª¤ï¼š**

1. **Owner å¯ä»¥è½‰ç§»**ï¼šJob çš„ Owner æ¬Šé™æ˜¯å¯ä»¥è½‰ç§»çµ¦å…¶ä»–å€‹äººç”¨æˆ¶çš„ï¼Œå»ºç«‹è€…ä¸æœƒæ°¸é ä¿æœ‰ Owner æ¬Šé™ã€‚

2. **æ··æ·†ä¸å¯è®Šæ€§**ï¼šé›–ç„¶ Job å¿…é ˆæœ‰ä¸€å€‹ Ownerï¼Œä½†é€™å€‹ Owner å¯ä»¥æ˜¯ä¸åŒçš„äººã€‚

3. **å¸¸è¦‹å ´æ™¯**ï¼šåœ¨å¯¦å‹™ä¸­ï¼Œç¶“å¸¸éœ€è¦å°‡ Job çš„æ‰€æœ‰æ¬Šå¾ä¸€å€‹å·¥ç¨‹å¸«è½‰ç§»çµ¦å¦ä¸€å€‹å·¥ç¨‹å¸«ï¼ˆå¦‚é›¢è·ã€è§’è‰²è®Šæ›´ï¼‰ã€‚

**é™·é˜±è¨­è¨ˆï¼š**  
é€™å€‹é¸é …èª¤å°è€ƒç”Ÿä»¥ç‚º Owner æ¬Šé™æ˜¯ã€Œæ°¸ä¹…ç¶å®šã€çš„ï¼Œæ··æ·†äº†ã€Œå¿…é ˆæœ‰ Ownerã€èˆ‡ã€ŒOwner ä¸å¯è®Šæ›´ã€çš„æ¦‚å¿µã€‚

```python
# ç¯„ä¾‹ï¼šè½‰ç§» Owner çµ¦å…¶ä»–ç”¨æˆ¶ï¼ˆå®Œå…¨åˆæ³•ï¼‰
# æ­¥é©Ÿï¼š
# 1. åŸ Owner: engineer1@company.com
# 2. è½‰ç§»çµ¦: engineer2@company.com
# 3. çµæœ: engineer2@company.com æˆç‚ºæ–° Owner
#         engineer1@company.com å¯ä»¥è¢«æˆäºˆå…¶ä»–æ¬Šé™æˆ–å®Œå…¨ç§»é™¤

# é€é UI æ“ä½œï¼š
# Jobs â†’ [é¸æ“‡ Job] â†’ Permissions â†’ Change Owner â†’ engineer2@company.com
```

---

### é¸é … Cï¼šåªæœ‰å€‹äººç”¨æˆ¶å¯ä»¥è¢«æˆäºˆ Job æ¬Šé™

**ç‚ºä»€éº¼éŒ¯èª¤ï¼š**

1. **ç¾¤çµ„å¯ä»¥ç²å¾—å…¶ä»–æ¬Šé™**ï¼šç¾¤çµ„å¯ä»¥è¢«æˆäºˆ "Can Manage"ã€"Can View" ç­‰æ¬Šé™ï¼Œåªæ˜¯ä¸èƒ½æˆç‚º Ownerã€‚

2. **éåº¦æ¦‚æ‹¬**ï¼šé€™å€‹é¸é …éåº¦æ¦‚æ‹¬äº†æ¬Šé™é™åˆ¶ï¼Œå¯¦éš›ä¸Šåªæœ‰ Owner æ¬Šé™æœ‰å€‹äººç”¨æˆ¶çš„é™åˆ¶ã€‚

3. **admins ç¾¤çµ„ç„¡ç‰¹æ®Šæ€§**ï¼šadmins ç¾¤çµ„æ²’æœ‰ç‰¹æ®Šè±å…ï¼Œå®ƒä¹Ÿä¸èƒ½æˆç‚º Job çš„ Ownerï¼ˆä½† admins æˆå“¡ä½œç‚ºå€‹äººç”¨æˆ¶å¯ä»¥ï¼‰ã€‚

**é™·é˜±è¨­è¨ˆï¼š**  
é€™å€‹é¸é …æ··æ·†äº†ã€ŒOwner æ¬Šé™çš„é™åˆ¶ã€èˆ‡ã€Œæ‰€æœ‰æ¬Šé™çš„é™åˆ¶ã€ï¼Œèª¤å°è€ƒç”Ÿä»¥ç‚ºç¾¤çµ„ä¸èƒ½ç²å¾—ä»»ä½• Job æ¬Šé™ã€‚

```python
# ç¾¤çµ„å¯ä»¥ç²å¾— Can Manage æˆ– Can View æ¬Šé™
payload = {
    "access_control_list": [
        {
            "user_name": "owner@company.com",
            "permission_level": "IS_OWNER"          # Owner å¿…é ˆæ˜¯å€‹äººç”¨æˆ¶
        },
        {
            "group_name": "DevOps",                 # âœ… ç¾¤çµ„å¯ä»¥æœ‰ Can Manage
            "permission_level": "CAN_MANAGE"
        },
        {
            "group_name": "DataAnalysts",           # âœ… ç¾¤çµ„å¯ä»¥æœ‰ Can View
            "permission_level": "CAN_VIEW"
        },
        {
            "group_name": "admins",                 # âœ… admins ç¾¤çµ„ä¹Ÿåªèƒ½æœ‰é Owner æ¬Šé™
            "permission_level": "CAN_MANAGE"
        }
    ]
}
```

---

### é¸é … Dï¼šç”¨æˆ¶åªèƒ½è½‰ç§»çµ¦è‡ªå·±æ‰€å±¬çš„ç¾¤çµ„

**ç‚ºä»€éº¼éŒ¯èª¤ï¼š**

1. **ç„¡æ­¤é™åˆ¶**ï¼šDatabricks æ²’æœ‰ã€Œç”¨æˆ¶åªèƒ½è½‰ç§»çµ¦è‡ªå·±æ‰€å±¬ç¾¤çµ„ã€çš„é™åˆ¶ã€‚

2. **æ ¸å¿ƒå•é¡Œä¸åœ¨æˆå“¡è³‡æ ¼**ï¼šé¡Œç›®çš„æ ¸å¿ƒå•é¡Œæ˜¯ã€Œç¾¤çµ„ä¸èƒ½æˆç‚º Ownerã€ï¼Œè€Œä¸æ˜¯æˆå“¡è³‡æ ¼å•é¡Œã€‚

3. **é‚è¼¯çŸ›ç›¾**ï¼šå³ä½¿ç”¨æˆ¶æ˜¯ DevOps ç¾¤çµ„çš„æˆå“¡ï¼Œä¹Ÿç„¡æ³•å°‡ Owner æ¬Šé™è½‰ç§»çµ¦ç¾¤çµ„ï¼ˆå› ç‚ºç¾¤çµ„ä¸èƒ½æˆç‚º Ownerï¼‰ã€‚

**é™·é˜±è¨­è¨ˆï¼š**  
é€™å€‹é¸é …è£½é€ äº†ä¸€å€‹è™›å‡çš„é™åˆ¶ï¼Œè½‰ç§»æ³¨æ„åŠ›åˆ°æˆå“¡è³‡æ ¼å•é¡Œï¼Œè€ŒéçœŸæ­£çš„æ¬Šé™é™åˆ¶ã€‚

```python
# å³ä½¿ç”¨æˆ¶æ˜¯ç¾¤çµ„æˆå“¡ï¼Œä¹Ÿç„¡æ³•å°‡ Owner è½‰ç§»çµ¦ç¾¤çµ„
user = "engineer@company.com"
user_groups = ["DevOps", "DataEngineering"]  # ç”¨æˆ¶æ‰€å±¬ç¾¤çµ„

# ä»¥ä¸‹æ“ä½œä»ç„¶æœƒå¤±æ•—ï¼ˆç„¡è«–ç”¨æˆ¶æ˜¯å¦ç‚º DevOps æˆå“¡ï¼‰
payload = {
    "access_control_list": [
        {
            "group_name": "DevOps",           # âŒ å¤±æ•—ï¼šç¾¤çµ„ä¸èƒ½æˆç‚º Owner
            "permission_level": "IS_OWNER"
        }
    ]
}
# éŒ¯èª¤è¨Šæ¯ï¼šGroups cannot be owners of jobs
```

---

### é¸é … Eï¼šåªæœ‰ç®¡ç†å“¡èƒ½æˆäºˆç¾¤çµ„ Owner æ¬Šé™

**ç‚ºä»€éº¼éŒ¯èª¤ï¼š**

1. **ç®¡ç†å“¡ä¹Ÿä¸èƒ½é•åè¦å‰‡**ï¼šå³ä½¿æ˜¯ Workspace ç®¡ç†å“¡ï¼Œä¹Ÿç„¡æ³•å°‡ Owner æ¬Šé™æˆäºˆç¾¤çµ„ï¼Œå› ç‚ºé€™é•åäº† Databricks çš„ç³»çµ±è¨­è¨ˆã€‚

2. **èª¤è§£ç®¡ç†å“¡æ¬Šé™**ï¼šç®¡ç†å“¡æœ‰æ›´é«˜çš„æ¬Šé™ï¼Œä½†ä¸èƒ½æ”¹è®Šç³»çµ±çš„åŸºæœ¬è¦å‰‡ï¼ˆç¾¤çµ„ä¸èƒ½æˆç‚º Ownerï¼‰ã€‚

3. **è½‰ç§»ç„¦é»**ï¼šé€™å€‹é¸é …å°‡å•é¡Œç„¦é»è½‰ç§»åˆ°ã€Œèª°å¯ä»¥åŸ·è¡Œæ“ä½œã€ï¼Œè€Œéã€Œæ“ä½œæœ¬èº«æ˜¯å¦å¯è¡Œã€ã€‚

**é™·é˜±è¨­è¨ˆï¼š**  
é€™å€‹é¸é …èª¤å°è€ƒç”Ÿä»¥ç‚ºæ˜¯ã€Œæ¬Šé™ä¸è¶³ã€çš„å•é¡Œï¼Œè€Œéã€Œç³»çµ±è¨­è¨ˆé™åˆ¶ã€çš„å•é¡Œã€‚

```python
# å³ä½¿æ˜¯ç®¡ç†å“¡ï¼Œä¹Ÿç„¡æ³•å°‡ Owner æ¬Šé™æˆäºˆç¾¤çµ„
# ç®¡ç†å“¡å¯ä»¥åšçš„ï¼š
# âœ… è½‰ç§» Owner çµ¦å…¶ä»–å€‹äººç”¨æˆ¶
# âœ… æˆäºˆç¾¤çµ„ Can Manage æˆ– Can View æ¬Šé™
# âœ… åˆªé™¤æˆ–ä¿®æ”¹ Job
# âŒ å°‡ç¾¤çµ„è¨­ç‚º Ownerï¼ˆç³»çµ±ä¸å…è¨±ï¼‰

# ç®¡ç†å“¡å˜—è©¦å°‡ç¾¤çµ„è¨­ç‚º Owner ä¹Ÿæœƒå¤±æ•—
# éŒ¯èª¤è¨Šæ¯é¡ä¼¼ï¼š
# "Error: Groups cannot be assigned as job owners. 
#  Please specify an individual user."
```

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€ŒJob Owner å¿…å”¯ä¸€ï¼Œç¾¤çµ„åªèƒ½ç®¡ä¸èƒ½æ“ã€**

- **Job Owner å¿…å”¯ä¸€** - æ¯å€‹ Job å¿…é ˆæœ‰ä¸€å€‹å”¯ä¸€çš„ Owner
- **ç¾¤çµ„åªèƒ½ç®¡** - ç¾¤çµ„å¯ä»¥æœ‰ Can Manage æ¬Šé™
- **ä¸èƒ½æ“** - ç¾¤çµ„ä¸èƒ½æˆç‚º Owner

### å°æ¯”è¡¨ï¼šJob æ¬Šé™å±¤ç´š

| æ¬Šé™å±¤ç´š | å€‹äººç”¨æˆ¶ | ç¾¤çµ„ | å¯åŸ·è¡Œæ“ä½œ |
|---------|---------|------|-----------|
| **IS_OWNER** | âœ… | âŒ | å®Œæ•´æ§åˆ¶ï¼ˆä¿®æ”¹ã€åˆªé™¤ã€ç®¡ç†æ¬Šé™ã€è½‰ç§»æ‰€æœ‰æ¬Šï¼‰ |
| **CAN_MANAGE** | âœ… | âœ… | ä¿®æ”¹é…ç½®ã€åŸ·è¡Œã€ç®¡ç†æ¬Šé™ï¼ˆä¸å«è½‰ç§»æ‰€æœ‰æ¬Šèˆ‡åˆªé™¤ï¼‰ |
| **CAN_VIEW** | âœ… | âœ… | æŸ¥çœ‹é…ç½®èˆ‡åŸ·è¡Œæ­·å² |
| **CAN_MANAGE_RUN** | âœ… | âœ… | åŸ·è¡Œ Jobã€å–æ¶ˆåŸ·è¡Œ |
| **CAN_VIEW_RUN** | âœ… | âœ… | æŸ¥çœ‹åŸ·è¡Œæ­·å² |

### æ±ºç­–æ¨¹ï¼šJob Owner è½‰ç§»

```
éœ€è¦è½‰ç§» Job æ‰€æœ‰æ¬Šï¼Ÿ
â”‚
â”œâ”€ è½‰ç§»çµ¦å€‹äººç”¨æˆ¶ï¼Ÿ
â”‚  â”œâ”€ æ˜¯ â†’ âœ… å¯ä»¥åŸ·è¡Œ
â”‚  â”‚       æ–¹æ³•ï¼šUI æˆ– API è®Šæ›´ Owner
â”‚  â”‚
â”‚  â””â”€ å¦ï¼ˆè½‰ç§»çµ¦ç¾¤çµ„ï¼‰â†’ âŒ ä¸å¯è¡Œ
â”‚                         åŸå› ï¼šç¾¤çµ„ä¸èƒ½æˆç‚º Owner
â”‚                         æ›¿ä»£æ–¹æ¡ˆï¼šæˆäºˆç¾¤çµ„ Can Manage æ¬Šé™
â”‚
â””â”€ éœ€è¦ç¾¤çµ„ç®¡ç† Jobï¼Ÿ
   â””â”€ æˆäºˆ Can Manage æ¬Šé™ âœ…
      æ–¹æ³•ï¼šåœ¨ Permissions ä¸­æ–°å¢ç¾¤çµ„ä¸¦é¸æ“‡ Can Manage
```

### è¨˜æ†¶è¦é»

1. **Owner = å€‹äººç”¨æˆ¶**ï¼šJob çš„ Owner åªèƒ½æ˜¯å€‹äººç”¨æˆ¶
2. **ç¾¤çµ„å¯ç®¡ç†**ï¼šç¾¤çµ„å¯ä»¥æœ‰ Can Manage æ¬Šé™ï¼ˆæ¬¡ä½³æ–¹æ¡ˆï¼‰
3. **Owner å¯è½‰ç§»**ï¼šOwner æ¬Šé™å¯ä»¥è½‰ç§»çµ¦å…¶ä»–å€‹äººç”¨æˆ¶
4. **ç®¡ç†å“¡ç„¡è±å…**ï¼šå³ä½¿æ˜¯ç®¡ç†å“¡ä¹Ÿä¸èƒ½å°‡ç¾¤çµ„è¨­ç‚º Owner

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

### ä¸»è¦åƒè€ƒ
1. **Databricks Jobs æ¬Šé™æ–‡ä»¶**  
   [Job permissions](https://docs.databricks.com/security/auth-authz/access-control/jobs-acl.html)

2. **æ¬Šé™ç®¡ç† API**  
   [Permissions API](https://docs.databricks.com/dev-tools/api/latest/permissions.html)

### å»¶ä¼¸é–±è®€
3. **Databricks Workflows æ¦‚è¦½**  
   [Introduction to Databricks Workflows](https://docs.databricks.com/workflows/index.html)

4. **å­˜å–æ§åˆ¶æœ€ä½³å¯¦è¸**  
   [Access Control Best Practices](https://docs.databricks.com/security/auth-authz/access-control/index.html)

---

## ğŸ“ å­¸ç¿’å»ºè­°

1. **ç†è§£æ¬Šé™å±¤ç´š**ï¼šç†Ÿæ‚‰ Job çš„å„ç¨®æ¬Šé™å±¤ç´šåŠå…¶å·®ç•°ï¼ˆOwner, Can Manage, Can Viewï¼‰ã€‚

2. **å¯¦é©—æ¬Šé™ç®¡ç†**ï¼šåœ¨æ¸¬è©¦ç’°å¢ƒä¸­å»ºç«‹ Jobï¼Œå˜—è©¦æˆäºˆä¸åŒç”¨æˆ¶èˆ‡ç¾¤çµ„ä¸åŒçš„æ¬Šé™ã€‚

3. **æŒæ¡ API æ“ä½œ**ï¼šç†Ÿæ‚‰ä½¿ç”¨ Permissions API ä¾†ç¨‹å¼åŒ–ç®¡ç† Job æ¬Šé™ã€‚

4. **å€åˆ†ç‰©ä»¶é¡å‹**ï¼šäº†è§£ä¸åŒ Databricks ç‰©ä»¶ï¼ˆJobs, Notebooks, Clustersï¼‰çš„æ¬Šé™æ¨¡å‹å·®ç•°ã€‚

5. **è¦åŠƒæ¬Šé™æ¶æ§‹**ï¼šè¨­è¨ˆåˆç†çš„æ¬Šé™æ¶æ§‹ï¼Œå¹³è¡¡å€‹äººæ‰€æœ‰æ¬Šèˆ‡åœ˜éšŠå”ä½œéœ€æ±‚ã€‚

---

## ğŸ’¡ å¯¦å‹™æç¤º

### æœ€ä½³å¯¦è¸ï¼šJob æ‰€æœ‰æ¬Šç®¡ç†

```python
"""
å»ºè­°çš„ Job æ‰€æœ‰æ¬Šç­–ç•¥
"""

# ç­–ç•¥ 1ï¼šä½¿ç”¨æœå‹™å¸³è™Ÿä½œç‚º Owner
# - å»ºç«‹å°ˆç”¨çš„æœå‹™å¸³è™Ÿï¼ˆå¦‚ svc-databricks@company.comï¼‰
# - å°‡æœå‹™å¸³è™Ÿè¨­ç‚º Job Owner
# - åœ˜éšŠæˆå“¡é€éç¾¤çµ„ç²å¾— Can Manage æ¬Šé™
# å„ªé»ï¼šé¿å…å› äººå“¡ç•°å‹•å°è‡´çš„æ‰€æœ‰æ¬Šå•é¡Œ

service_account = "svc-data-engineering@company.com"
team_group = "DataEngineering"

payload = {
    "access_control_list": [
        {
            "user_name": service_account,       # æœå‹™å¸³è™Ÿä½œç‚º Owner
            "permission_level": "IS_OWNER"
        },
        {
            "group_name": team_group,           # åœ˜éšŠç¾¤çµ„ç²å¾—ç®¡ç†æ¬Šé™
            "permission_level": "CAN_MANAGE"
        }
    ]
}

# ç­–ç•¥ 2ï¼šä½¿ç”¨æŠ€è¡“ä¸»ç®¡ä½œç‚º Owner
# - Tech Lead æˆ– Team Lead ä½œç‚º Owner
# - åœ˜éšŠæˆå“¡é€éç¾¤çµ„ç²å¾— Can Manage æ¬Šé™
# å„ªé»ï¼šæ¸…æ¥šçš„è²¬ä»»æ­¸å±¬

tech_lead = "tech-lead@company.com"
team_group = "DataEngineering"

payload = {
    "access_control_list": [
        {
            "user_name": tech_lead,             # Tech Lead ä½œç‚º Owner
            "permission_level": "IS_OWNER"
        },
        {
            "group_name": team_group,           # åœ˜éšŠç¾¤çµ„ç²å¾—ç®¡ç†æ¬Šé™
            "permission_level": "CAN_MANAGE"
        }
    ]
}

# ç­–ç•¥ 3ï¼šæŒ‰è·è²¬åˆ†é…æ¬Šé™
# - Ownerï¼šå° Job è² è²¬çš„å€‹äºº
# - Can Manageï¼šéœ€è¦ä¿®æ”¹ Job çš„åœ˜éšŠæˆå“¡
# - Can Viewï¼šéœ€è¦ç›£æ§ Job çš„ç›¸é—œäººå“¡

payload = {
    "access_control_list": [
        {
            "user_name": "job-owner@company.com",
            "permission_level": "IS_OWNER"
        },
        {
            "group_name": "DataEngineers",       # å·¥ç¨‹å¸«å¯ä»¥ç®¡ç†
            "permission_level": "CAN_MANAGE"
        },
        {
            "group_name": "DataAnalysts",        # åˆ†æå¸«åªèƒ½æŸ¥çœ‹
            "permission_level": "CAN_VIEW"
        }
    ]
}
```

### å¸¸è¦‹å ´æ™¯è™•ç†

```python
# å ´æ™¯ 1ï¼šå·¥ç¨‹å¸«é›¢è·ï¼Œéœ€è¦è½‰ç§» Job æ‰€æœ‰æ¬Š
# è§£æ±ºæ–¹æ¡ˆï¼šåœ¨é›¢è·å‰å°‡æ‰€æœ‰ Job è½‰ç§»çµ¦å…¶ä»–å·¥ç¨‹å¸«æˆ–æœå‹™å¸³è™Ÿ

def transfer_jobs_on_offboarding(old_owner, new_owner, workspace_url, token):
    """
    è½‰ç§»ç”¨æˆ¶æ‰€æ“æœ‰çš„æ‰€æœ‰ Jobs
    """
    import requests
    
    # 1. åˆ—å‡ºæ‰€æœ‰ Jobs
    response = requests.get(
        f"{workspace_url}/api/2.1/jobs/list",
        headers={"Authorization": f"Bearer {token}"}
    )
    jobs = response.json().get("jobs", [])
    
    # 2. ç¯©é¸å‡º old_owner æ“æœ‰çš„ Jobs
    for job in jobs:
        job_id = job["job_id"]
        
        # æª¢æŸ¥ Owner
        perms = requests.get(
            f"{workspace_url}/api/2.0/permissions/jobs/{job_id}",
            headers={"Authorization": f"Bearer {token}"}
        ).json()
        
        for acl in perms.get("access_control_list", []):
            if acl.get("user_name") == old_owner and \
               "IS_OWNER" in [p["permission_level"] for p in acl.get("all_permissions", [])]:
                
                # 3. è½‰ç§» Owner
                print(f"è½‰ç§» Job {job_id} çš„æ‰€æœ‰æ¬Šå¾ {old_owner} åˆ° {new_owner}")
                
                requests.put(
                    f"{workspace_url}/api/2.0/permissions/jobs/{job_id}",
                    headers={"Authorization": f"Bearer {token}"},
                    json={
                        "access_control_list": [
                            {
                                "user_name": new_owner,
                                "permission_level": "IS_OWNER"
                            }
                        ]
                    }
                )

# å ´æ™¯ 2ï¼šåœ˜éšŠå¸Œæœ›å…±åŒç®¡ç† Job
# è§£æ±ºæ–¹æ¡ˆï¼šä¿ç•™ä¸€å€‹ Ownerï¼Œçµ¦åœ˜éšŠç¾¤çµ„ Can Manage æ¬Šé™

def setup_team_job_permissions(job_id, owner, team_group, workspace_url, token):
    """
    è¨­å®š Job ç‚ºåœ˜éšŠå…±åŒç®¡ç†æ¨¡å¼
    """
    import requests
    
    payload = {
        "access_control_list": [
            {
                "user_name": owner,              # å–®ä¸€ Owner
                "permission_level": "IS_OWNER"
            },
            {
                "group_name": team_group,        # åœ˜éšŠå¯ä»¥ç®¡ç†
                "permission_level": "CAN_MANAGE"
            }
        ]
    }
    
    response = requests.put(
        f"{workspace_url}/api/2.0/permissions/jobs/{job_id}",
        headers={"Authorization": f"Bearer {token}"},
        json=payload
    )
    
    if response.status_code == 200:
        print(f"æˆåŠŸè¨­å®š Job {job_id} çš„åœ˜éšŠæ¬Šé™")
    else:
        print(f"å¤±æ•—: {response.text}")
```

### æ¬Šé™å¯©è¨ˆ

```python
def audit_job_ownership(workspace_url, token):
    """
    å¯©è¨ˆæ‰€æœ‰ Jobs çš„æ‰€æœ‰æ¬Šï¼Œè­˜åˆ¥æ½›åœ¨å•é¡Œ
    """
    import requests
    from collections import defaultdict
    
    # åˆ—å‡ºæ‰€æœ‰ Jobs
    response = requests.get(
        f"{workspace_url}/api/2.1/jobs/list",
        headers={"Authorization": f"Bearer {token}"}
    )
    jobs = response.json().get("jobs", [])
    
    ownership_stats = defaultdict(int)
    no_owner_jobs = []
    
    for job in jobs:
        job_id = job["job_id"]
        job_name = job["settings"]["name"]
        
        # å–å¾—æ¬Šé™
        perms = requests.get(
            f"{workspace_url}/api/2.0/permissions/jobs/{job_id}",
            headers={"Authorization": f"Bearer {token}"}
        ).json()
        
        # å°‹æ‰¾ Owner
        owner = None
        for acl in perms.get("access_control_list", []):
            for perm in acl.get("all_permissions", []):
                if perm["permission_level"] == "IS_OWNER":
                    owner = acl.get("user_name")
                    break
        
        if owner:
            ownership_stats[owner] += 1
        else:
            no_owner_jobs.append((job_id, job_name))
    
    # å ±å‘Š
    print("=== Job æ‰€æœ‰æ¬Šå¯©è¨ˆå ±å‘Š ===\n")
    
    print("å„ç”¨æˆ¶æ“æœ‰çš„ Jobs æ•¸é‡ï¼š")
    for owner, count in sorted(ownership_stats.items(), key=lambda x: -x[1]):
        print(f"  {owner}: {count} å€‹ Jobs")
    
    if no_owner_jobs:
        print("\nâš ï¸ è­¦å‘Šï¼šä»¥ä¸‹ Jobs æ²’æœ‰æ˜ç¢ºçš„ Ownerï¼š")
        for job_id, job_name in no_owner_jobs:
            print(f"  Job ID {job_id}: {job_name}")
    
    print("\nå»ºè­°ï¼š")
    print("- è€ƒæ…®ä½¿ç”¨æœå‹™å¸³è™Ÿåˆ†æ•£æ‰€æœ‰æ¬Š")
    print("- ç¢ºä¿æ¯å€‹ Job éƒ½æœ‰æ˜ç¢ºçš„ Owner")
    print("- æˆäºˆåœ˜éšŠç¾¤çµ„ Can Manage æ¬Šé™ä»¥å¯¦ç¾å”ä½œ")

# åŸ·è¡Œå¯©è¨ˆ
# audit_job_ownership(workspace_url, token)
```

---

## ğŸ”— ç›¸é—œé¡Œç›®

- Q-XXX: Databricks Notebooks æ¬Šé™ç®¡ç†
- Q-XXX: Unity Catalog æ¬Šé™æ¨¡å‹
- Q-XXX: Cluster å­˜å–æ§åˆ¶
- Q-XXX: Secret Scopes æ¬Šé™ç®¡ç†

---

**æœ€å¾Œæ›´æ–°:** 2026-01-15
