# Q-084

## 題目資訊

**ID:** `Q-084`  
**來源:** Official Practice Exam  
**難度:** `L2-Intermediate`

---

## 題目內容

### 題幹

The data architect has decided that once data has been ingested from external sources into the Databricks Lakehouse, table access controls will be leveraged to manage permissions for all production tables and views.

The following logic was executed to grant privileges for interactive queries on a production database to the core engineering group:

```sql
GRANT USAGE ON DATABASE prod TO eng;
GRANT SELECT ON DATABASE prod TO eng;
```

Assuming these are the only privileges that have been granted to the eng group and that these users are not workspace administrators, which statement describes their privileges?

### 選項

- **A.** Group members have full permissions on the prod database and can also assign permissions to other users or groups.
- **B.** Group members are able to list all tables in the prod database but are not able to see the results of any queries on those tables.
- **C.** Group members are able to query and modify all tables and views in the prod database, but cannot create new tables or views.
- **D.** Group members are able to query all tables and views in the prod database, but cannot create or edit anything in the database.
- **E.** Group members are able to create, query, and modify all tables and views in the prod database, but cannot define custom functions.

---

## 標籤系統

**Topics:** `Unity-Catalog`, `UC-Permissions`, `Access-Control`  
**Traps:** `Permission-Scope`  
**Domain:** `Security & Governance`

---

## 官方答案與社群討論

**官方標註答案:** E  
**社群投票結果:** D (100%)

---

## 📍 考點識別

### 主要考點
**核心技術:** Unity Catalog 權限管理（GRANT/REVOKE）  
**知識領域:** 安全與治理（Security & Governance）  
**關鍵概念:** 
- USAGE 權限的作用範圍
- SELECT 權限的功能限制
- 權限累加原則（Least Privilege）

### 次要考點
- Database 層級權限 vs Table 層級權限
- 權限授予的最小化原則（Principle of Least Privilege）
- Workspace Administrator 權限對比

---

## ✅ 正解說明

### 為什麼 D 是正確的？（社群 100% 共識）

**技術原理:**

Unity Catalog 的權限系統遵循「明確授予」原則：
```sql
GRANT USAGE ON DATABASE prod TO eng;
-- ↑ 允許使用資料庫（必要前提）
--   可以：列出資料庫中的物件（表格、視圖）
--   不可以：建立、修改、刪除物件

GRANT SELECT ON DATABASE prod TO eng;
-- ↑ 允許查詢資料
--   可以：對資料庫中的表格執行 SELECT 查詢
--   不可以：INSERT、UPDATE、DELETE、MERGE
```

**權限對照表:**

| 權限 | 已授予？ | 可執行操作 |
|-----|---------|-----------|
| `USAGE` | ✅ | 列出資料庫、存取物件 |
| `SELECT` | ✅ | 查詢資料（SELECT） |
| `MODIFY` | ❌ | 修改資料（INSERT/UPDATE/DELETE） |
| `CREATE` | ❌ | 建立表格、視圖、函數 |
| `ALL PRIVILEGES` | ❌ | 完整控制權限 |

**符合需求:**

選項 D 的描述：「可以查詢所有表格和視圖，但不能建立或編輯任何東西」

- ✅ **可以查詢** - 有 SELECT 權限
- ✅ **不能建立** - 缺少 CREATE 權限
- ✅ **不能編輯** - 缺少 MODIFY 權限

**實務應用:**

這是典型的「唯讀使用者」配置：
```sql
-- 資料分析師的標準權限配置
GRANT USAGE ON DATABASE analytics TO analyst_group;
GRANT SELECT ON DATABASE analytics TO analyst_group;

-- 結果：分析師可以跑查詢，但無法修改資料
SELECT * FROM analytics.sales_data WHERE date = '2024-01-01';  -- ✅ 允許

INSERT INTO analytics.sales_data VALUES (...);  -- ❌ 拒絕
CREATE TABLE analytics.new_table AS ...;        -- ❌ 拒絕
```

---

## ❌ 錯誤選項排除

### 選項 A：完全權限 + 分配權限給他人

**錯誤原因:**
```sql
-- 完全權限需要：
GRANT ALL PRIVILEGES ON DATABASE prod TO eng;
-- 或明確授予所有權限：
GRANT USAGE, SELECT, MODIFY, CREATE ON DATABASE prod TO eng;

-- 分配權限給他人需要：
GRANT ... WITH GRANT OPTION;
-- 例如：
GRANT SELECT ON DATABASE prod TO eng WITH GRANT OPTION;
```

**實際狀況:**
1. ❌ 只有 USAGE + SELECT，不是 ALL PRIVILEGES
2. ❌ 沒有 WITH GRANT OPTION，無法授予權限給其他使用者
3. ❌ 缺少 MODIFY、CREATE、DELETE 等權限

---

### 選項 B：可列出表格但不能看查詢結果

**錯誤原因:**
```sql
-- 如果只授予 USAGE：
GRANT USAGE ON DATABASE prod TO eng;  -- 只能列出物件

SHOW TABLES IN prod;           -- ✅ 可以
SELECT * FROM prod.table1;     -- ❌ 不行（需要 SELECT 權限）

-- 但題目明確授予了 SELECT！
GRANT SELECT ON DATABASE prod TO eng;  -- 可以查詢資料

SELECT * FROM prod.table1;     -- ✅ 現在可以了！
```

**概念混淆:**
- USAGE 單獨使用時，確實只能列出物件
- 但題目授予了 **USAGE + SELECT**，所以可以看查詢結果

---

### 選項 C：可查詢和修改，但不能建立

**錯誤原因:**
```sql
-- 修改資料需要 MODIFY 權限：
GRANT MODIFY ON DATABASE prod TO eng;  -- ← 題目沒有授予！

-- 實際權限測試：
SELECT * FROM prod.sales;                    -- ✅ 有 SELECT
INSERT INTO prod.sales VALUES (...);         -- ❌ 無 MODIFY
UPDATE prod.sales SET amount = 100 WHERE ...; -- ❌ 無 MODIFY
DELETE FROM prod.sales WHERE ...;            -- ❌ 無 MODIFY
```

**陷阱設計:**
- 考生可能誤以為「可以查詢」就能「修改」
- 實際上 SELECT（讀取）和 MODIFY（寫入）是完全獨立的權限

---

### 選項 E：可建立、查詢、修改，但不能定義 UDF（官方答案，但錯誤）

**為什麼官方答案錯誤:**

```sql
-- 建立表格需要 CREATE 權限：
GRANT CREATE ON DATABASE prod TO eng;  -- ← 題目沒有！

-- 修改資料需要 MODIFY 權限：
GRANT MODIFY ON DATABASE prod TO eng;  -- ← 題目沒有！

-- 實際測試：
SELECT * FROM prod.sales;                     -- ✅ 有 SELECT
CREATE TABLE prod.new_table (id INT);         -- ❌ 無 CREATE
INSERT INTO prod.sales VALUES (...);          -- ❌ 無 MODIFY
CREATE FUNCTION prod.my_udf() RETURNS ...;    -- ❌ 無 CREATE
```

**官方答案的邏輯錯誤:**
1. ❌ 題目只授予 USAGE + SELECT
2. ❌ 沒有 CREATE 權限，無法建立任何東西（包括表格、視圖、UDF）
3. ❌ 沒有 MODIFY 權限，無法修改資料
4. ✅ 社群 100% 投票 D，證明官方答案有誤

---

## 🧠 記憶法與最佳實踐

### 口訣：「USAGE 開門，SELECT 看書，MODIFY 寫字，CREATE 蓋房」

| 權限 | 功能隱喻 | 實際作用 | SQL 範例 |
|-----|---------|---------|---------|
| **USAGE** | 🚪 開門進入 | 必要前提，可列出物件 | `SHOW TABLES` |
| **SELECT** | 📖 看書閱讀 | 查詢資料 | `SELECT * FROM ...` |
| **MODIFY** | ✍️ 寫字編輯 | 修改資料 | `INSERT/UPDATE/DELETE` |
| **CREATE** | 🏗️ 蓋房建設 | 建立物件 | `CREATE TABLE/VIEW` |

### Unity Catalog 權限層級

```
Database 層級權限（會繼承到下層物件）
├── USAGE        - 基礎存取權（必要前提）
├── SELECT       - 查詢資料（唯讀）
├── MODIFY       - 修改資料（寫入）
├── CREATE       - 建立新物件
└── ALL PRIVILEGES - 完整控制

特殊選項：
├── WITH GRANT OPTION - 可授予權限給他人
└── DENY              - 明確拒絕（優先於 GRANT）
```

### 常見權限組合模式

| 角色 | 權限組合 | 用途 |
|-----|---------|-----|
| **資料分析師** | USAGE + SELECT | 唯讀查詢 |
| **資料工程師** | USAGE + SELECT + MODIFY | 可修改資料 |
| **專案負責人** | USAGE + SELECT + MODIFY + CREATE | 完整開發權限 |
| **管理員** | ALL PRIVILEGES WITH GRANT OPTION | 完整控制 + 授權 |

### 實務範例

```sql
-- 場景：設定不同團隊的權限

-- 1. 分析團隊（唯讀）
GRANT USAGE ON DATABASE prod TO analysts;
GRANT SELECT ON DATABASE prod TO analysts;

-- 2. ETL 團隊（可寫入，但不能建立新表）
GRANT USAGE ON DATABASE staging TO etl_team;
GRANT SELECT ON DATABASE staging TO etl_team;
GRANT MODIFY ON DATABASE staging TO etl_team;

-- 3. 資深工程師（完整開發權限）
GRANT USAGE ON DATABASE dev TO senior_eng;
GRANT SELECT ON DATABASE dev TO senior_eng;
GRANT MODIFY ON DATABASE dev TO senior_eng;
GRANT CREATE ON DATABASE dev TO senior_eng;

-- 4. 檢查權限
SHOW GRANTS ON DATABASE prod;
```

---

## 📚 延伸閱讀

### 官方文件
1. [Unity Catalog Privileges](https://docs.databricks.com/data-governance/unity-catalog/manage-privileges/privileges.html)
2. [GRANT Statement](https://docs.databricks.com/sql/language-manual/security-grant.html)
3. [Access Control Best Practices](https://docs.databricks.com/security/access-control/index.html)

### 權限管理核心概念

**最小權限原則（Principle of Least Privilege）:**
- 只授予完成工作所需的最小權限
- 避免過度授權（如本題只需 SELECT，不應給 MODIFY）

**權限繼承（Privilege Inheritance）:**
```
Catalog
  └── Database (GRANT USAGE + SELECT)
        ├── Table1     ← 自動繼承 SELECT
        ├── Table2     ← 自動繼承 SELECT
        └── View1      ← 自動繼承 SELECT
```

**權限檢查指令:**
```sql
-- 查看使用者權限
SHOW GRANTS ON DATABASE prod;
SHOW GRANTS ON TABLE prod.sales;

-- 查看誰有權限
SHOW GRANTS ON DATABASE prod FOR USER john.doe;
SHOW GRANTS ON DATABASE prod FOR GROUP eng;
```

---

## 🎯 考試建議

**記憶重點:**
1. ✅ **USAGE** 是前提（沒有 USAGE，其他權限無效）
2. ✅ **SELECT** = 唯讀（只能查詢，不能修改）
3. ✅ **MODIFY** = 寫入（INSERT/UPDATE/DELETE）
4. ✅ **CREATE** = 建立物件（TABLE/VIEW/FUNCTION）

**快速判斷法:**
```
題目授予的權限 → 檢查清單
✅ USAGE?  → 可以列出物件
✅ SELECT? → 可以查詢資料
❌ MODIFY? → 不能修改資料
❌ CREATE? → 不能建立新物件

結論：只能查詢，不能建立或編輯 → 答案 D
```

**陷阱識別:**
- ⚠️ 選項 E 誤導「可以建立和修改」（沒有對應權限！）
- ⚠️ 選項 C 誤導「可以修改」（缺少 MODIFY 權限）
- ⚠️ 選項 A 誤導「完整權限」（只是部分權限）

**核心觀念:**
✅ 權限必須明確授予，不會自動擁有  
✅ SELECT（讀）和 MODIFY（寫）是獨立的  
✅ 社群 100% 投票 D，官方答案 E 有誤
