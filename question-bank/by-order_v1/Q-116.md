# Question #116

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-116`

### ä¾†æº
**ä¾†æº:** Mock Exam / Community Contributed

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

The data engineering team is configuring environments for **development, testing, and production** before beginning migration on a new data pipeline. The team requires **extensive testing** on both the code and data resulting from code execution, and the team wants to **develop and test against data as similar to production data as possible**.

A junior data engineer suggests that **production data can be mounted** to the development and testing environments, allowing pre-production code to execute against production data. Because all users have **admin privileges in the development environment**, the junior data engineer has offered to configure permissions and mount this data for the team.

Which statement captures **best practices** for this situation?

### é¸é …

- **A.** All development, testing, and production code and data should exist in a **single, unified workspace**; creating separate environments for testing and development complicates administrative overhead
- **B.** In environments where **interactive code will be executed**, production data should only be accessible with **read permissions**; creating **isolated databases for each environment** further reduces risks
- **C.** As long as code in the development environment declares `USE dev_db` at the top of each notebook, there is no possibility of inadvertently committing changes back to production data sources
- **D.** Because **Delta Lake versions all data** and supports **time travel**, it is not possible for user error or malicious actors to permanently delete production data; as such, it is generally safe to mount production data anywhere
- **E.** Because access to production data will always be verified using **passthrough credentials**, it is safe to mount data to any Databricks development environment

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Environment-Isolation`, `Security`, `Access-Control`, `Best-Practices`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Security-Overconfidence`, `Delta-Time-Travel-Limitation`, `Permission-Management`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Security & Governance

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `B`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** B
- **ç¤¾ç¾¤å…±è­˜:** B (100%)

### ç¤¾ç¾¤è¨è«–é‡é»
- **MDWPartners:** "Selected Answer: B Seems right"
- **åˆ†æè£œå……:** æ­¤é¡Œè€ƒæŸ¥ Databricks ç’°å¢ƒéš”é›¢èˆ‡è³‡æ–™å­˜å–çš„æœ€ä½³å¯¦è¸ã€‚åœ¨éç”Ÿç”¢ç’°å¢ƒï¼ˆå¦‚é–‹ç™¼ç’°å¢ƒï¼‰ä¸­ï¼Œé›–ç„¶é–‹ç™¼è€…éœ€è¦å­˜å–é¡ä¼¼ç”Ÿç”¢ç’°å¢ƒçš„è³‡æ–™é€²è¡Œæ¸¬è©¦ï¼Œä½†ç‚ºäº†é˜²æ­¢æ„å¤–ä¿®æ”¹æˆ–åˆªé™¤ç”Ÿç”¢è³‡æ–™ï¼Œå¿…é ˆåš´æ ¼é™åˆ¶åƒ…èƒ½ä»¥ã€Œå”¯è®€ï¼ˆRead-Onlyï¼‰ã€æ¬Šé™å­˜å–ç”Ÿç”¢è³‡æ–™ï¼Œä¸¦ä¸”æœ€å¥½å°‡å„ç’°å¢ƒçš„è³‡æ–™åº«ï¼ˆDatabase/Schemaï¼‰é€²è¡Œéš”é›¢

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Environment Isolation & Data Security  
**é—œéµæ¦‚å¿µ:** Least Privilege Principleã€ç’°å¢ƒéš”é›¢ã€å”¯è®€æ¬Šé™

**é¡Œç›®é—œéµå­—ï¼š**
- **Development, testing, production** (å¤šç’°å¢ƒç®¡ç†)
- **Admin privileges** (éé«˜æ¬Šé™)
- **Mount production data** (æ›è¼‰ç”Ÿç”¢è³‡æ–™)
- **Best practices** (æœ€ä½³å¯¦å‹™)

**è€ƒç¶±å°æ‡‰:**
- Part 3: å®‰å…¨èˆ‡æ²»ç† â†’ Access Control & Environment Isolation
- Part 2: ç¶­é‹èˆ‡è‡ªå‹•åŒ– â†’ Environment Management

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ B (Read-only + Isolated databases) æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

**æœ€å°æ¬Šé™åŸå‰‡ï¼ˆLeast Privilege Principleï¼‰ï¼š**

```sql
-- âœ… æ­£ç¢ºåšæ³•ï¼šé–‹ç™¼ç’°å¢ƒåƒ…æœ‰å”¯è®€æ¬Šé™
GRANT SELECT ON DATABASE production_db TO `dev_group`;

-- âŒ éŒ¯èª¤åšæ³•ï¼šé–‹ç™¼ç’°å¢ƒæœ‰å¯«å…¥æ¬Šé™
GRANT ALL PRIVILEGES ON DATABASE production_db TO `dev_group`;
```

**ç’°å¢ƒéš”é›¢æ¶æ§‹ï¼š**

```
ğŸ“¦ Production Environment
 â”œâ”€â”€ production_db (å®Œæ•´æ¬Šé™çµ¦ production_group)
 â”‚   â”œâ”€â”€ customers (ç”Ÿç”¢è³‡æ–™)
 â”‚   â””â”€â”€ transactions
 â”‚
 â””â”€â”€ READ-ONLY Access for dev/test groups âœ…

ğŸ“¦ Testing Environment
 â”œâ”€â”€ test_db (ç¨ç«‹è³‡æ–™åº«)
 â”‚   â”œâ”€â”€ customers (å¾ production è¤‡è£½/å–æ¨£)
 â”‚   â””â”€â”€ transactions
 â”‚
 â””â”€â”€ Full permissions for test_group

ğŸ“¦ Development Environment
 â”œâ”€â”€ dev_db (ç¨ç«‹è³‡æ–™åº«)
 â”‚   â”œâ”€â”€ customers (å¾ production è¤‡è£½/å–æ¨£)
 â”‚   â””â”€â”€ transactions
 â”‚
 â””â”€â”€ Full permissions for dev_group
```

**é¸é … B çš„å…©å€‹é—œéµå¯¦å‹™ï¼š**

### 1. **ç”Ÿç”¢è³‡æ–™å”¯è®€ï¼ˆRead-only Accessï¼‰**

**å¯¦ä½œæ–¹å¼ï¼š**

```sql
-- Unity Catalog æ¬Šé™è¨­å®š
GRANT SELECT ON SCHEMA production.gold TO `dev_users`;
DENY INSERT, UPDATE, DELETE ON SCHEMA production.gold TO `dev_users`;

-- æˆ–ä½¿ç”¨ Read-only External Location
CREATE EXTERNAL LOCATION prod_readonly
URL 's3://prod-bucket/'
WITH (READ ONLY)  -- å¼·åˆ¶å”¯è®€
CREDENTIAL prod_readonly_credential;
```

**ç‚ºä»€éº¼å¿…é ˆå”¯è®€ï¼Ÿ**

| é¢¨éšª | èªªæ˜ | å”¯è®€é˜²è­· |
|------|------|----------|
| **æ„å¤–ä¿®æ”¹** | é–‹ç™¼è€…èª¤åŸ·è¡Œ UPDATE/DELETE | âœ… é˜»æ­¢å¯«å…¥æ“ä½œ |
| **è³‡æ–™æå£** | æ¸¬è©¦ç¨‹å¼ç¢¼æœ‰ bug å¯«å…¥éŒ¯èª¤è³‡æ–™ | âœ… ç„¡æ³•å¯«å…¥ |
| **åˆè¦é¢¨éšª** | éç”Ÿç”¢ç’°å¢ƒä¸æ‡‰ä¿®æ”¹ç”Ÿç”¢è³‡æ–™ | âœ… ç¬¦åˆ audit è¦æ±‚ |
| **å®‰å…¨äº‹æ•…** | é–‹ç™¼ç’°å¢ƒé€šå¸¸å®‰å…¨æ€§è¼ƒä½ | âœ… é™åˆ¶æå®³ç¯„åœ |

### 2. **ç’°å¢ƒè³‡æ–™åº«éš”é›¢ï¼ˆIsolated Databasesï¼‰**

**å¯¦ä½œæ–¹å¼ï¼š**

```sql
-- å»ºç«‹ç¨ç«‹çš„ç’°å¢ƒè³‡æ–™åº«
CREATE DATABASE dev_analytics;
CREATE DATABASE test_analytics;
CREATE DATABASE prod_analytics;

-- å¾ç”Ÿç”¢ç’°å¢ƒå–æ¨£è³‡æ–™åˆ°é–‹ç™¼ç’°å¢ƒ
CREATE TABLE dev_analytics.customers AS
SELECT * FROM prod_analytics.customers
WHERE created_date >= '2025-01-01'  -- åªå–è¿‘æœŸè³‡æ–™
TABLESAMPLE (10 PERCENT);            -- å–æ¨£ 10%

-- é–‹ç™¼è€…åœ¨ dev_db æœ‰å®Œæ•´æ¬Šé™
GRANT ALL PRIVILEGES ON DATABASE dev_analytics TO `dev_group`;
```

**ç‚ºä»€éº¼éœ€è¦éš”é›¢ï¼Ÿ**

| å„ªé» | èªªæ˜ |
|------|------|
| **é˜²æ­¢èª¤æ“ä½œ** | `USE dev_db` å¾Œä¸æœƒèª¤å¯«å…¥ prod_db |
| **ç¨ç«‹æ¸¬è©¦ç’°å¢ƒ** | å¯ä»¥è‡ªç”±ä¿®æ”¹ã€åˆªé™¤æ¸¬è©¦è³‡æ–™ |
| **æ•ˆèƒ½éš”é›¢** | é–‹ç™¼ç’°å¢ƒçš„å¤§æŸ¥è©¢ä¸å½±éŸ¿ç”Ÿç”¢ç’°å¢ƒ |
| **è³‡æ–™è„«æ•** | æ¸¬è©¦è³‡æ–™å¯ä»¥åšåŒ¿ååŒ–è™•ç† |

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A - Single unified workspace

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

```
âŒ é¸é … A çš„å»ºè­°ï¼š
æ‰€æœ‰ç’°å¢ƒæ”¾åœ¨å–®ä¸€ workspace ä¸­
```

**âŒ éŒ¯èª¤ç†ç”±ï¼š**

| å•é¡Œ | èªªæ˜ |
|------|------|
| **å¢åŠ é¢¨éšª** | é–‹ç™¼èˆ‡ç”Ÿç”¢æ··åœ¨ä¸€èµ·ï¼Œå®¹æ˜“èª¤æ“ä½œ |
| **æ¬Šé™ç®¡ç†å›°é›£** | é›£ä»¥ç²¾ç´°æ§åˆ¶ä¸åŒç’°å¢ƒçš„æ¬Šé™ |
| **ä¸ç¬¦åˆæœ€ä½³å¯¦å‹™** | æ¥­ç•Œæ¨™æº–æ˜¯ç’°å¢ƒéš”é›¢ï¼ˆdev/test/prodï¼‰ |
| **åˆè¦å•é¡Œ** | å¤šæ•¸åˆè¦è¦æ±‚ï¼ˆSOC 2ã€GDPRï¼‰éœ€è¦ç’°å¢ƒåˆ†é›¢ |

**çœŸç›¸ï¼š**

```
âœ… æ­£ç¢ºæ¶æ§‹ï¼šç’°å¢ƒåˆ†é›¢
Workspace: dev-workspace
â”œâ”€â”€ dev cluster
â””â”€â”€ dev databases

Workspace: test-workspace
â”œâ”€â”€ test cluster
â””â”€â”€ test databases

Workspace: prod-workspace (åš´æ ¼æ¬Šé™)
â”œâ”€â”€ prod cluster
â””â”€â”€ prod databases
```

---

### C - USE dev_db å°±å®‰å…¨

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

```sql
-- âŒ é¸é … C èªç‚ºé€™æ¨£å°±å®‰å…¨
USE dev_db;
-- ... é–‹ç™¼è€…çš„ç¨‹å¼ç¢¼
```

**âŒ éŒ¯èª¤ç†ç”±ï¼š**

| å•é¡Œ | èªªæ˜ |
|------|------|
| **å®¹æ˜“å¿˜è¨˜** | é–‹ç™¼è€…å¯èƒ½å¿˜è¨˜åŸ·è¡Œ `USE dev_db` |
| **Notebook é–“ä¸éš”é›¢** | ä¸åŒ notebook å¯èƒ½åˆ‡æ›è³‡æ–™åº« |
| **ç„¡æ³•é˜²æ­¢æ˜ç¢ºæŒ‡å®š** | ä»å¯åŸ·è¡Œ `DELETE FROM prod_db.table` |
| **äººç‚ºå¤±èª¤** | ç¨‹å¼ç¢¼ä¸­å¯èƒ½æœ‰å®Œæ•´è·¯å¾‘ `prod_db.customers` |

**çœŸå¯¦æ¡ˆä¾‹ï¼š**

```sql
-- Notebook Cell 1
USE dev_db;

-- Notebook Cell 2 (å¦ä¸€å€‹é–‹ç™¼è€…ä¿®æ”¹)
SELECT * FROM prod_db.transactions;  -- âŒ ä»å¯å­˜å– prod_db

-- Notebook Cell 3 (å¿˜è¨˜ç•¶å‰è³‡æ–™åº«)
DROP TABLE customers;  -- âŒ æœƒåˆªé™¤å“ªå€‹è³‡æ–™åº«çš„ tableï¼Ÿ
```

**æ­£ç¢ºåšæ³•ï¼š**

```sql
-- âœ… é€éæ¬Šé™é™åˆ¶ï¼Œè€Œéä¾è³´ç¨‹å¼ç¢¼æ…£ä¾‹
DENY ALL ON DATABASE prod_db TO `dev_group`;
```

---

### D - Delta Lake Time Travel å¯ä»¥é˜²è­·

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

```sql
-- âŒ é¸é … D èªç‚ºï¼šæœ‰ Time Travel å°±ä¸æ€•åˆªé™¤
```

**âŒ éŒ¯èª¤ç†ç”±ï¼š**

| å•é¡Œ | èªªæ˜ |
|------|------|
| **VACUUM æœƒæ°¸ä¹…åˆªé™¤** | åŸ·è¡Œ `VACUUM` å¾Œç„¡æ³• Time Travel å›å» |
| **DROP TABLE å¯èƒ½æ°¸ä¹…åˆªé™¤** | åˆªé™¤æ•´å€‹è³‡æ–™è¡¨çµæ§‹ |
| **æƒ¡æ„è¡Œç‚º** | æƒ¡æ„ä½¿ç”¨è€…å¯ä»¥å…ˆåˆªè³‡æ–™å† VACUUM |
| **Time Travel æœ‰é™åˆ¶** | é è¨­åªä¿ç•™ 30 å¤©ï¼ˆ`delta.deletedFileRetentionDuration`ï¼‰ |

**çœŸå¯¦å±éšªæƒ…å¢ƒï¼š**

```sql
-- æƒ…å¢ƒ 1ï¼šæƒ¡æ„åˆªé™¤ + VACUUM
DELETE FROM prod_db.transactions WHERE date > '2020-01-01';
VACUUM prod_db.transactions RETAIN 0 HOURS;  -- âŒ è³‡æ–™æ°¸ä¹…æ¶ˆå¤±

-- æƒ…å¢ƒ 2ï¼šDROP TABLE
DROP TABLE prod_db.customers;  -- âŒ Time Travel ç„¡æ³•æ¢å¾© metadata

-- æƒ…å¢ƒ 3ï¼šè¦†è“‹è³‡æ–™
INSERT OVERWRITE TABLE prod_db.transactions
SELECT * FROM fake_data;  -- âŒ é›–ç„¶å¯ä»¥ Time Travelï¼Œä½†å·²é€ æˆæ¥­å‹™æå¤±
```

**Time Travel çš„çœŸæ­£ç”¨é€”ï¼š**

```sql
-- âœ… Time Travel ç”¨æ–¼æŸ¥è©¢æ­·å²ç‰ˆæœ¬
SELECT * FROM customers VERSION AS OF 10;

-- âœ… æˆ–æ¢å¾©èª¤åˆªè³‡æ–™ï¼ˆVACUUM å‰ï¼‰
RESTORE TABLE customers TO VERSION AS OF 5;

-- âŒ ä½†ä¸èƒ½æ›¿ä»£æ¬Šé™æ§åˆ¶ï¼
```

---

### E - Passthrough credentials å°±å®‰å…¨

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

```
âŒ é¸é … E èªç‚ºï¼š
æœ‰ passthrough credentials å°±å¯ä»¥æ›è¼‰ç”Ÿç”¢è³‡æ–™åˆ°ä»»ä½•ç’°å¢ƒ
```

**âŒ éŒ¯èª¤ç†ç”±ï¼š**

| å•é¡Œ | èªªæ˜ |
|------|------|
| **æ¬Šé™ä»éœ€é…ç½®** | Passthrough åªæ˜¯é©—è­‰èº«ä»½ï¼Œä¸æ§åˆ¶æ¬Šé™ |
| **Admin privileges å•é¡Œ** | é¡Œç›®æåˆ°é–‹ç™¼ç’°å¢ƒæ‰€æœ‰äººéƒ½æœ‰ admin æ¬Šé™ |
| **ç„¡æ³•é™åˆ¶å¯«å…¥** | è‹¥åº•å±¤æ¬Šé™å…è¨±å¯«å…¥ï¼Œpassthrough ä¸æœƒé˜»æ­¢ |
| **ä¸æ˜¯å­˜å–æ§åˆ¶æ©Ÿåˆ¶** | Passthrough ç”¨æ–¼èº«ä»½é©—è­‰ï¼Œä¸æ˜¯æˆæ¬Š |

**æ¦‚å¿µé‡æ¸…ï¼š**

```
Passthrough Credentials çš„ä½œç”¨ï¼š
âœ… ä½¿ç”¨ã€Œå€‹äººçš„ã€é›²ç«¯å„²å­˜æ¬Šé™ï¼ˆS3/ADLS/GCSï¼‰
âœ… å¯©è¨ˆè¿½è¹¤åˆ°å€‹äººï¼ˆè€Œé service principalï¼‰

âŒ ä¸æœƒé™åˆ¶ï¼š
- å¦‚æœå€‹äººåœ¨ S3 æœ‰å¯«å…¥æ¬Šé™ï¼Œpassthrough ä¸æœƒé˜»æ­¢
- é–‹ç™¼ç’°å¢ƒçš„ admin ä»å¯ä¿®æ”¹ cluster è¨­å®š
```

**çœŸå¯¦é¢¨éšªï¼š**

```python
# å³ä½¿ä½¿ç”¨ Passthrough Credentials
# é–‹ç™¼è€…ä»å¯åŸ·è¡Œï¼š
spark.sql("DELETE FROM delta.`s3://prod-bucket/transactions/`")

# å› ç‚ºï¼š
# 1. é–‹ç™¼è€…çš„ IAM role æœ‰ s3:DeleteObject æ¬Šé™
# 2. Passthrough åªå‚³éæ¬Šé™ï¼Œä¸é™åˆ¶æ“ä½œ
```

**æ­£ç¢ºåšæ³•ï¼š**

```sql
-- âœ… åœ¨ Unity Catalog å±¤ç´šé™åˆ¶æ¬Šé™
GRANT SELECT ON EXTERNAL LOCATION prod_data TO `dev_users`;
DENY INSERT, UPDATE, DELETE ON EXTERNAL LOCATION prod_data TO `dev_users`;
```

---

## ğŸ§  è¨˜æ†¶æ³•èˆ‡å°æ¯”

### å£è¨£è¨˜æ†¶
**ã€Œé–‹ç™¼æ¸¬è©¦åªèƒ½è®€ï¼Œç’°å¢ƒéš”é›¢ä¸æœƒéŒ¯ã€**  
**ã€Œç”Ÿç”¢è³‡æ–™æ˜¯å¯¶è²ï¼Œå”¯è®€æ¬Šé™ä¾†ä¿è¡›ã€**

### ç’°å¢ƒéš”é›¢æœ€ä½³å¯¦å‹™

| ç’°å¢ƒ | è³‡æ–™ä¾†æº | æ¬Šé™ | ç”¨é€” |
|------|----------|------|------|
| **Production** | çœŸå¯¦ç”Ÿç”¢è³‡æ–™ | å®Œæ•´æ¬Šé™ï¼ˆåƒ…ç”Ÿç”¢åœ˜éšŠï¼‰ | æ­£å¼æ¥­å‹™é‹è¡Œ |
| **Testing** | ç”Ÿç”¢è³‡æ–™å‰¯æœ¬/å–æ¨£ | å®Œæ•´æ¬Šé™ï¼ˆæ¸¬è©¦åœ˜éšŠï¼‰ | åŠŸèƒ½æ¸¬è©¦ã€UAT |
| **Development** | ç”Ÿç”¢è³‡æ–™å‰¯æœ¬/å–æ¨£/åˆæˆè³‡æ–™ | å®Œæ•´æ¬Šé™ï¼ˆé–‹ç™¼åœ˜éšŠï¼‰ | é–‹ç™¼ã€é™¤éŒ¯ |
| **Dev å° Prod å­˜å–** | ç”Ÿç”¢è³‡æ–™ï¼ˆå”¯è®€ï¼‰ | **åƒ… SELECT** | åƒè€ƒã€é©—è­‰ |

### è³‡æ–™å®‰å…¨é˜²è­·å±¤ç´š

```
ğŸ›¡ï¸ é˜²è­·å±¤ç´šï¼ˆç”±å¤–åˆ°å…§ï¼‰

1. ç¶²è·¯éš”é›¢
   â””â”€ ä¸åŒ VPC/Subnet

2. Workspace éš”é›¢
   â””â”€ dev/test/prod workspace åˆ†é›¢

3. æ¬Šé™æ§åˆ¶
   â””â”€ Unity Catalog GRANT/DENY

4. è³‡æ–™åº«éš”é›¢
   â””â”€ dev_db / test_db / prod_db

5. è³‡æ–™è„«æ•
   â””â”€ æ•æ„Ÿæ¬„ä½é®ç½©/é›œæ¹Š

6. å¯©è¨ˆæ—¥èªŒ
   â””â”€ è¿½è¹¤æ‰€æœ‰å­˜å–è¡Œç‚º
```

### å°æ¯”è¡¨ï¼šéŒ¯èª¤è§€å¿µ vs æ­£ç¢ºå¯¦å‹™

| éŒ¯èª¤è§€å¿µ | ç‚ºä»€éº¼ä¸å¤  | æ­£ç¢ºå¯¦å‹™ |
|----------|-----------|----------|
| **Time Travel é˜²è­·ä¸€åˆ‡** | VACUUM æœƒæ°¸ä¹…åˆªé™¤ | å”¯è®€æ¬Šé™ + å®šæœŸå‚™ä»½ |
| **USE dev_db å°±å®‰å…¨** | äººç‚ºå¤±èª¤é›£ä»¥é¿å… | æ¬Šé™æ§åˆ¶ + ç’°å¢ƒéš”é›¢ |
| **å–®ä¸€ workspace æ–¹ä¾¿** | å¢åŠ èª¤æ“ä½œé¢¨éšª | ç’°å¢ƒåˆ†é›¢ + RBAC |
| **Passthrough å°±å®‰å…¨** | åªé©—è­‰èº«ä»½ä¸æ§åˆ¶æ¬Šé™ | Unity Catalog æˆæ¬Š |

---

## ğŸ’¡ å¯¦å‹™æ‡‰ç”¨

### å®Œæ•´çš„ç’°å¢ƒéš”é›¢æ¶æ§‹

```sql
-- Step 1: å»ºç«‹ç’°å¢ƒè³‡æ–™åº«
CREATE DATABASE prod_analytics;
CREATE DATABASE test_analytics;
CREATE DATABASE dev_analytics;

-- Step 2: å»ºç«‹ä½¿ç”¨è€…ç¾¤çµ„
CREATE GROUP prod_engineers;
CREATE GROUP test_engineers;
CREATE GROUP dev_engineers;

-- Step 3: é…ç½®æ¬Šé™ï¼ˆProductionï¼‰
GRANT ALL PRIVILEGES ON DATABASE prod_analytics TO prod_engineers;
GRANT SELECT ON DATABASE prod_analytics TO test_engineers;  -- âœ… å”¯è®€
GRANT SELECT ON DATABASE prod_analytics TO dev_engineers;   -- âœ… å”¯è®€

-- Step 4: é…ç½®æ¬Šé™ï¼ˆTest & Devï¼‰
GRANT ALL PRIVILEGES ON DATABASE test_analytics TO test_engineers;
GRANT SELECT ON DATABASE test_analytics TO dev_engineers;

GRANT ALL PRIVILEGES ON DATABASE dev_analytics TO dev_engineers;

-- Step 5: å»ºç«‹æ¸¬è©¦è³‡æ–™ï¼ˆå–æ¨£ + è„«æ•ï¼‰
CREATE TABLE test_analytics.customers AS
SELECT 
  customer_id,
  CONCAT('Test_', LEFT(name, 1), '***') as name,  -- è„«æ•
  email_domain(email) as email_domain,             -- åªä¿ç•™åŸŸå
  country,
  created_date
FROM prod_analytics.customers
TABLESAMPLE (5 PERCENT)  -- åªå– 5% è³‡æ–™
WHERE created_date >= current_date() - INTERVAL 90 DAYS;
```

### Workspace å±¤ç´šéš”é›¢

```python
# å»ºç«‹ä¸åŒ workspace çš„ cluster policy
{
  "cluster_type": {
    "type": "fixed",
    "value": "all-purpose"
  },
  "data_security_mode": {
    "type": "fixed",
    "value": "USER_ISOLATION"  # å¼·åˆ¶ User Isolation
  },
  "spark_conf.spark.databricks.passthrough.enabled": {
    "type": "fixed",
    "value": "true"
  }
}
```

### ç›£æ§èˆ‡å¯©è¨ˆ

```sql
-- ä½¿ç”¨ System Tables ç›£æ§è³‡æ–™å­˜å–
SELECT 
  user_name,
  action_name,
  request_params.table_full_name,
  event_time
FROM system.access.audit
WHERE action_name IN ('DELETE', 'UPDATE', 'DROP', 'TRUNCATE')
  AND request_params.table_full_name LIKE 'prod_%'
  AND user_name IN (SELECT user_name FROM dev_engineers)
ORDER BY event_time DESC;

-- è¨­å®š Alert
CREATE ALERT prod_write_from_dev
CRON '0 * * * *'  -- æ¯å°æ™‚æª¢æŸ¥
AS
SELECT * FROM system.access.audit
WHERE action_name IN ('INSERT', 'UPDATE', 'DELETE')
  AND request_params.table_full_name LIKE 'prod_%'
  AND workspace_name = 'dev-workspace';
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶åƒè€ƒ

1. **Unity Catalog Privileges:**
   - [Databricks Docs - Unity Catalog Privileges](https://docs.databricks.com/data-governance/unity-catalog/manage-privileges/index.html)

2. **Environment Best Practices:**
   - [Databricks Docs - Environment Management](https://docs.databricks.com/administration-guide/multiworkspace/index.html)

3. **Data Security:**
   - [Databricks Docs - Data Security Mode](https://docs.databricks.com/security/cluster-acl.html)

4. **System Tables for Audit:**
   - [Databricks Docs - System Tables](https://docs.databricks.com/administration-guide/system-tables/index.html)

---

## ğŸ¯ è€ƒè©¦æŠ€å·§

**é‡åˆ°ç’°å¢ƒå®‰å…¨é¡Œç›®æ™‚ï¼š**

1. âœ… **å„ªå…ˆé¸æ“‡æœ€åš´æ ¼çš„å®‰å…¨æ§åˆ¶** â†’ å”¯è®€æ¬Šé™ + ç’°å¢ƒéš”é›¢
2. âœ… **ä¸è¦ç›¸ä¿¡ã€ŒæŠ€è¡“ç‰¹æ€§å¯ä»¥é˜²è­·ä¸€åˆ‡ã€** â†’ Time Travel ä¸æ˜¯è¬èƒ½
3. âœ… **ä¸è¦ä¾è³´äººç‚ºæµç¨‹** â†’ `USE dev_db` ä¸å¯é 

**é—œéµåˆ¤æ–·æ¨™æº–ï¼š**

| é¸é …ç‰¹å¾µ | åˆ¤æ–· |
|---------|------|
| æåˆ°ã€ŒRead-onlyã€ã€Œå”¯è®€ã€ | âœ… é€šå¸¸æ˜¯æ­£ç¢ºå¯¦å‹™ |
| æåˆ°ã€Œç’°å¢ƒéš”é›¢ã€ã€ŒIsolatedã€ | âœ… ç¬¦åˆæœ€ä½³å¯¦å‹™ |
| æåˆ°ã€Œå–®ä¸€ç’°å¢ƒã€ã€Œæ–¹ä¾¿ç®¡ç†ã€ | âŒ å¢åŠ é¢¨éšª |
| éåº¦ä¾è³´æŠ€è¡“ç‰¹æ€§ï¼ˆTime Travelï¼‰ | âŒ ä¸è¶³ä»¥é˜²è­· |
| ä¾è³´äººç‚ºæµç¨‹ï¼ˆUSE dbï¼‰ | âŒ å®¹æ˜“å‡ºéŒ¯ |

**é™·é˜±è­¦ç¤ºï¼š**
- âš ï¸ ä¸è¦è¢«ã€ŒTime Travelã€èª¤å°ï¼Œä»¥ç‚ºè³‡æ–™ä¸æœƒä¸Ÿå¤±
- âš ï¸ ä¸è¦è¢«ã€ŒPassthroughã€èª¤å°ï¼Œä»¥ç‚ºèº«ä»½é©—è­‰=æ¬Šé™æ§åˆ¶
- âš ï¸ é¸é …å¼·èª¿ã€Œæ–¹ä¾¿ã€é€šå¸¸çŠ§ç‰²äº†å®‰å…¨æ€§
