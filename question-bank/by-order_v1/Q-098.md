# Question #98

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-098`

### ä¾†æº
**ä¾†æº:** Mock Exam / Community Contributed

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

A table named `user_ltv` is being used to create a view that will be used by data analysts on various teams. Users in the workspace are configured into groups, which are used for setting up data access using ACLs.

The `user_ltv` table has the following schema:
```sql
email STRING, age INT, ltv INT
```
*(è¨»ï¼šltv = Lifetime Value)*

The following view definition is executed:

```sql
CREATE VIEW user_ltv_no_minors AS
SELECT email, age, ltv
FROM user_ltv
WHERE
CASE
  WHEN is_member("auditing") THEN TRUE
  ELSE age >= 18
END
```

An analyst who is **not a member** of the `auditing` group executes the following query:

```sql
SELECT * FROM user_ltv_no_minors
```

Which statement describes the results returned by this query?

### é¸é …

- **A.** All columns will be displayed normally for those records that have an age greater than 17; records not meeting this condition will be omitted.
- **B.** All age values less than 18 will be returned as null values, all other columns will be returned with the values in user_ltv.
- **C.** All values for the age column will be returned as null values, all other columns will be returned with the values in user_ltv.
- **D.** All records from all columns will be displayed with the values in user_ltv.
- **E.** All columns will be displayed normally for those records that have an age greater than 18; records not meeting this condition will be omitted.

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Unity-Catalog`, `Access-Control`, `Views`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Boundary-Condition`, `Logic-Precision`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Security & Governance

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `A`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** A
- **ç¤¾ç¾¤æŠ•ç¥¨ç­”æ¡ˆ:** A (91%)

---

# é¡Œç›®è§£æ

---

## é¡Œç›®å›é¡§

### é¡Œç›®ç·¨è™Ÿèˆ‡é€£çµ
**é¡Œç›® ID:** `Q-098`
**é¡Œç›®é€£çµ:** [é»æ­¤è¿”å›é¡Œç›®](#question-98)

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `A`

---

## ğŸ“ è€ƒé»è­˜åˆ¥

### ä¸»è¦è€ƒé»
**æ ¸å¿ƒæŠ€è¡“:** Dynamic Views & Row-Level Security with `is_member()`
**çŸ¥è­˜é ˜åŸŸ:** Unity Catalog / Access Control
**é—œéµæ¦‚å¿µ:**
- `is_member()` å‡½æ•¸çš„ç¾¤çµ„æ¬Šé™æª¢æŸ¥
- WHERE å­å¥ä¸­ CASE WHEN çš„é‚è¼¯è©•ä¼°
- å‹•æ…‹æª¢è¦–ï¼ˆDynamic Viewsï¼‰å¯¦ä½œ Row-Level Security
- é‚Šç•Œæ¢ä»¶åˆ¤æ–·ï¼ˆ`>= 18` vs `> 17`ï¼‰

### æ¬¡è¦è€ƒé»
- ACLï¼ˆAccess Control Listsï¼‰èˆ‡ç¾¤çµ„ç®¡ç†
- è³‡æ–™é®ç½©èˆ‡æ¬„ä½ç´šå®‰å…¨ï¼ˆColumn-Level Securityï¼‰çš„å€åˆ¥

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ A æ˜¯æ­£ç¢ºçš„ï¼Ÿ

**æŠ€è¡“åŸç†:**

**1. `is_member()` å‡½æ•¸é‚è¼¯:**
```sql
CASE
  WHEN is_member("auditing") THEN TRUE  -- auditing ç¾¤çµ„ï¼šçœ‹åˆ°æ‰€æœ‰è¨˜éŒ„
  ELSE age >= 18                         -- é auditing ç¾¤çµ„ï¼šåªçœ‹åˆ° age >= 18 çš„è¨˜éŒ„
END
```

- å¦‚æœä½¿ç”¨è€…æ˜¯ `auditing` ç¾¤çµ„æˆå“¡ â†’ æ¢ä»¶è¿”å› `TRUE` â†’ æ‰€æœ‰è¨˜éŒ„éƒ½é€šé WHERE ç¯©é¸
- å¦‚æœä½¿ç”¨è€… **ä¸æ˜¯** `auditing` ç¾¤çµ„æˆå“¡ â†’ æ¢ä»¶è©•ä¼°ç‚º `age >= 18` â†’ åªæœ‰å¹´é½¡ â‰¥ 18 çš„è¨˜éŒ„é€šéç¯©é¸

**2. é¡Œç›®æƒ…å¢ƒåˆ†æ:**

ä½¿ç”¨è€… **ä¸æ˜¯** `auditing` ç¾¤çµ„æˆå“¡ï¼Œå› æ­¤ï¼š
- WHERE æ¢ä»¶ç°¡åŒ–ç‚ºï¼š`WHERE age >= 18`
- åªæœ‰ `age >= 18` çš„è¨˜éŒ„æœƒè¢«è¿”å›
- æ‰€æœ‰æ¬„ä½ï¼ˆemail, age, ltvï¼‰éƒ½æ­£å¸¸é¡¯ç¤º

**3. é—œéµé‚Šç•Œæ¢ä»¶:**

**æ³¨æ„ï¼** é¸é … A çš„æªè¾­æ˜¯ã€Œage greater than 17ã€ï¼ˆå¤§æ–¼ 17ï¼‰ï¼Œç­‰åŒæ–¼ `age >= 18`ï¼š
- `age > 17` â‰¡ `age >= 18`ï¼ˆå› ç‚º age æ˜¯ INT æ•´æ•¸å‹åˆ¥ï¼‰
- åŒ…å«ï¼š18, 19, 20, ...
- ä¸åŒ…å«ï¼š17, 16, 15, ...

**ç¬¦åˆéœ€æ±‚:**

é€™å€‹ VIEW è¨­è¨ˆå¯¦ç¾äº† **Row-Level Securityï¼ˆåˆ—ç´šå®‰å…¨ï¼‰**ï¼š
- **auditing ç¾¤çµ„**ï¼šå¯ä»¥çœ‹åˆ°æ‰€æœ‰è¨˜éŒ„ï¼ˆåŒ…æ‹¬æœªæˆå¹´äººè³‡æ–™ï¼Œç”¨æ–¼ç¨½æ ¸ï¼‰
- **ä¸€èˆ¬åˆ†æå¸«**ï¼šåªèƒ½çœ‹åˆ°æˆå¹´äººè¨˜éŒ„ï¼ˆage â‰¥ 18ï¼‰ï¼Œæœªæˆå¹´äººè¨˜éŒ„è¢«éæ¿¾æ‰

**å¯¦å‹™ç¯„ä¾‹:**

å‡è¨­ `user_ltv` è¡¨æ ¼æœ‰ä»¥ä¸‹è³‡æ–™ï¼š

| email | age | ltv |
|-------|-----|-----|
| user1@example.com | 15 | 100 |
| user2@example.com | 17 | 200 |
| user3@example.com | 18 | 300 |
| user4@example.com | 25 | 400 |

**é auditing ç¾¤çµ„æˆå“¡æŸ¥è©¢çµæœï¼š**

| email | age | ltv |
|-------|-----|-----|
| user3@example.com | 18 | 300 |
| user4@example.com | 25 | 400 |

- âœ… æ‰€æœ‰æ¬„ä½æ­£å¸¸é¡¯ç¤º
- âœ… åªåŒ…å« age > 17ï¼ˆå³ age â‰¥ 18ï¼‰çš„è¨˜éŒ„
- âŒ age â‰¤ 17 çš„è¨˜éŒ„è¢«éæ¿¾æ‰ï¼ˆomittedï¼‰

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### é¸é … B - "All age values less than 18 will be returned as null values..."

**éŒ¯èª¤åŸå› :** æ··æ·†äº† Row-Level Security èˆ‡ Column-Level Masking

**è©³ç´°åˆ†æ:**
- WHERE æ¢ä»¶æ˜¯ **éæ¿¾è¨˜éŒ„ï¼ˆfilter rowsï¼‰**ï¼Œä¸æ˜¯ **é®ç½©æ¬„ä½ï¼ˆmask columnsï¼‰**
- `age < 18` çš„è¨˜éŒ„æœƒè¢« **å®Œå…¨éæ¿¾æ‰**ï¼Œè€Œéå°‡ age æ¬„ä½è¨­ç‚º NULL
- å¦‚æœè¦å¯¦ä½œæ¬„ä½é®ç½©ï¼Œéœ€è¦åœ¨ SELECT å­å¥ä¸­ä½¿ç”¨ CASEï¼š
  ```sql
  SELECT 
    email,
    CASE WHEN is_member("auditing") THEN age ELSE NULL END AS age,
    ltv
  FROM user_ltv
  ```

**æ˜“æ··æ·†é»:**
å®¹æ˜“èˆ‡ã€Œè³‡æ–™é®ç½©ï¼ˆData Maskingï¼‰ã€åŠŸèƒ½æ··æ·†ï¼Œä½†é€™é¡Œæ˜¯åˆ—ç´šéæ¿¾ï¼Œä¸æ˜¯æ¬„ä½ç´šé®ç½©ã€‚

---

### é¸é … C - "All values for the age column will be returned as null values..."

**éŒ¯èª¤åŸå› :** å®Œå…¨èª¤è§£ WHERE æ¢ä»¶çš„ä½œç”¨

**è©³ç´°åˆ†æ:**
- é€™å€‹é¸é …æš—ç¤ºã€Œæ‰€æœ‰è¨˜éŒ„éƒ½ä¿ç•™ï¼Œä½† age æ¬„ä½è¢«é®ç½©ã€
- å¯¦éš›ä¸Š WHERE æ¢ä»¶æ˜¯ **éæ¿¾è¨˜éŒ„**ï¼Œä¸å½±éŸ¿æ¬„ä½å€¼
- é€šéç¯©é¸çš„è¨˜éŒ„ï¼Œage æ¬„ä½æœƒæ­£å¸¸é¡¯ç¤ºåŸå§‹å€¼

**æ˜“æ··æ·†é»:**
å¯èƒ½èª¤ä»¥ç‚ºé auditing ç¾¤çµ„æˆå“¡ã€Œçœ‹ä¸åˆ° age è³‡è¨Šã€ï¼Œä½†å¯¦éš›ä¸Šåªæ˜¯ã€Œçœ‹ä¸åˆ°æœªæˆå¹´äººè¨˜éŒ„ã€ã€‚

---

### é¸é … D - "All records from all columns will be displayed..."

**éŒ¯èª¤åŸå› :** å¿½ç•¥äº† WHERE æ¢ä»¶çš„éæ¿¾ä½œç”¨

**è©³ç´°åˆ†æ:**
- é€™å€‹é¸é …æš—ç¤º WHERE æ¢ä»¶ç„¡æ•ˆ
- å¯¦éš›ä¸Šé auditing ç¾¤çµ„æˆå“¡æœƒè§¸ç™¼ `ELSE age >= 18` åˆ†æ”¯
- æœªæˆå¹´äººè¨˜éŒ„æœƒè¢«éæ¿¾æ‰

**æ˜“æ··æ·†é»:**
å¯èƒ½èª¤ä»¥ç‚ºã€ŒVIEW åªæ˜¯è³‡æ–™çš„åˆ¥åï¼Œä¸æœƒæ”¹è®ŠæŸ¥è©¢çµæœã€ï¼Œä½† VIEW ä¸­çš„ WHERE æ¢ä»¶æœƒç¢ºå¯¦åŸ·è¡Œã€‚

---

### é¸é … E - "All columns will be displayed normally for those records that have an age greater than 18..."

**éŒ¯èª¤åŸå› :** é‚Šç•Œæ¢ä»¶éŒ¯èª¤ï¼ˆoff-by-one errorï¼‰

**è©³ç´°åˆ†æ:**
- é¸é … Eï¼š`age > 18`ï¼ˆå¤§æ–¼ 18ï¼‰â†’ åŒ…å« 19, 20, 21, ... â†’ **ä¸åŒ…å« 18**
- æ­£ç¢ºæ¢ä»¶ï¼š`age >= 18`ï¼ˆå¤§æ–¼ç­‰æ–¼ 18ï¼‰â†’ åŒ…å« 18, 19, 20, ...
- é¸é … Aï¼š`age > 17`ï¼ˆå¤§æ–¼ 17ï¼‰â†’ ç­‰åŒæ–¼ `age >= 18`ï¼ˆINT å‹åˆ¥ï¼‰ â†’ **åŒ…å« 18**

**é—œéµå·®ç•°:**

| æ¢ä»¶ | 18 æ­²æ˜¯å¦åŒ…å«ï¼Ÿ | ç¯„åœ |
|------|--------------|------|
| `age > 17` | âœ… åŒ…å« | 18, 19, 20, ... |
| `age >= 18` | âœ… åŒ…å« | 18, 19, 20, ... |
| `age > 18` | âŒ ä¸åŒ…å« | 19, 20, 21, ... |

**æ˜“æ··æ·†é»:**
é€™æ˜¯å…¸å‹çš„ã€Œé‚Šç•Œæ¢ä»¶é™·é˜±ã€ï¼Œè€ƒå¯Ÿå° `>` vs `>=` çš„ç²¾ç¢ºç†è§£ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•èˆ‡å°æ¯”

### è¨˜æ†¶å£è¨£
**ã€ŒWHERE éæ¿¾åˆ—ï¼ŒSELECT é®ç½©æ¬„ã€**
- **WHERE éæ¿¾åˆ—**: WHERE æ¢ä»¶æ±ºå®šå“ªäº› **è¨˜éŒ„ï¼ˆrowsï¼‰** è¢«è¿”å›
- **SELECT é®ç½©æ¬„**: SELECT å­å¥æ±ºå®šå“ªäº› **æ¬„ä½ï¼ˆcolumnsï¼‰** è¢«é¡¯ç¤ºæˆ–é®ç½©

### é—œéµå°æ¯”è¡¨

| ç‰¹æ€§ | Row-Level Security (æœ¬é¡Œ) | Column-Level Masking |
|------|--------------------------|---------------------|
| **å¯¦ä½œä½ç½®** | WHERE å­å¥ | SELECT å­å¥ |
| **ä½œç”¨å°è±¡** | éæ¿¾è¨˜éŒ„ï¼ˆrowsï¼‰ | é®ç½©æ¬„ä½ï¼ˆcolumnsï¼‰ |
| **æœªæˆæ¬Šè³‡æ–™** | å®Œå…¨çœ‹ä¸åˆ° | çœ‹å¾—åˆ°è¨˜éŒ„ï¼Œæ¬„ä½é¡¯ç¤º NULL æˆ–é®ç½©å€¼ |
| **èªæ³•ç¯„ä¾‹** | `WHERE is_member(...) OR age >= 18` | `SELECT CASE WHEN ... THEN age ELSE NULL END` |

### `is_member()` å‡½æ•¸é‚è¼¯è¡¨

| ä½¿ç”¨è€…ç¾¤çµ„ç‹€æ…‹ | `is_member("auditing")` | CASE çµæœ | WHERE æ¢ä»¶ç°¡åŒ– |
|--------------|------------------------|---------|--------------|
| **æ˜¯** auditing æˆå“¡ | TRUE | TRUE | `WHERE TRUE`ï¼ˆæ‰€æœ‰è¨˜éŒ„ï¼‰ |
| **ä¸æ˜¯** auditing æˆå“¡ | FALSE | `age >= 18` | `WHERE age >= 18`ï¼ˆåƒ…æˆå¹´äººï¼‰ |

### é‚Šç•Œæ¢ä»¶é€ŸæŸ¥

| è¡¨é”å¼ | INT å‹åˆ¥ç­‰åƒ¹ | 18 æ­²æ˜¯å¦åŒ…å«ï¼Ÿ |
|-------|-------------|--------------|
| `age > 17` | `age >= 18` | âœ… åŒ…å« |
| `age >= 18` | `age >= 18` | âœ… åŒ…å« |
| `age > 18` | `age >= 19` | âŒ ä¸åŒ…å« |

---

## ğŸ“š å»¶ä¼¸å­¸ç¿’

### å®˜æ–¹æ–‡ä»¶
- [Row-Level Security in Unity Catalog](https://docs.databricks.com/security/access-control/row-level-security.html)
- [is_member() Function](https://docs.databricks.com/sql/language-manual/functions/is_member.html)
- [Dynamic Views for Data Masking](https://docs.databricks.com/security/access-control/data-masking.html)

### ç›¸é—œé¡Œç›®
- Q-XXX: Unity Catalog ACLs çš„é…ç½®èˆ‡ç®¡ç†
- Q-XXX: Column-Level Masking çš„å¯¦ä½œæ–¹å¼
- Q-XXX: Delta Sharing çš„æ¬Šé™æ§åˆ¶

---

## ğŸ¯ é‡é»æé†’

> **æ ¸å¿ƒè§€å¿µ:** WHERE å­å¥ä¸­çš„ `is_member()` é…åˆ CASE WHEN å¯¦ä½œ Row-Level Securityï¼Œéæˆæ¬Šä½¿ç”¨è€…çœ‹ä¸åˆ°è¢«éæ¿¾çš„è¨˜éŒ„ï¼ˆä¸æ˜¯é®ç½©æ¬„ä½ï¼‰ã€‚æ³¨æ„é‚Šç•Œæ¢ä»¶ï¼š`age > 17` ç­‰åŒæ–¼ `age >= 18`ï¼ˆINT å‹åˆ¥ï¼‰ã€‚

**è€ƒè©¦é™·é˜±:**
- âŒ æ··æ·† Row-Level Securityï¼ˆéæ¿¾åˆ—ï¼‰èˆ‡ Column-Level Maskingï¼ˆé®ç½©æ¬„ä½ï¼‰
- âŒ é‚Šç•Œæ¢ä»¶éŒ¯èª¤ï¼š`age > 18` vs `age > 17`
- âŒ èª¤ä»¥ç‚º WHERE æ¢ä»¶æœƒå°‡æ¬„ä½è¨­ç‚º NULL

**æ­£ç¢ºæ€ç¶­:**
- âœ… WHERE = éæ¿¾è¨˜éŒ„ï¼ˆrowsï¼‰ï¼Œä¸å½±éŸ¿æ¬„ä½å€¼
- âœ… `age > 17` â‰¡ `age >= 18`ï¼ˆINT å‹åˆ¥ï¼‰
- âœ… é auditing æˆå“¡åªèƒ½çœ‹åˆ° age â‰¥ 18 çš„å®Œæ•´è¨˜éŒ„