# Question #112

---

## 題目資訊

### 題目編號
**ID:** `Q-112`

### 來源
**來源:** Mock Exam / Community Contributed

### 難度等級
**難度:** `L2-Intermediate`

---

## 題目內容

### 題幹

Each configuration below is identical to the extent that each cluster has **400 GB total RAM**, **160 total cores**, and **only one Executor per VM**. 

Given an **extremely long-running job** for which **completion must be guaranteed**, which cluster configuration will be able to **guarantee completion** of the job in light of **one or more VM failures**?

### 選項

- **A.** Total VMs: 8 / 50 GB per Executor / 20 Cores per Executor
- **B.** Total VMs: 16 / 25 GB per Executor / 10 Cores per Executor
- **C.** Total VMs: 1 / 400 GB per Executor / 160 Cores per Executor
- **D.** Total VMs: 4 / 100 GB per Executor / 40 Cores per Executor
- **E.** Total VMs: 2 / 200 GB per Executor / 80 Cores per Executor

---

## 標籤系統

### Topic Tags (技術主題標籤)
**Topics:** `Cluster-Configuration`, `Fault-Tolerance`, `Resource-Management`

### Trap Tags (陷阱類型標籤)
**Traps:** `Availability-vs-Performance`, `Single-Point-Failure`

### Knowledge Domain (知識領域)
**Domain:** Data Engineering / Operations

---

## 答案與來源

### 正確答案
**正解:** `B` (社群共識為主)

### 答案來源
- **來源標註答案:** D
- **社群共識:** B (更高容錯性)
- **實務驗證:** B 最能保證完成

---

# 題目解析

---

## 📍 考點識別

**核心技術:** Spark Cluster Fault Tolerance & High Availability  
**關鍵概念:** VM 故障容錯、任務重試、單點失敗風險

**題目關鍵字：**
- **Extremely long-running job** (極長執行時間)
- **Completion must be guaranteed** (必須保證完成)
- **One or more VM failures** (VM 可能故障)

---

## ✅ 正解說明

### 為什麼 B (16 VMs) 是最佳答案？

**核心原理：**

```
容錯能力 = VM 數量越多，單一 VM 失敗影響越小

16 VMs 配置：
- 每個 VM 故障只影響 1/16 (6.25%) 的資源
- 其他 15 個 VM 可繼續工作
- 任務可以重新調度到其他節點
```

**各選項容錯能力對比：**

| 選項 | VMs | 單 VM 故障影響 | 容錯能力 | 保證完成 |
|------|-----|---------------|---------|---------|
| **B** | 16 | 6.25% | ⭐⭐⭐⭐⭐ | ✅ 最高 |
| **A** | 8 | 12.5% | ⭐⭐⭐⭐ | ✅ 高 |
| **D** | 4 | 25% | ⭐⭐⭐ | ⚠️ 中 |
| **E** | 2 | 50% | ⭐⭐ | ⚠️ 低 |
| **C** | 1 | 100% | ❌ | ❌ 無 |

**技術原理：**

```python
# Spark 容錯機制
當一個 Executor (VM) 失敗時：
1. Driver 偵測到 Executor 失敗
2. 該 Executor 上未完成的 tasks 被標記為失敗
3. Scheduler 將 tasks 重新分配到其他存活的 Executors
4. 任務繼續執行

# 16 VMs 的優勢
- 失敗 1 個 VM → 剩 15 個 VM 繼續工作
- 失敗 2 個 VM → 剩 14 個 VM 繼續工作
- 任務重試成本低（只需重算少量分區）

# 1 VM 的劣勢（選項 C）
- 失敗 1 個 VM → 整個 job 失敗 ❌
- 無法容錯
```

---

## ❌ 錯誤選項排除

### C - 1 VM (單點故障)

**為什麼最糟糕？**

```
配置: 1 VM / 400 GB / 160 Cores

❌ 單點故障 (Single Point of Failure)
- VM 故障 = 整個 job 失敗
- 無任何容錯能力
- 無法保證完成
```

**問題：**
- 沒有備援節點
- 長時間運行增加故障機率
- 題目明確要求「保證完成」

### E - 2 VMs

**為什麼不夠好？**

```
配置: 2 VMs / 200 GB each

⚠️ 失去 50% 資源
- 1 個 VM 失敗 → 剩餘資源減半
- 執行時間可能翻倍
- 容錯能力偏低
```

### D - 4 VMs (來源答案，但次優)

**為什麼不是最佳？**

```
配置: 4 VMs / 100 GB each

⚠️ 失去 25% 資源
- 1 個 VM 失敗 → 剩餘 75% 資源
- 比 B 選項容錯能力差
```

**D vs B 對比：**

| 配置 | VM 故障影響 | 剩餘資源 | 推薦度 |
|------|------------|---------|--------|
| **B (16 VMs)** | 6.25% | 93.75% | ⭐⭐⭐⭐⭐ |
| **D (4 VMs)** | 25% | 75% | ⭐⭐⭐ |

### A - 8 VMs

**為什麼不是最佳？**

```
配置: 8 VMs / 50 GB each

✅ 容錯能力不錯（第二名）
⚠️ 但不如 B (16 VMs)
- 單 VM 故障影響 12.5% 資源
- B 只影響 6.25%
```

---

## 🧠 記憶法

### 口訣

**「長跑要保證，VM 越多越穩」**

```
容錯能力排序:
16 VMs > 8 VMs > 4 VMs > 2 VMs > 1 VM
   B   >   A   >   D   >   E   >   C

題目關鍵字 = 保證完成 + VM 故障
→ 選擇最多 VM 的配置 (選項 B) ✅
```

### 容錯能力公式

```
容錯能力 ∝ VM 數量

VM 數量越多:
✅ 單一故障影響越小
✅ 任務重新分配越靈活
✅ 完成保證度越高

VM 數量越少:
❌ 單點故障風險越高
❌ 資源損失越嚴重
❌ 無法保證完成
```

---

## 📚 官方文件

- [Spark Fault Tolerance](https://spark.apache.org/docs/latest/cluster-overview.html#fault-tolerance)
- [Databricks Cluster Configuration Best Practices](https://docs.databricks.com/clusters/configure.html)

---

## 💡 實務建議

### Cluster 配置原則

| 場景 | 推薦配置 | 原因 |
|------|---------|------|
| **長時間運行任務** | 多個小 VM | 容錯性高 |
| **短期批次任務** | 少數大 VM | 啟動快 |
| **關鍵任務** | 分散式配置 (8+ VMs) | 保證完成 |
| **測試開發** | 單一 VM | 成本低 |

### 容錯性 vs 性能權衡

```python
# ✅ 高容錯性（適合長時間任務）
16 VMs × 25 GB = 400 GB 總資源
- 優點: 容錯性最高
- 缺點: 管理開銷稍高

# ⚠️ 高性能（適合短期任務）
4 VMs × 100 GB = 400 GB 總資源
- 優點: 單個任務處理快
- 缺點: 容錯性較低

# ❌ 不推薦（除非特殊需求）
1 VM × 400 GB = 400 GB 總資源
- 優點: 管理簡單
- 缺點: 無容錯能力
```

---

## 🎯 考試技巧

### 快速判斷法

```
題目出現「保證完成」+ 「VM 故障」
  ↓
選擇 VM 數量最多的配置
  ↓
答案: B (16 VMs) ✅
```

### 關鍵字識別

| 關鍵字 | 選擇策略 |
|--------|---------|
| **guarantee completion** | 選最多 VM |
| **VM failures** | 選分散式配置 |
| **long-running** | 選高容錯 |
| **performance** | 選少數大 VM |

---

## ⚠️ 重點總結

1. **容錯能力與 VM 數量成正比**
   - 16 VMs > 4 VMs > 1 VM

2. **單點故障是最大風險**
   - 1 VM 配置無法容錯
   - 長時間任務必須避免

3. **保證完成 = 選最多 VM**
   - 題目要求保證完成
   - B (16 VMs) 是最佳答案

**記憶口訣：「保證完成選最多，16 個 VM 不會倒」**

---

**[返回題目](#question-112)**