# Question #100

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-100`

### ä¾†æº
**ä¾†æº:** Mock Exam / Community Contributed

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

The data engineering team has been tasked with configuring connections to an external database that does not have a supported native connector with Databricks. The external database already has data security configured by group membership. These groups map directly to user groups already created in Databricks that represent various teams within the company.

A new login credential has been created for each group in the external database. The Databricks Utilities Secrets module will be used to make these credentials available to Databricks users.

Assuming that all the credentials are configured correctly on the external database and group membership is properly configured on Databricks, which statement describes how teams can be granted the **minimum necessary access** to using these credentials?

### é¸é …

- **A.** "Manage" permissions should be set on a secret key mapped to those credentials that will be used by a given team.
- **B.** "Read" permissions should be set on a secret key mapped to those credentials that will be used by a given team.
- **C.** "Read" permissions should be set on a secret scope containing only those credentials that will be used by a given team.
- **D.** "Manage" permissions should be set on a secret scope containing only those credentials that will be used by a given team.
- **E.** No additional configuration is necessary as long as all users are configured as administrators in the workspace where secrets have been added.

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Secrets-Management`, `Access-Control`, `Security`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Permission-Level`, `Scope-Granularity`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Security & Governance

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `C`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** Bï¼ˆâš ï¸ ç¤¾ç¾¤å»£æ³›èªç‚ºæ­¤æ¨™è¨»éŒ¯èª¤ï¼‰
- **ç¤¾ç¾¤æŠ•ç¥¨ç­”æ¡ˆ:** C (100%)

---

# é¡Œç›®è§£æ

---

## é¡Œç›®å›é¡§

### é¡Œç›®ç·¨è™Ÿèˆ‡é€£çµ
**é¡Œç›® ID:** `Q-100`
**é¡Œç›®é€£çµ:** [é»æ­¤è¿”å›é¡Œç›®](#question-100)

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `C`

---

## ğŸ“ è€ƒé»è­˜åˆ¥

### ä¸»è¦è€ƒé»
**æ ¸å¿ƒæŠ€è¡“:** Databricks Secrets Management & ACL Permissions
**çŸ¥è­˜é ˜åŸŸ:** Security & Governance / Least Privilege Principle
**é—œéµæ¦‚å¿µ:**
- Secret Scope çš„å­˜å–æ§åˆ¶ç²’åº¦ï¼ˆgranularityï¼‰
- Databricks ä¸æ”¯æ´å°å–®ä¸€ Secret Key è¨­å®šæ¬Šé™
- æœ€å°æ¬Šé™åŸå‰‡ï¼ˆLeast Privilege Principleï¼‰
- Read vs Manage æ¬Šé™çš„å·®ç•°

### æ¬¡è¦è€ƒé»
- Secret Scope çš„è¨­è¨ˆæ¨¡å¼ï¼ˆper-team vs sharedï¼‰
- Databricks Utilities Secrets æ¨¡çµ„çš„ä½¿ç”¨

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ C æ˜¯æ­£ç¢ºçš„ï¼Ÿ

**æŠ€è¡“åŸç†:**

**1. Databricks Secrets çš„æ¬Šé™æ¶æ§‹ï¼š**

Databricks Secrets ç®¡ç†æ¡ç”¨ **Secret Scope å±¤ç´šçš„æ¬Šé™æ§åˆ¶**ï¼š
- âœ… å¯ä»¥å° **Secret Scope** è¨­å®š ACL æ¬Šé™
- âŒ **ä¸èƒ½** å°å–®ä¸€ **Secret Key** è¨­å®šæ¬Šé™
- æ¬Šé™é¡å‹ï¼š
  - **READ**: è®€å– scope å…§çš„æ‰€æœ‰ secrets
  - **WRITE**: æ–°å¢/ä¿®æ”¹ scope å…§çš„ secrets
  - **MANAGE**: ç®¡ç† scopeï¼ˆåŒ…å« READ + WRITE + æ¬Šé™ç®¡ç†ï¼‰

**2. æœ€å°æ¬Šé™åŸå‰‡ï¼ˆLeast Privilegeï¼‰ï¼š**

é¡Œç›®è¦æ±‚ã€Œ**minimum necessary access**ã€ï¼Œæ­£ç¢ºåšæ³•æ˜¯ï¼š
- ç‚º **æ¯å€‹åœ˜éšŠ** å»ºç«‹ç¨ç«‹çš„ Secret Scope
- è©² scope åªåŒ…å«è©²åœ˜éšŠéœ€è¦çš„ credentials
- æˆäºˆåœ˜éšŠ **READ** æ¬Šé™ï¼ˆä½¿ç”¨ secretsï¼Œä¸éœ€ä¿®æ”¹ï¼‰

**3. ç‚ºä»€éº¼ Secret Scope ç²’åº¦è€Œé Secret Keyï¼Ÿ**

```python
# âŒ éŒ¯èª¤æ¦‚å¿µï¼šç„¡æ³•å°å–®ä¸€ key è¨­å®šæ¬Šé™
# Databricks ä¸æ”¯æ´é€™ç¨®èªæ³•
dbutils.secrets.setAcl(
    scope="shared_scope",
    principal="team_a",
    permission="READ",
    key="team_a_db_password"  # âŒ ä¸æ”¯æ´ key å±¤ç´šæ¬Šé™
)

# âœ… æ­£ç¢ºåšæ³•ï¼šç‚ºæ¯å€‹åœ˜éšŠå»ºç«‹ç¨ç«‹ scope
# Team A çš„ scope
dbutils.secrets.createScope("team_a_scope")
dbutils.secrets.put("team_a_scope", "db_password", "secret_value")
dbutils.secrets.setAcl("team_a_scope", "team_a", "READ")

# Team B çš„ scope
dbutils.secrets.createScope("team_b_scope")
dbutils.secrets.put("team_b_scope", "db_password", "secret_value")
dbutils.secrets.setAcl("team_b_scope", "team_b", "READ")
```

**ç¬¦åˆéœ€æ±‚:**

é¡Œç›®æƒ…å¢ƒï¼š
- å¤šå€‹åœ˜éšŠï¼ˆteamsï¼‰
- æ¯å€‹åœ˜éšŠå°æ‡‰å¤–éƒ¨è³‡æ–™åº«çš„ä¸åŒç™»å…¥æ†‘è­‰
- éœ€è¦éš”é›¢å­˜å–ï¼ˆteam A ä¸èƒ½ç”¨ team B çš„æ†‘è­‰ï¼‰

**æœ€ä½³å¯¦è¸æ¶æ§‹ï¼š**

```
Secret Scopes è¨­è¨ˆï¼š
â”œâ”€ team_analytics_scope
â”‚  â”œâ”€ db_username = "analytics_user"
â”‚  â””â”€ db_password = "analytics_pass"
â”‚  â””â”€ ACL: team_analytics (READ)
â”‚
â”œâ”€ team_marketing_scope
â”‚  â”œâ”€ db_username = "marketing_user"
â”‚  â””â”€ db_password = "marketing_pass"
â”‚  â””â”€ ACL: team_marketing (READ)
â”‚
â””â”€ team_finance_scope
   â”œâ”€ db_username = "finance_user"
   â””â”€ db_password = "finance_pass"
   â””â”€ ACL: team_finance (READ)
```

**å¯¦å‹™ç¯„ä¾‹ï¼š**

```python
# ç®¡ç†å“¡è¨­å®š Team Analytics çš„ secrets
dbutils.secrets.createScope("team_analytics_scope")
dbutils.secrets.put("team_analytics_scope", "db_host", "analytics-db.example.com")
dbutils.secrets.put("team_analytics_scope", "db_user", "analytics_user")
dbutils.secrets.put("team_analytics_scope", "db_password", "secure_password")

# æˆäºˆ READ æ¬Šé™çµ¦ team_analytics ç¾¤çµ„
dbutils.secrets.setAcl(
    scope="team_analytics_scope",
    principal="team_analytics",  # Databricks ç¾¤çµ„åç¨±
    permission="READ"
)

# Team Analytics æˆå“¡ä½¿ç”¨ secretsï¼ˆåœ¨ notebook ä¸­ï¼‰
jdbc_url = f"jdbc:postgresql://{dbutils.secrets.get('team_analytics_scope', 'db_host')}/db"
properties = {
    "user": dbutils.secrets.get("team_analytics_scope", "db_user"),
    "password": dbutils.secrets.get("team_analytics_scope", "db_password")
}

df = (spark.read
    .format("jdbc")
    .option("url", jdbc_url)
    .option("dbtable", "sales_data")
    .option("user", properties["user"])
    .option("password", properties["password"])
    .load())
```

**ç‚ºä»€éº¼æ˜¯ READ è€Œé MANAGEï¼Ÿ**

| æ¬Šé™ | èƒ½åŠ› | åœ˜éšŠéœ€è¦ï¼Ÿ |
|------|------|----------|
| **READ** | è®€å– secrets | âœ… æ˜¯ï¼ˆé€£ç·šè³‡æ–™åº«ï¼‰ |
| **WRITE** | æ–°å¢/ä¿®æ”¹ secrets | âŒ å¦ï¼ˆç”±ç®¡ç†å“¡ç®¡ç†ï¼‰ |
| **MANAGE** | ç®¡ç†æ¬Šé™ã€åˆªé™¤ scope | âŒ å¦ï¼ˆæ¬Šé™éé«˜ï¼‰ |

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### é¸é … A - "Manage permissions should be set on a secret key..."

**éŒ¯èª¤åŸå› :** å…©å€‹è‡´å‘½éŒ¯èª¤

**è©³ç´°åˆ†æ:**
1. **âŒ ç„¡æ³•å° Secret Key è¨­å®šæ¬Šé™** - Databricks åªæ”¯æ´ Secret Scope å±¤ç´šçš„ ACL
2. **âŒ Manage æ¬Šé™éé«˜** - é•åæœ€å°æ¬Šé™åŸå‰‡ï¼Œåœ˜éšŠä¸éœ€è¦ç®¡ç†æ¬Šé™

**æ˜“æ··æ·†é»:**
å¯èƒ½è¯æƒ³åˆ°ã€Œç²¾ç´°åŒ–æ¬Šé™æ§åˆ¶ã€ï¼Œä½† Databricks æ¶æ§‹ä¸æ”¯æ´ key å±¤ç´šæ¬Šé™ã€‚

---

### é¸é … B - "Read permissions should be set on a secret key..."

**éŒ¯èª¤åŸå› :** Databricks ä¸æ”¯æ´å°å–®ä¸€ Secret Key è¨­å®šæ¬Šé™

**è©³ç´°åˆ†æ:**
- **READ æ¬Šé™æ˜¯æ­£ç¢ºçš„**ï¼ˆç¬¦åˆæœ€å°æ¬Šé™ï¼‰
- **ä½†ç„¡æ³•æ‡‰ç”¨åˆ° Secret Key å±¤ç´š** - é€™æ˜¯ Databricks çš„æ¶æ§‹é™åˆ¶
- æ¬Šé™å¿…é ˆè¨­å®šåœ¨ **Secret Scope** å±¤ç´š

**ç‚ºä»€éº¼ä¾†æºç­”æ¡ˆæ¨™è¨» Bï¼Ÿ**
- é€™æ˜¯å¸¸è¦‹çš„éŒ¯èª¤æ¨™è¨»ï¼Œå¯èƒ½èª¤è§£äº† Databricks Secrets çš„æ¬Šé™æ¨¡å‹
- ç¤¾ç¾¤ 100% æŠ•ç¥¨ Cï¼Œè­‰å¯¦é€™æ˜¯éŒ¯èª¤æ¨™è¨»

**æ˜“æ··æ·†é»:**
ã€Œå°å–®ä¸€ key è¨­å®šæ¬Šé™ã€åœ¨æ¦‚å¿µä¸Šåˆç†ï¼Œä½† Databricks ä¸æ”¯æ´æ­¤åŠŸèƒ½ã€‚

---

### é¸é … D - "Manage permissions should be set on a secret scope..."

**éŒ¯èª¤åŸå› :** æ¬Šé™ç­‰ç´šéé«˜ï¼Œé•åæœ€å°æ¬Šé™åŸå‰‡

**è©³ç´°åˆ†æ:**
- **Secret Scope ç²’åº¦æ˜¯æ­£ç¢ºçš„** âœ…
- **ä½† MANAGE æ¬Šé™éé«˜** âŒ
- MANAGE æ¬Šé™å…è¨±ï¼š
  - ä¿®æ”¹ scope å…§çš„æ‰€æœ‰ secrets
  - åˆªé™¤ scope
  - ç®¡ç†å…¶ä»–ä½¿ç”¨è€…çš„æ¬Šé™
- åœ˜éšŠåªéœ€è¦ **è®€å–** secrets ä¾†é€£ç·šè³‡æ–™åº«ï¼Œä¸éœ€è¦ç®¡ç†èƒ½åŠ›

**æ˜“æ··æ·†é»:**
ã€ŒManageã€è½èµ·ä¾†åƒæ˜¯ã€Œç®¡ç†è‡ªå·±åœ˜éšŠçš„ secretsã€ï¼Œä½†å¯¦éš›ä¸Šæ¬Šé™ç¯„åœéå¤§ã€‚

---

### é¸é … E - "No additional configuration is necessary as long as all users are configured as administrators..."

**éŒ¯èª¤åŸå› :** å®Œå…¨é•åå®‰å…¨æœ€ä½³å¯¦è¸

**è©³ç´°åˆ†æ:**
- **âŒ æ‰€æœ‰äººéƒ½æ˜¯ç®¡ç†å“¡** - æ¥µåº¦ä¸å®‰å…¨
- **âŒ ç„¡æ³•å¯¦ç¾åœ˜éšŠéš”é›¢** - æ‰€æœ‰åœ˜éšŠéƒ½èƒ½å­˜å–æ‰€æœ‰ secrets
- **âŒ é•åæœ€å°æ¬Šé™åŸå‰‡** - éåº¦æˆæ¬Š

**æ˜“æ··æ·†é»:**
å¯èƒ½èª¤ä»¥ç‚ºã€Œç°¡åŒ–ç®¡ç†ã€ï¼Œä½†å¯¦éš›ä¸Šæ˜¯å®‰å…¨ç½é›£ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•èˆ‡å°æ¯”

### è¨˜æ†¶å£è¨£
**ã€ŒScope éš”é›¢ READ å¤ ç”¨ï¼ŒKey ç²’åº¦ Databricks ä¸æ”¯æ´ã€**
- **Scope éš”é›¢**: ç‚ºæ¯å€‹åœ˜éšŠå»ºç«‹ç¨ç«‹ Secret Scope
- **READ å¤ ç”¨**: è®€å–æ¬Šé™è¶³å¤ ä½¿ç”¨ secrets
- **Key ç²’åº¦ä¸æ”¯æ´**: ç„¡æ³•å°å–®ä¸€ Secret Key è¨­å®šæ¬Šé™

### é—œéµå°æ¯”è¡¨

| æ¬Šé™å±¤ç´š | Databricks æ”¯æ´ï¼Ÿ | é©ç”¨æƒ…å¢ƒ |
|---------|-----------------|---------|
| **Secret Scope ACL** | âœ… æ”¯æ´ | **æ­£ç¢ºåšæ³•**ï¼šç‚ºæ¯å€‹åœ˜éšŠå»ºç«‹ç¨ç«‹ scope |
| **Secret Key ACL** | âŒ **ä¸æ”¯æ´** | ç„¡æ³•å¯¦ç¾ï¼ˆæ¶æ§‹é™åˆ¶ï¼‰ |

| æ¬Šé™é¡å‹ | èƒ½åŠ› | åœ˜éšŠä½¿ç”¨ secrets | ç®¡ç†å“¡ç®¡ç† secrets |
|---------|------|----------------|------------------|
| **READ** | è®€å– secrets | âœ… **æœ€å°æ¬Šé™** | âŒ ä¸è¶³ |
| **WRITE** | è®€å– + æ–°å¢/ä¿®æ”¹ | âš ï¸ éé«˜ | âš ï¸ ä»ä¸è¶³ï¼ˆç„¡æ³•ç®¡ç†æ¬Šé™ï¼‰ |
| **MANAGE** | è®€å– + ä¿®æ”¹ + ç®¡ç†æ¬Šé™ + åˆªé™¤ scope | âŒ éé«˜ | âœ… é©åˆ |

### Secret Scope è¨­è¨ˆæ¨¡å¼

| æ¨¡å¼ | å„ªé» | ç¼ºé» | é©ç”¨æƒ…å¢ƒ |
|------|------|------|---------|
| **Per-Team Scope** | âœ… å®Œå…¨éš”é›¢<br>âœ… ç²¾ç´°åŒ–æ§åˆ¶<br>âœ… ç¬¦åˆæœ€å°æ¬Šé™ | éœ€è¦ç®¡ç†å¤šå€‹ scopes | **å¤šåœ˜éšŠç’°å¢ƒ**ï¼ˆæœ¬é¡Œæƒ…å¢ƒï¼‰ |
| **Shared Scope** | âœ… ç®¡ç†ç°¡å–®<br>âœ… æ¸›å°‘ scope æ•¸é‡ | âŒ ç„¡æ³•éš”é›¢<br>âŒ æ‰€æœ‰äººçœ‹åˆ°æ‰€æœ‰ secrets | å–®ä¸€åœ˜éšŠæˆ–å®Œå…¨ä¿¡ä»»ç’°å¢ƒ |
| **Hierarchical Scope** | âœ… å½ˆæ€§åˆ†çµ„<br>âœ… å¯å…±äº«é€šç”¨ secrets | éœ€è¦ç²¾å¿ƒè¨­è¨ˆå‘½åè¦ç¯„ | è¤‡é›œçµ„ç¹”çµæ§‹ |

### Secrets ç®¡ç†æ±ºç­–æ¨¹

```
éœ€æ±‚ï¼šå¤šåœ˜éšŠä½¿ç”¨ä¸åŒæ†‘è­‰
â”œâ”€ Databricks æ”¯æ´ Key å±¤ç´šæ¬Šé™ï¼Ÿ
â”‚  â””â”€ âŒ å¦ â†’ å¿…é ˆä½¿ç”¨ Scope å±¤ç´šæ¬Šé™
â”œâ”€ å¦‚ä½•éš”é›¢åœ˜éšŠå­˜å–ï¼Ÿ
â”‚  â”œâ”€ æ¯å€‹åœ˜éšŠç¨ç«‹ Scopeï¼ˆâœ… æ¨è–¦ï¼‰
â”‚  â””â”€ å…±äº« Scopeï¼ˆâŒ ç„¡æ³•éš”é›¢ï¼‰
â”œâ”€ æˆäºˆä»€éº¼æ¬Šé™ï¼Ÿ
â”‚  â”œâ”€ READï¼ˆâœ… ç¬¦åˆæœ€å°æ¬Šé™ï¼‰
â”‚  â”œâ”€ WRITEï¼ˆâš ï¸ åœ˜éšŠä¸éœ€è¦ä¿®æ”¹ secretsï¼‰
â”‚  â””â”€ MANAGEï¼ˆâŒ æ¬Šé™éé«˜ï¼‰
â””â”€ å¯¦ä½œæ­¥é©Ÿï¼š
   1. ç‚ºæ¯å€‹åœ˜éšŠå»ºç«‹ç¨ç«‹ Secret Scope
   2. åœ¨å°æ‡‰ Scope ä¸­æ–°å¢è©²åœ˜éšŠçš„æ†‘è­‰
   3. æˆäºˆåœ˜éšŠ READ æ¬Šé™
```

---

## ğŸ“š å»¶ä¼¸å­¸ç¿’

### å®˜æ–¹æ–‡ä»¶
- [Databricks Secrets Management](https://docs.databricks.com/security/secrets/index.html)
- [Secret Scopes](https://docs.databricks.com/security/secrets/secret-scopes.html)
- [Secret ACLs](https://docs.databricks.com/security/secrets/secret-acl.html)

### ç›¸é—œé¡Œç›®
- Q-XXX: Unity Catalog çš„ Secret Management
- Q-XXX: Azure Key Vault èˆ‡ Databricks æ•´åˆ
- Q-XXX: Least Privilege åŸå‰‡åœ¨ Databricks çš„æ‡‰ç”¨

---

## ğŸ¯ é‡é»æé†’

> **æ ¸å¿ƒè§€å¿µ:** Databricks Secrets åªæ”¯æ´ Secret Scope å±¤ç´šçš„æ¬Šé™æ§åˆ¶ï¼Œç„¡æ³•å°å–®ä¸€ Secret Key è¨­å®šæ¬Šé™ã€‚å¯¦ä½œå¤šåœ˜éšŠéš”é›¢æ™‚ï¼Œæ‡‰ç‚ºæ¯å€‹åœ˜éšŠå»ºç«‹ç¨ç«‹çš„ Secret Scopeï¼Œä¸¦æˆäºˆ READ æ¬Šé™ï¼ˆç¬¦åˆæœ€å°æ¬Šé™åŸå‰‡ï¼‰ã€‚

**è€ƒè©¦é™·é˜±:**
- âŒ èª¤ä»¥ç‚ºå¯ä»¥å°å–®ä¸€ Secret Key è¨­å®šæ¬Šé™ï¼ˆé¸é … A/Bï¼‰
- âŒ æˆäºˆéé«˜æ¬Šé™ï¼ˆMANAGE è€Œé READï¼‰
- âŒ ä¾†æºç­”æ¡ˆå¯èƒ½æ¨™è¨»éŒ¯èª¤ï¼ˆB â†’ æ­£ç¢ºç­”æ¡ˆæ˜¯ Cï¼‰

**æ­£ç¢ºæ€ç¶­:**
- âœ… Secret Scope = æ¬Šé™æ§åˆ¶çš„æœ€å°ç²’åº¦
- âœ… åœ˜éšŠéš”é›¢ = æ¯å€‹åœ˜éšŠç¨ç«‹ Scope
- âœ… æœ€å°æ¬Šé™ = READï¼ˆä½¿ç”¨ secretsï¼‰è€Œé MANAGEï¼ˆç®¡ç† secretsï¼‰

**å¯¦ä½œæª¢æŸ¥æ¸…å–®:**
```python
# 1. ç‚ºåœ˜éšŠå»ºç«‹ç¨ç«‹ Scope
dbutils.secrets.createScope("team_xxx_scope")

# 2. æ–°å¢è©²åœ˜éšŠçš„æ†‘è­‰
dbutils.secrets.put("team_xxx_scope", "credential_key", "value")

# 3. æˆäºˆ READ æ¬Šé™
dbutils.secrets.setAcl("team_xxx_scope", "team_xxx", "READ")

# 4. é©—è­‰åœ˜éšŠå¯ä»¥è®€å–
# ï¼ˆç”±åœ˜éšŠæˆå“¡åŸ·è¡Œï¼‰
dbutils.secrets.get("team_xxx_scope", "credential_key")
```