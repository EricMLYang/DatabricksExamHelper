# Question 6

## Question
Given the following streaming query:



```
- spark.readStream
-         .table("orders_cleaned")
-         .withWatermark("order_timestamp", "10 minutes")
-         .groupBy(
-             window("order_timestamp", "5 minutes").alias("time"),
-             "author")
-         .agg(
-             count("order_id").alias("orders_count"),
-             avg("quantity").alias("avg_quantity"))
-     .writeStream
-         .option("checkpointLocation", "dbfs:/path/checkpoint")
-         .table("orders_stats")
```





Which of the following statements best describe this query ?

## Options
- A. It calculates business-level aggregates for each overlapping ten-minute interval. Incremental state information is maintained for 5 minutes for late-arriving data. 
- B. It calculates business-level aggregates for each overlapping five-minute interval. Incremental state information is maintained for 10 minutes for late-arriving data. 
- C. It calculates business-level aggregates for each non-overlapping five-minute interval. Incremental state information is maintained for 10 minutes for late-arriving data. (Correct)
- D. It calculates business-level aggregates for each non-overlapping ten-minute interval. Incremental state information is maintained for 5 minutes for late-arriving data. 

## Explanation
Pyspark.sql.functions.window function bucketizes rows into one or more time windows given a timestamp specifying column. In this query, we are performing aggregations per order_timestamp for each non-overlapping five minute interval.




pyspark.sql.DataFrame.withWatermark function allows you to only track state information for a window of time in which we expect records could be delayed. Here we define a watermark of 10 minutes.




Reference:

https://spark.apache.org/docs/3.1.3/api/python/reference/api/pyspark.sql.functions.window.html

https://spark.apache.org/docs/3.1.1/api/python/reference/api/pyspark.sql.DataFrame.withWatermark.html




Study materials from our exam preparation course on Udemy:

Hands-on

Hands-on
