# Question #033

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-033`

### ä¾†æº
**ä¾†æº:** Sample / Batch 1

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
A data engineering team is discussing the optimal data layout strategy on a growing managed Delta table in Unity Catalog. They are considering partitioning, Z-ordering, and Liquid Clustering to improve query performance.

Which scenario best indicates that Automatic Liquid Clustering is the recommended choice?

### é¸é …
- **A.** The table experiences diverse, frequently changing query filters across multiple columns, with unpredictable access patterns.

- **B.** None of the listed options are correct. Automatic Liquid Clustering can not be applied on managed tables.

- **C.** The table is heavily filtered by a consistent, small set of date ranges.

- **D.** The team has identified stable clustering keys for the table.

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Liquid-Clustering`, `Delta-Lake`, `Query-Optimization`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Performance Optimization

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `A`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** A
- **ç¤¾ç¾¤å…±è­˜:** A

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Automatic Liquid Clustering çš„é©ç”¨å ´æ™¯

**é—œéµæ¦‚å¿µ:**
- Partitioning vs Z-Ordering vs Liquid Clustering çš„å·®ç•°
- Automatic Liquid Clustering çš„å‹•æ…‹èª¿æ•´èƒ½åŠ›
- æŸ¥è©¢æ¨¡å¼èˆ‡è³‡æ–™ä½ˆå±€ç­–ç•¥çš„é—œä¿‚

**é¡Œç›®é—œéµå­—ï¼š**
- **diverse, frequently changing**: å¤šæ¨£ã€é »ç¹è®ŠåŒ–
- **unpredictable access patterns**: ä¸å¯é æ¸¬çš„å­˜å–æ¨¡å¼
- **Automatic Liquid Clustering**: è‡ªå‹•æ¶²æ…‹å¢é›†

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ A æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

**Automatic Liquid Clustering** çš„æ ¸å¿ƒç‰¹æ€§æ˜¯**å‹•æ…‹é©æ‡‰è®ŠåŒ–çš„æŸ¥è©¢æ¨¡å¼**ã€‚ç•¶æŸ¥è©¢éæ¿¾æ¢ä»¶ï¼š
- æ¶‰åŠ**å¤šå€‹æ¬„ä½**
- **é »ç¹è®ŠåŒ–**
- **ä¸å¯é æ¸¬**

é€™æ™‚å‚³çµ±çš„ Partitioning å’Œ Z-Ordering éƒ½ç„¡æ³•æœ‰æ•ˆå„ªåŒ–ï¼Œå› ç‚ºå®ƒå€‘éœ€è¦**äº‹å…ˆç¢ºå®šå›ºå®šçš„æ¬„ä½**ã€‚

#### Automatic Liquid Clustering çš„å„ªå‹¢

| ç‰¹æ€§ | èªªæ˜ |
|------|------|
| **è‡ªå‹•èª¿æ•´** | æ ¹æ“šæœ€è¿‘çš„æŸ¥è©¢è‡ªå‹•é‡æ–°çµ„ç¹”è³‡æ–™ |
| **å¤šæ¬„ä½æ”¯æ´** | å¯ä»¥åŒæ™‚å„ªåŒ–å¤šå€‹æ¬„ä½çš„æŸ¥è©¢ |
| **ç„¡éœ€é å…ˆå®šç¾©** | ä¸éœ€è¦é å…ˆæŒ‡å®š clustering key |
| **å‹•æ…‹é©æ‡‰** | ç•¶æŸ¥è©¢æ¨¡å¼æ”¹è®Šæ™‚è‡ªå‹•èª¿æ•´ |

#### å•Ÿç”¨ Automatic Liquid Clustering

```sql
-- å»ºç«‹è¡¨æ ¼æ™‚å•Ÿç”¨
CREATE TABLE my_table (
    id BIGINT,
    name STRING,
    region STRING,
    category STRING,
    event_date DATE
)
USING DELTA
CLUSTER BY AUTO;  -- è‡ªå‹• clustering

-- å°ç¾æœ‰è¡¨æ ¼å•Ÿç”¨
ALTER TABLE my_table
CLUSTER BY AUTO;
```

#### Automatic vs Manual Liquid Clustering

```sql
-- Manual Liquid Clusteringï¼ˆéœ€è¦æŒ‡å®šæ¬„ä½ï¼‰
ALTER TABLE my_table CLUSTER BY (region, category);

-- Automatic Liquid Clusteringï¼ˆç³»çµ±è‡ªå‹•é¸æ“‡ï¼‰
ALTER TABLE my_table CLUSTER BY AUTO;
```

#### é©ç”¨å ´æ™¯å°æ¯”

| å ´æ™¯ | æœ€ä½³ç­–ç•¥ |
|------|---------|
| æŸ¥è©¢æ¨¡å¼**ä¸å¯é æ¸¬**ã€**å¤šè®Š** | âœ… **Automatic Liquid Clustering** |
| æŸ¥è©¢æ¨¡å¼**å›ºå®š**ã€å·²çŸ¥ clustering key | Manual Liquid Clustering |
| ä¸»è¦æŒ‰**æ—¥æœŸ**éæ¿¾ | Partitioning |
| æŸ¥è©¢æ¬„ä½**å›ºå®š**ä½†éåˆ†å€æ¬„ä½ | Z-Ordering |

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### é¸é … B
**None of the listed options are correct. Automatic Liquid Clustering can not be applied on managed tables.**

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

1. **å®Œå…¨éŒ¯èª¤çš„é™³è¿°**ï¼š
   - Automatic Liquid Clustering **å¯ä»¥**æ‡‰ç”¨åœ¨ managed tables
   - é€™æ˜¯ Unity Catalog managed tables çš„**æ”¯æ´åŠŸèƒ½**

2. **Liquid Clustering æ”¯æ´çš„è¡¨æ ¼é¡å‹**ï¼š
   - âœ… Managed Tables
   - âœ… External Tables
   - âŒ ä¸æ”¯æ´å·²æœ‰ partitioning çš„è¡¨æ ¼ï¼ˆéœ€è¦å…ˆç§»é™¤ partitionï¼‰

---

### é¸é … C
**The table is heavily filtered by a consistent, small set of date ranges.**

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

1. **é€™å€‹å ´æ™¯é©åˆ Partitioning**ï¼š
   - ã€Œconsistent, small set of date rangesã€= ç©©å®šçš„æ—¥æœŸéæ¿¾
   - é€™æ­£æ˜¯ Partitioning æœ€æ“…é•·çš„å ´æ™¯

2. **æœ€ä½³ç­–ç•¥**ï¼š
```sql
-- é€™ç¨®å ´æ™¯ç”¨ Partitioning æœ€å¥½
CREATE TABLE events (
    ...
    event_date DATE
)
USING DELTA
PARTITIONED BY (event_date);
```

---

### é¸é … D
**The team has identified stable clustering keys for the table.**

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

1. **é€™å€‹å ´æ™¯é©åˆ Manual Liquid Clustering**ï¼š
   - ã€Œstable clustering keysã€= å·²çŸ¥ä¸”ç©©å®šçš„ clustering æ¬„ä½
   - é€™æ™‚æ‡‰è©²ç›´æ¥æŒ‡å®šæ¬„ä½ï¼Œä¸éœ€è¦è‡ªå‹•åŠŸèƒ½

2. **æœ€ä½³ç­–ç•¥**ï¼š
```sql
-- å·²çŸ¥ç©©å®šçš„ clustering keyï¼Œç›´æ¥æŒ‡å®š
ALTER TABLE my_table
CLUSTER BY (known_key1, known_key2);
```

3. **Automatic çš„åƒ¹å€¼æ˜¯ã€Œä¸ç¢ºå®šã€æ™‚**ï¼š
   - ç•¶ä½ **ä¸ç¢ºå®š**æœ€ä½³ clustering key æ˜¯ä»€éº¼
   - æˆ–æŸ¥è©¢æ¨¡å¼**ä¸€ç›´åœ¨è®Š**
   - é€™æ™‚æ‰éœ€è¦ Automatic

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£
**ã€ŒæŸ¥è©¢å¤šè®Šé¸ Autoï¼Œæ¨¡å¼ç©©å®šè‡ªå·±æŒ‘ã€**
â†’ æŸ¥è©¢æ¨¡å¼ä¸ç¢ºå®šã€å¤šè®Šæ™‚ç”¨ Automaticï¼›å·²çŸ¥ç©©å®šæ¨¡å¼æ™‚æ‰‹å‹•æŒ‡å®š

### è³‡æ–™ä½ˆå±€ç­–ç•¥æ±ºç­–æ¨¹

```
æŸ¥è©¢éæ¿¾æ¬„ä½çš„ç‰¹æ€§ï¼Ÿ
    â”‚
    â”œâ”€â”€ ä¸»è¦æ˜¯æ—¥æœŸ/æ™‚é–“ + ä½åŸºæ•¸
    â”‚   â””â”€â”€ âœ… Partitioning
    â”‚
    â”œâ”€â”€ å·²çŸ¥å›ºå®šçš„é«˜åŸºæ•¸æ¬„ä½
    â”‚   â”œâ”€â”€ æƒ³è¦ç°¡å–®ç¶­è­· â†’ âœ… Manual Liquid Clustering
    â”‚   â””â”€â”€ å¯ä»¥æ¥å—å®šæœŸç¶­è­· â†’ âœ… Z-Ordering
    â”‚
    â””â”€â”€ å¤šæ¬„ä½ã€ä¸ç¢ºå®šã€ç¶“å¸¸è®ŠåŒ–
        â””â”€â”€ âœ… Automatic Liquid Clustering
```

### ä¸‰ç¨®ç­–ç•¥æ¯”è¼ƒ

| ç­–ç•¥ | é©ç”¨å ´æ™¯ | å„ªé» | ç¼ºé» |
|------|---------|------|------|
| **Partitioning** | ä½åŸºæ•¸ã€æ—¥æœŸéæ¿¾ | æœ€å¿«çš„è£å‰ªæ•ˆæœ | å°æª”æ¡ˆå•é¡Œã€ç„¡æ³•è®Šæ›´ |
| **Z-Ordering** | å›ºå®šçš„é«˜åŸºæ•¸æ¬„ä½ | é©åˆè¤‡åˆæŸ¥è©¢ | éœ€è¦å®šæœŸ OPTIMIZE |
| **Liquid Clustering** | å¤šæ¬„ä½ã€å‹•æ…‹æŸ¥è©¢ | è‡ªå‹•ç¶­è­·ã€å¯è®Šæ›´ | éœ€è¦ DBR 13.3+ |
| **Auto LC** | æŸ¥è©¢æ¨¡å¼ä¸ç¢ºå®š | å®Œå…¨è‡ªå‹•åŒ– | å¯èƒ½ä¸å¦‚æ‰‹å‹•ç²¾æº– |

### Automatic Liquid Clustering é‹ä½œåŸç†

```
æŸ¥è©¢ 1: WHERE region = 'US'
æŸ¥è©¢ 2: WHERE category = 'Electronics'
æŸ¥è©¢ 3: WHERE name LIKE 'Product%'
...

        â†“ ç³»çµ±åˆ†ææŸ¥è©¢æ¨¡å¼

Automatic Liquid Clustering è‡ªå‹•åˆ¤æ–·ï¼š
- å“ªäº›æ¬„ä½æœ€å¸¸è¢«éæ¿¾
- å¦‚ä½•é‡æ–°çµ„ç¹”è³‡æ–™ä»¥å„ªåŒ–é€™äº›æŸ¥è©¢
- æŒçºŒæ ¹æ“šæ–°çš„æŸ¥è©¢æ¨¡å¼èª¿æ•´

        â†“ è‡ªå‹•åŸ·è¡Œ OPTIMIZE

è³‡æ–™è‡ªå‹•é‡æ–°èšé›†ä»¥å„ªåŒ–æœ€è¿‘çš„æŸ¥è©¢æ¨¡å¼
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [Liquid Clustering](https://docs.databricks.com/en/delta/clustering.html)
- [Automatic Liquid Clustering](https://docs.databricks.com/en/delta/clustering.html#automatic)
- [When to use Liquid Clustering](https://docs.databricks.com/en/delta/clustering.html#when-to-use)

---

**[è¿”å›é¡Œç›®](#question-033)**
