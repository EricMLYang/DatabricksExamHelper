# Question #007

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-007`

### ä¾†æº
**ä¾†æº:** Sample / Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

A data engineer has the following query to join the large `sales` table (about 10 billion records) with a smaller `customers` table (about 5 million records):

```sql
SELECT ______________
    s.sale_id, s.amount, c.customer_name
FROM sales AS s
INNER JOIN customers AS c
ON s.customer_id = c.customer_id;
```

The engineer wants to add a **broadcast hint** to instruct the query optimizer to perform a broadcast join on the `customers` table.

Which option correctly fills in the blank to achieve this?

### é¸é …

- **A.** `BROADCAST(c)`
- **B.** `/*+ BROADCAST(c) */`
- **C.** `- - BROADCAST(c) --`
- **D.** `BROADCAST ON (c)`

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Spark-SQL`, `Spark-Performance`, `Spark-Joins`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Syntax-Confusion`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Optimization

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `B`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** B
- **ç¤¾ç¾¤å…±è­˜:** B

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Spark SQL Optimization Hints  
**é—œéµæ¦‚å¿µ:** Broadcast Hash Join (BHJ) Hint Syntax

**é¡Œç›®é—œéµå­—ï¼š**
- **Broadcast hint**: å»£æ’­æç¤ºã€‚
- **Query optimizer**: æŸ¥è©¢å„ªåŒ–å™¨ (Catalyst)ã€‚
- **Syntax**: æ­£ç¢ºçš„ SQL èªæ³•çµæ§‹ã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ B (`/*+ BROADCAST(c) */`) æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

åœ¨ Spark SQL ä¸­ï¼ŒHints æ˜¯ç”¨ä¾†æ‰‹å‹•å¼•å°å„ªåŒ–å™¨é¸æ“‡ç‰¹å®šåŸ·è¡Œç­–ç•¥çš„æ©Ÿåˆ¶ã€‚æ¨™æº–çš„ ANSI SQL Hint èªæ³•æ˜¯æ¡ç”¨ **C-style block comments**ï¼Œä¸¦ä»¥ `+` è™Ÿé–‹é ­ï¼Œç·Šæ¥åœ¨ `SELECT` é—œéµå­—ä¹‹å¾Œã€‚

**æ­£ç¢ºèªæ³•ï¼š**

```sql
SELECT /*+ BROADCAST(table_name_or_alias) */ ...
```

**åœ¨æœ¬é¡Œä¸­çš„æ‡‰ç”¨ï¼š**
- é¡Œç›®è¦æ±‚å»£æ’­ `customers` è¡¨ (alias `c`)ã€‚
- å› ç‚º `customers` è¡¨è¼ƒå° (5M)ï¼Œ`sales` è¡¨å¾ˆå¤§ (10B)ï¼Œä½¿ç”¨ Broadcast Join å¯ä»¥é¿å…å¤§è¡¨ Shuffleï¼Œé¡¯è‘—æå‡æ•ˆèƒ½ã€‚

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A - `BROADCAST(c)`

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **èªæ³•éŒ¯èª¤**: é€™çœ‹èµ·ä¾†åƒæ˜¯ä¸€å€‹å‡½æ•¸èª¿ç”¨ã€‚SQL è§£æå™¨æœƒå˜—è©¦å°‹æ‰¾åç‚º `BROADCAST` çš„ UDF æˆ–æ˜¯æ¬„ä½ï¼Œä½†é€™è£¡æ˜¯æ”¾åœ¨ `SELECT` é—œéµå­—å¾Œé¢çš„ Hint ä½ç½®ï¼Œæ²’æœ‰è¢«æ­£ç¢ºåŒ…è£¹åœ¨è¨»è§£å€å¡Šä¸­ï¼Œæœƒå°è‡´ Syntax Errorã€‚

### C - `- - BROADCAST(c) --` (é›™æ©«ç·šè¨»è§£)

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **æ ¼å¼éŒ¯èª¤**: é›–ç„¶ `--` æ˜¯ SQL çš„å–®è¡Œè¨»è§£ï¼Œä½† Spark SQL Hint çš„æ¨™æº–æ ¼å¼å¿…é ˆæ˜¯å€å¡Šè¨»è§£ `/*+ ... */`ã€‚ä¸€èˆ¬çš„è¨»è§£æœƒè¢«è§£æå™¨å¿½ç•¥ï¼Œä¸æœƒè¢«è­˜åˆ¥ç‚º Hintã€‚

### D - `BROADCAST ON (c)`

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **èªæ³•ç„¡æ•ˆ**: é€™ä¸æ˜¯æœ‰æ•ˆçš„ Spark SQL èªæ³•ã€‚`BROADCAST` Hint ä¸éœ€è¦ `ON` é—œéµå­—ï¼Œä¸”å¿…é ˆæ”¾åœ¨ç‰¹æ®Šçš„è¨»è§£å€å¡Šä¸­ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€ŒSELECT å¾Œé¢åŠ åŠ è™Ÿï¼Œæ–œç·šæ˜Ÿè™Ÿä¸å¯å°‘ã€**

- **`/*+ ... */`**: é€™æ˜¯ Hint çš„æ¨™æº–åŒ…è£ã€‚
- æ³¨æ„ `+` è™Ÿå¿…é ˆç·Šè·Ÿåœ¨é–‹é ­çš„ `/*` ä¹‹å¾Œã€‚

### å…¶ä»–å¸¸è¦‹ Hints

| Hint é—œéµå­— | ç”¨é€” | èªæ³•ç¯„ä¾‹ |
|-------------|------|----------|
| `BROADCAST` | å¼·åˆ¶å»£æ’­ Join | `/*+ BROADCAST(t1) */` |
| `MERGE` | å¼·åˆ¶ Sort Merge Join | `/*+ MERGE(t1) */` |
| `SHUFFLE_HASH` | å¼·åˆ¶ Shuffle Hash Join | `/*+ SHUFFLE_HASH(t1) */` |
| `COALESCE` | æ¸›å°‘ Partition æ•¸ | `/*+ COALESCE(3) */` |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [JOIN Hints (Spark SQL)](https://spark.apache.org/docs/latest/sql-ref-syntax-qry-select-hints.html#join-hints)
- [Databricks Performance Tuning - Join Hints](https://docs.databricks.com/optimizations/hints.html)

---

**[è¿”å›é¡Œç›®](#question-007)**
