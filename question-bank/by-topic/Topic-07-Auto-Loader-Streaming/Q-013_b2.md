# Question #013

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-013`

### ä¾†æº
**ä¾†æº:** Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

For production Structured Streaming jobs, which of the following retry policies is recommended to use?

### é¸é …

- **A.** Unlimited Retries, with 1 Maximum Concurrent Run
- **B.** Unlimited Retries, with Unlimited Concurrent Runs
- **C.** No Retries, with 1 Maximum Concurrent Run
- **D.** No Retries, with Unlimited Concurrent Runs

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Streaming`, `Databricks-Workflows`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Default-Value`, `Execution-Behavior`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Operations

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `A`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** A
- **ç¤¾ç¾¤å…±è­˜:** A

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Structured Streaming / Job Configuration
**é—œéµæ¦‚å¿µ:** Retry policy, Concurrent runs, Query recovery

**é¡Œç›®é—œéµå­—ï¼š**
- **production**: ç”Ÿç”¢ç’°å¢ƒçš„æœ€ä½³å¯¦å‹™ã€‚
- **Structured Streaming jobs**: ä¸²æµä»»å‹™ï¼Œéœ€è¦æŒçºŒé‹è¡Œã€‚
- **retry policies**: å¤±æ•—æ™‚çš„é‡è©¦ç­–ç•¥ã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ A æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

1. **Unlimited Retries çš„åŸå› **:
   - ä¸²æµä»»å‹™è¨­è¨ˆç‚ºæŒçºŒé‹è¡Œ
   - æš«æ™‚æ€§å¤±æ•—ï¼ˆç¶²è·¯å•é¡Œã€è³‡æºä¸è¶³ï¼‰æ‡‰è‡ªå‹•æ¢å¾©
   - é€é checkpoint å¯ä»¥å¾ä¸Šæ¬¡è™•ç†ä½ç½®ç¹¼çºŒ
   - ä¸æ‡‰å› ç‚ºæš«æ™‚å•é¡Œè€Œæ°¸ä¹…åœæ­¢

2. **1 Maximum Concurrent Run çš„åŸå› **:
   - æ¯å€‹ä¸²æµæŸ¥è©¢åªèƒ½æœ‰ä¸€å€‹æ´»èºå¯¦ä¾‹
   - å¤šå€‹å¯¦ä¾‹æœƒå°è‡´ï¼š
     - Checkpoint è¡çª
     - è³‡æ–™é‡è¤‡è™•ç†
     - ç‹€æ…‹ç®¡ç†æ··äº‚
   - é€™æ˜¯ Structured Streaming çš„æ¶æ§‹é™åˆ¶

**å®˜æ–¹æ¨è–¦çš„å®Œæ•´è¨­å®šï¼š**

| è¨­å®šé … | å»ºè­°å€¼ | åŸå›  |
|--------|--------|------|
| **Retries** | Unlimited | è‡ªå‹•æ¢å¾©å¤±æ•— |
| **Max Concurrent Runs** | 1 | é¿å…å¤šå¯¦ä¾‹è¡çª |
| **Cluster** | New job cluster | æ¯æ¬¡ä¹¾æ·¨çš„ç’°å¢ƒ |
| **Schedule** | ä¸è¨­å®š | ä¸²æµä»»å‹™æŒçºŒé‹è¡Œ |
| **Timeout** | ä¸è¨­å®š | ä¸²æµä»»å‹™ç„¡é™æœŸé‹è¡Œ |
| **Notifications** | å•Ÿç”¨ | å¤±æ•—æ™‚æ”¶åˆ°é€šçŸ¥ |

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### B - Unlimited Retries + Unlimited Concurrent Runs

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **ä¸¦è¡Œè¡çª**: å¤šå€‹ä¸²æµæŸ¥è©¢å¯¦ä¾‹æœƒçˆ­å¥ªç›¸åŒçš„ checkpointã€‚
- **è³‡æ–™é‡è¤‡**: å¯èƒ½å°è‡´é‡è¤‡è™•ç†ç›¸åŒçš„è³‡æ–™ã€‚
- **ç‹€æ…‹ä¸ä¸€è‡´**: æœ‰ç‹€æ…‹çš„æ“ä½œï¼ˆå¦‚ aggregationï¼‰æœƒå‡ºéŒ¯ã€‚

### C - No Retries + 1 Maximum Concurrent Run

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **ç¼ºä¹å®¹éŒ¯**: ä»»ä½•æš«æ™‚æ€§å¤±æ•—éƒ½æœƒå°è‡´ä»»å‹™æ°¸ä¹…åœæ­¢ã€‚
- **ä¸é©åˆç”Ÿç”¢ç’°å¢ƒ**: ç”Ÿç”¢ç’°å¢ƒéœ€è¦è‡ªå‹•æ¢å¾©èƒ½åŠ›ã€‚
- **éœ€è¦äººå·¥ä»‹å…¥**: æ¯æ¬¡å¤±æ•—éƒ½éœ€è¦æ‰‹å‹•é‡å•Ÿã€‚

### D - No Retries + Unlimited Concurrent Runs

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **é›™é‡å•é¡Œ**: åŒæ™‚å…·æœ‰ B å’Œ C é¸é …çš„å•é¡Œã€‚
- **ä¸å®¹éŒ¯**: å¤±æ•—ä¸æœƒè‡ªå‹•æ¢å¾©ã€‚
- **æœƒä¸¦è¡Œè¡çª**: å¤šå¯¦ä¾‹æœƒäº’ç›¸å¹²æ“¾ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€Œä¸²æµè¦é•·è·‘ï¼Œç„¡é™é‡è©¦å–®å¯¦ä¾‹ã€**

- **ç„¡é™é‡è©¦**: ç¢ºä¿æŒçºŒé‹è¡Œ
- **å–®ä¸€å¯¦ä¾‹**: é¿å…è¡çª

### Structured Streaming Job é…ç½®æª¢æŸ¥æ¸…å–®

```
âœ… Retries: Unlimited
âœ… Max Concurrent Runs: 1
âœ… New Job Cluster: Yes
âœ… Schedule: None (continuous)
âœ… Timeout: None (indefinite)
âœ… Notifications: Enabled
```

### ä¸²æµ vs æ‰¹æ¬¡ Job è¨­å®šæ¯”è¼ƒ

| è¨­å®š | ä¸²æµ Job | æ‰¹æ¬¡ Job |
|------|----------|----------|
| Retries | Unlimited | æœ‰é™æ¬¡æ•¸ï¼ˆå¦‚ 3ï¼‰ |
| Max Concurrent | 1 | å¯ä»¥ > 1 |
| Schedule | ä¸è¨­å®š | è¨­å®š Cron |
| Timeout | ä¸è¨­å®š | å¯è¨­å®š |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [Configure Streaming Jobs](https://docs.databricks.com/structured-streaming/query-recovery.html#configure-structured-streaming-jobs-to-restart-streaming-queries-on-failure)
- [Job Configuration Best Practices](https://docs.databricks.com/workflows/jobs/jobs.html)
- [Query Recovery](https://docs.databricks.com/structured-streaming/query-recovery.html)

---

**[è¿”å›é¡Œç›®](#question-013)**
