# Question #006

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-006`

### ä¾†æº
**ä¾†æº:** Sample / Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

Given the following streaming query:

```python
spark.readStream
    .table("orders_cleaned")
    .withWatermark("order_timestamp", "10 minutes")
    .groupBy(
        window("order_timestamp", "5 minutes").alias("time"),
        "author")
    .agg(
        count("order_id").alias("orders_count"),
        avg("quantity").alias("avg_quantity"))
    .writeStream
    .option("checkpointLocation", "dbfs:/path/checkpoint")
    .table("orders_stats")
```

Which of the following statements best describe this query?

### é¸é …

- **A.** It calculates business-level aggregates for each overlapping ten-minute interval. Incremental state information is maintained for 5 minutes for late-arriving data.
- **B.** It calculates business-level aggregates for each overlapping five-minute interval. Incremental state information is maintained for 10 minutes for late-arriving data.
- **C.** It calculates business-level aggregates for each non-overlapping five-minute interval. Incremental state information is maintained for 10 minutes for late-arriving data.
- **D.** It calculates business-level aggregates for each non-overlapping ten-minute interval. Incremental state information is maintained for 5 minutes for late-arriving data.

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Streaming`, `Streaming-Windowing`, `Streaming-Stateful`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`, `Parameter-Order`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Development

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `C`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** C
- **ç¤¾ç¾¤å…±è­˜:** C

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Structured Streaming Windowing & Watermarking  
**é—œéµæ¦‚å¿µ:** Tumbling Window (Non-overlapping) vs Sliding Window, Late Data Handling

**é¡Œç›®é—œéµå­—ï¼š**
- **window("order_timestamp", "5 minutes")**: å®šç¾©è¦–çª—å¤§å°ã€‚
- **withWatermark("order_timestamp", "10 minutes")**: å®šç¾©å»¶é²è³‡æ–™å®¹å¿åº¦ã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ C æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

1.  **Window é¡å‹åˆ¤æ–·**:
    *   èªæ³•: `window(timeColumn, windowDuration, slideDuration)`
    *   ç¨‹å¼ç¢¼: `window("order_timestamp", "5 minutes")`
    *   åˆ†æ: é€™è£¡åªæä¾›äº† `windowDuration` (5åˆ†é˜)ï¼Œæ²’æœ‰æä¾› `slideDuration`ã€‚
    *   çµè«–: ç•¶æ²’æœ‰æŒ‡å®š slide duration æ™‚ï¼Œé è¨­ç­‰æ–¼ window durationã€‚é€™ç”±å®šç¾©ä¸Šå°±æ˜¯ **Tumbling Window (æ»¾å‹•è¦–çª—)**ï¼Œç‰¹æ€§æ˜¯ **Non-overlapping (ä¸é‡ç–Š)** ä¸”é€£çºŒçš„ã€‚

2.  **Watermark åˆ¤æ–·**:
    *   èªæ³•: `.withWatermark(eventTimeColumn, delayThreshold)`
    *   ç¨‹å¼ç¢¼: `.withWatermark("order_timestamp", "10 minutes")`
    *   çµè«–: è¨­å®šäº† 10 åˆ†é˜çš„æ°´ä½ç·šã€‚æ„æ€æ˜¯ Spark æœƒç¶­è­·ç‹€æ…‹ (State)ï¼Œç­‰å¾… **10 åˆ†é˜** å…§çš„é²åˆ°è³‡æ–™ (Late-arriving data)ã€‚è¶…éé€™æ™‚é–“çš„èˆŠè³‡æ–™å°‡è¢«ä¸Ÿæ£„ã€‚

çµåˆä»¥ä¸Šå…©é»ï¼š"Non-overlapping five-minute interval" + "maintained for 10 minutes"ã€‚

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A & D - éŒ¯èª¤çš„è¦–çª—æˆ–æ°´ä½ç·šæ•¸å€¼

*   **A**: èªªæ˜¯ "ten-minute interval" (éŒ¯ï¼Œä»£ç¢¼æ˜¯ 5 min) ä¸” "overlapping" (éŒ¯)ã€‚æ°´ä½ç·šè®Šæˆ 5 min (éŒ¯ï¼Œä»£ç¢¼æ˜¯ 10 min)ã€‚
*   **D**: èªªæ˜¯ "ten-minute interval" (éŒ¯)ã€‚

### B - Overlapping vs Non-overlapping

*   **æ•˜è¿°**: "overlapping five-minute interval"
*   **ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**: è‹¥è¦ç”¢ç”Ÿ Overlapping (Sliding) Windowï¼Œä»£ç¢¼å¿…é ˆé•·é€™æ¨£ï¼š`window("time", "5 minutes", "2 minutes")` (Window > Slide)ã€‚æœ¬é¡Œä»£ç¢¼åªçµ¦äº†ä¸€å€‹åƒæ•¸ "5 minutes"ï¼Œå› æ­¤æ˜¯ **Non-overlapping**ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€Œåƒæ•¸ä¸€å€‹æ˜¯æ»¾å‹• (Tumbling)ï¼Œå…©å€‹æ‰æ˜¯æ»‘å‹• (Sliding)ã€**

- `window("5 min")`: æ»¾å‹• (ä¸é‡ç–Š, Tumbling)
- `window("10 min", "5 min")`: æ»‘å‹• (é‡ç–Š, Sliding)

**Watermark = å¯¬å®¹åº¦**
- `withWatermark("10 min")`: é¡˜æ„ç­‰é²åˆ° 10 åˆ†é˜çš„è³‡æ–™ã€‚

### è¦–çª—é¡å‹é€ŸæŸ¥è¡¨

| å‡½æ•¸åƒæ•¸ | é¡å‹ | ç‰¹æ€§ | ç¯„ä¾‹ |
|----------|------|------|------|
| `window(col, "5m")` | Tumbling | ä¸é‡ç–Šã€é¦–å°¾ç›¸æ¥ | [00:00-00:05], [00:05-00:10] |
| `window(col, "10m", "5m")` | Sliding | é‡ç–Š | [00:00-00:10], [00:05-00:15] |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [Window Operations on Event Time](https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#window-operations-on-event-time)
- [Handling Late Data and Watermarking](https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#handling-late-data-and-watermarking)

---

**[è¿”å›é¡Œç›®](#question-006)**
