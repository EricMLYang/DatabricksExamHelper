# Question #017

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-017`

### ä¾†æº
**ä¾†æº:** Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

Which of the following statements regarding the retention policy of Delta Lake CDF is correct?

### é¸é …

- **A.** Running the VACUUM command on the table does not delete CDF data.
- **B.** Running the VACUUM command on the table does not delete CDF data unless CASCADE clause is set to true.
- **C.** Running the VACUUM command on the table deletes CDF data as well.
- **D.** CDF data files can be purged by running VACUUM CHANGES command.

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Delta-Lake`, `Delta-CDC`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Execution-Behavior`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Data Management

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `C`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** C
- **ç¤¾ç¾¤å…±è­˜:** C

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Delta Lake / CDF / VACUUM
**é—œéµæ¦‚å¿µ:** CDF retention policy, _change_data folder, VACUUM behavior

**é¡Œç›®é—œéµå­—ï¼š**
- **retention policy**: CDF è³‡æ–™çš„ä¿ç•™æ”¿ç­–ã€‚
- **VACUUM command**: æ¸…ç†éæœŸæª”æ¡ˆçš„å‘½ä»¤ã€‚
- **CDF data**: Change Data Feed è³‡æ–™ã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ C æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

1. **CDF è³‡æ–™çš„å„²å­˜ä½ç½®**:
   CDF è³‡æ–™å„²å­˜åœ¨è¡¨æ ¼ç›®éŒ„ä¸‹çš„ `_change_data` è³‡æ–™å¤¾ä¸­ã€‚

2. **CDF éµå¾ªè¡¨æ ¼çš„ä¿ç•™æ”¿ç­–**:
   - `_change_data` è³‡æ–™å¤¾ä¸­çš„æª”æ¡ˆèˆ‡è¡¨æ ¼çš„ä¸»è¦è³‡æ–™æª”æ¡ˆéµå¾ªç›¸åŒçš„ä¿ç•™æ”¿ç­–
   - ç•¶åŸ·è¡Œ `VACUUM` æ™‚ï¼ŒéæœŸçš„ CDF è³‡æ–™ä¹Ÿæœƒè¢«åˆªé™¤

3. **VACUUM çš„å½±éŸ¿ç¯„åœ**:
   ```
   VACUUM table_name RETAIN 168 HOURS

   åˆªé™¤çš„å…§å®¹ï¼š
   â”œâ”€â”€ éæœŸçš„è³‡æ–™æª”æ¡ˆ (.parquet)
   â””â”€â”€ éæœŸçš„ CDF æª”æ¡ˆ (_change_data/*.parquet)
   ```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A - VACUUM ä¸åˆªé™¤ CDF è³‡æ–™

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **äº‹å¯¦ç›¸å**: VACUUM æœƒåˆªé™¤éæœŸçš„ CDF è³‡æ–™ã€‚
- **CDF èˆ‡è¡¨æ ¼å…±ç”¨ä¿ç•™æ”¿ç­–**: æ²’æœ‰ä¾‹å¤–ã€‚

### B - éœ€è¦ CASCADE å­å¥

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **CASCADE ä¸å­˜åœ¨**: VACUUM å‘½ä»¤æ²’æœ‰ CASCADE å­å¥ã€‚
- **VACUUM çš„èªæ³•**: `VACUUM table_name [RETAIN num HOURS]`

### D - VACUUM CHANGES å‘½ä»¤

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **å‘½ä»¤ä¸å­˜åœ¨**: æ²’æœ‰ `VACUUM CHANGES` é€™å€‹å‘½ä»¤ã€‚
- **æ­£ç¢ºå‘½ä»¤**: ä½¿ç”¨æ¨™æº–çš„ `VACUUM` å‘½ä»¤å³å¯ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€ŒVACUUM æ¸…å…¨éƒ¨ï¼ŒCDF ä¹Ÿä¸ç•™ã€**

### CDF èˆ‡ VACUUM é—œä¿‚

| æ“ä½œ | å°ä¸»è³‡æ–™çš„å½±éŸ¿ | å° CDF çš„å½±éŸ¿ |
|------|---------------|---------------|
| **VACUUM** | åˆªé™¤éæœŸæª”æ¡ˆ | **åŒæ¨£åˆªé™¤éæœŸ CDF** |
| **OPTIMIZE** | åˆä½µå°æª”æ¡ˆ | ä¸å½±éŸ¿ CDF |
| **DELETE** | åˆªé™¤è³‡æ–™ | ç”¢ç”Ÿæ–°çš„ CDF è¨˜éŒ„ |

### VACUUM å½±éŸ¿ç¯„åœ

```
è¡¨æ ¼ç›®éŒ„/
â”œâ”€â”€ _delta_log/          â† ä¸å— VACUUM å½±éŸ¿
â”œâ”€â”€ _change_data/        â† âœ… VACUUM æœƒæ¸…ç†
â”œâ”€â”€ part-*.parquet       â† âœ… VACUUM æœƒæ¸…ç†
â””â”€â”€ ...
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [CDF Storage](https://docs.databricks.com/delta/delta-change-data-feed.html#change-data-storage)
- [VACUUM](https://docs.databricks.com/delta/vacuum.html)

---

**[è¿”å›é¡Œç›®](#question-017)**
