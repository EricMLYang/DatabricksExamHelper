# Question #007

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-007`

### ä¾†æº
**ä¾†æº:** Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

The data engineering team maintains a Delta Lake table of SCD Type 1. A junior data engineer noticed a folder named '_change_data' in the table directory, and wants to understand what this folder is used for.

Which of the following describes the purpose of this folder?

### é¸é …

- **A.** CDF feature is enabled on the table. The '_change_data' folder is the location where CDF data is stored.
- **B.** The '_change_data' folder is the default directory to track the evolution in schema definition.
- **C.** Optimized Writes feature is enabled on the table. The '_change_data' folder is the location where the optimized data is stored.
- **D.** All SCD Type 1 tables have the '_change_data' folder to track the updates applied on the table's data.

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Delta-Lake`, `Delta-CDC`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Development

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `A`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** A
- **ç¤¾ç¾¤å…±è­˜:** A

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Delta Lake / Change Data Feed (CDF)
**é—œéµæ¦‚å¿µ:** _change_data folder, CDF storage, VACUUM interaction

**é¡Œç›®é—œéµå­—ï¼š**
- **_change_data folder**: CDF çš„å„²å­˜ä½ç½®ã€‚
- **SCD Type 1**: åªæ˜¯èƒŒæ™¯è³‡è¨Šï¼Œé‡é»åœ¨ `_change_data` è³‡æ–™å¤¾ã€‚
- **table directory**: Delta è¡¨çš„æª”æ¡ˆç³»çµ±çµæ§‹ã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ A æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

1. **Change Data Feed (CDF) åŠŸèƒ½**:
   CDF æ˜¯ Delta Lake çš„åŠŸèƒ½ï¼Œç”¨æ–¼è¿½è¹¤è¡¨æ ¼çš„è®Šæ›´æ­·å²ï¼ˆINSERTã€UPDATEã€DELETEï¼‰ã€‚å•Ÿç”¨ CDF å¾Œï¼ŒDelta Lake æœƒåœ¨è¡¨æ ¼ç›®éŒ„ä¸‹å»ºç«‹ `_change_data` è³‡æ–™å¤¾ä¾†å„²å­˜è®Šæ›´è³‡æ–™ã€‚

2. **`_change_data` è³‡æ–™å¤¾çš„ç”¨é€”**:
   - å„²å­˜ UPDATEã€DELETEã€MERGE æ“ä½œç”¢ç”Ÿçš„è®Šæ›´è¨˜éŒ„
   - åŒ…å« `_change_type` æ¬„ä½æ¨™è¨˜æ“ä½œé¡å‹
   - éµå¾ªè¡¨æ ¼çš„ä¿ç•™æ”¿ç­–ï¼ˆVACUUM æœƒåˆªé™¤éæœŸçš„ CDF è³‡æ–™ï¼‰

3. **å•Ÿç”¨ CDF çš„æ–¹å¼**:
   ```sql
   -- å»ºè¡¨æ™‚å•Ÿç”¨
   CREATE TABLE my_table (...)
   TBLPROPERTIES (delta.enableChangeDataFeed = true);

   -- å°ç¾æœ‰è¡¨å•Ÿç”¨
   ALTER TABLE my_table
   SET TBLPROPERTIES (delta.enableChangeDataFeed = true);
   ```

**Delta è¡¨ç›®éŒ„çµæ§‹ï¼ˆå•Ÿç”¨ CDF å¾Œï¼‰ï¼š**

```
my_table/
â”œâ”€â”€ _delta_log/              # Transaction log
â”‚   â”œâ”€â”€ 00000000000000000000.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ _change_data/            # âœ… CDF è³‡æ–™
â”‚   â”œâ”€â”€ cdc-00000-....parquet
â”‚   â””â”€â”€ ...
â”œâ”€â”€ part-00000-....parquet   # è³‡æ–™æª”æ¡ˆ
â””â”€â”€ ...
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### B - Schema Evolution è¿½è¹¤

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **Schema è³‡è¨Šå­˜åœ¨ Transaction Log**: Schema æ¼”åŒ–æ­·å²è¨˜éŒ„åœ¨ `_delta_log` è³‡æ–™å¤¾ä¸­ï¼Œä¸æ˜¯ `_change_data`ã€‚
- **`_change_data` åªå­˜è®Šæ›´è³‡æ–™**: ä¸åŒ…å« schema å®šç¾©è³‡è¨Šã€‚

### C - Optimized Writes ä½ç½®

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **Optimized Writes ä¸ä½¿ç”¨æ­¤è³‡æ–™å¤¾**: Optimized Writes æ˜¯å¯«å…¥æ™‚çš„å„ªåŒ–æ©Ÿåˆ¶ï¼Œä¸æœƒå»ºç«‹ç‰¹åˆ¥çš„è³‡æ–™å¤¾ã€‚
- **å„ªåŒ–å¾Œçš„æª”æ¡ˆ**: ç›´æ¥å¯«å…¥è¡¨æ ¼çš„ä¸»è¦è³‡æ–™ç›®éŒ„ã€‚

### D - SCD Type 1 é è¨­è¡Œç‚º

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **SCD Type 1 èˆ‡ CDF ç„¡é—œ**: SCD Type 1 æ˜¯ä¸€ç¨®è³‡æ–™å»ºæ¨¡æ¨¡å¼ï¼ˆç›´æ¥è¦†è“‹æ­·å²ï¼‰ï¼Œä¸æœƒè‡ªå‹•å»ºç«‹ `_change_data`ã€‚
- **éœ€è¦æ˜ç¢ºå•Ÿç”¨ CDF**: `_change_data` åªæœ‰åœ¨ CDF åŠŸèƒ½è¢«å•Ÿç”¨æ™‚æ‰æœƒå‡ºç¾ã€‚
- **éé è¨­è¡Œç‚º**: CDF é è¨­æ˜¯é—œé–‰çš„ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€Œ_change_data å­˜è®Šæ›´ï¼ŒCDF å•Ÿç”¨æ‰æœƒç”Ÿã€**

### Delta Lake ç‰¹æ®Šè³‡æ–™å¤¾

| è³‡æ–™å¤¾ | ç”¨é€” | ä½•æ™‚å‡ºç¾ |
|--------|------|----------|
| `_delta_log/` | Transaction log | æ°¸é å­˜åœ¨ |
| `_change_data/` | CDF è®Šæ›´è³‡æ–™ | CDF å•Ÿç”¨æ™‚ |
| `_symlink_format_manifest/` | Manifest æª”æ¡ˆ | ç”¢ç”Ÿ manifest æ™‚ |

### CDF é‡è¦ç‰¹æ€§

| ç‰¹æ€§ | èªªæ˜ |
|------|------|
| å•Ÿç”¨æ–¹å¼ | `delta.enableChangeDataFeed = true` |
| å„²å­˜ä½ç½® | `_change_data/` è³‡æ–™å¤¾ |
| è¨˜éŒ„çš„æ“ä½œ | UPDATE, DELETE, MERGE |
| ä¿ç•™æ”¿ç­– | èˆ‡è¡¨æ ¼ç›¸åŒï¼ˆVACUUM æœƒåˆªé™¤ï¼‰ |
| é è¨­ç‹€æ…‹ | **é—œé–‰** |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [Change Data Feed](https://docs.databricks.com/delta/delta-change-data-feed.html)
- [CDF Storage](https://docs.databricks.com/delta/delta-change-data-feed.html#change-data-storage)
- [Enable CDF](https://docs.databricks.com/delta/delta-change-data-feed.html#enable-change-data-feed)

---

**[è¿”å›é¡Œç›®](#question-007)**
