# Question #014

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-014`

### ä¾†æº
**ä¾†æº:** Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

Given the following two versions of a Delta Lake table before and after an update:

**Before:**
| id | name | city | is_current |
|----|------|------|------------|
| 1 | Alice | NYC | true |

**After:**
| id | name | city | is_current |
|----|------|------|------------|
| 1 | Alice | NYC | false |
| 1 | Alice | LA | true |

Which SCD Type is this table?

### é¸é …

- **A.** SCD Type 2
- **B.** It's a combination of Type 0 and Type 2 SCDs
- **C.** SCD Type 0
- **D.** SCD Type 1

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Data-Modeling`, `ETL-Patterns`, `Delta-Lake`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Data Modeling

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `A`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** A
- **ç¤¾ç¾¤å…±è­˜:** A

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Slowly Changing Dimensions (SCD)
**é—œéµæ¦‚å¿µ:** SCD Type 2, History retention, is_current flag

**é¡Œç›®é—œéµå­—ï¼š**
- **Before/After**: æ¯”è¼ƒè¡¨æ ¼è®Šæ›´å‰å¾Œçš„ç‹€æ…‹ã€‚
- **is_current**: ç”¨æ–¼æ¨™è¨˜ç•¶å‰æœ‰æ•ˆè¨˜éŒ„çš„æ¬„ä½ã€‚
- **ä¿ç•™èˆŠè¨˜éŒ„**: èˆŠè¨˜éŒ„è¢«æ¨™è¨˜ç‚º falseï¼Œæ–°è¨˜éŒ„è¢«æ¨™è¨˜ç‚º trueã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ A æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

1. **SCD Type 2 çš„ç‰¹å¾µ**:
   - ä¿ç•™å®Œæ•´æ­·å²è¨˜éŒ„
   - ç•¶è³‡æ–™è®Šæ›´æ™‚ï¼Œæ–°å¢ä¸€ç­†æ–°è¨˜éŒ„
   - èˆŠè¨˜éŒ„æ¨™è¨˜ç‚ºéæ´»èºï¼ˆ`is_current = false`ï¼‰
   - æ–°è¨˜éŒ„æ¨™è¨˜ç‚ºæ´»èºï¼ˆ`is_current = true`ï¼‰

2. **å¾ç¯„ä¾‹çœ‹ Type 2 ç‰¹å¾µ**:
   ```
   Before: id=1, city=NYC, is_current=true
   After:  id=1, city=NYC, is_current=false  â† èˆŠè¨˜éŒ„ä¿ç•™ä½†æ¨™è¨˜ç‚ºéæ´»èº
           id=1, city=LA,  is_current=true   â† æ–°è¨˜éŒ„ç‚ºç•¶å‰æ´»èº
   ```

3. **Type 2 çš„å¯¦ç¾æ–¹å¼**:
   é€šå¸¸åŒ…å«ä»¥ä¸‹æ¬„ä½ä¹‹ä¸€æˆ–å¤šå€‹ï¼š
   - `is_current` / `is_active`: å¸ƒæ—æ——æ¨™
   - `effective_date` / `end_date`: æœ‰æ•ˆæœŸé–“
   - `version`: ç‰ˆæœ¬è™Ÿ

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### B - Type 0 + Type 2 çµ„åˆ

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **ç´”ç²¹æ˜¯ Type 2**: æ²’æœ‰ä»»ä½•æ¬„ä½é¡¯ç¤º Type 0 çš„ç‰¹å¾µã€‚
- **Type 0 å®šç¾©**: æ°¸ä¸æ›´æ”¹çš„å±¬æ€§ï¼ˆå¦‚å‡ºç”Ÿæ—¥æœŸï¼‰ã€‚
- **æ­¤ç¯„ä¾‹ä¸­**: æ²’æœ‰ä¿æŒä¸è®Šçš„ç¶­åº¦å±¬æ€§ã€‚

### C - SCD Type 0

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **Type 0 å®šç¾©**: è³‡æ–™æ°¸é ä¸æœƒæ›´æ–°ã€‚
- **æ­¤ç¯„ä¾‹æœ‰è®Šæ›´**: city å¾ NYC è®Šæˆ LAï¼Œä¸¦ä¿ç•™æ­·å²ã€‚
- **Type 0 ä¸æœƒæ–°å¢è¨˜éŒ„**: å®ƒä¿æŒåŸå§‹å€¼ä¸è®Šã€‚

### D - SCD Type 1

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **Type 1 å®šç¾©**: ç›´æ¥è¦†è“‹èˆŠå€¼ï¼Œä¸ä¿ç•™æ­·å²ã€‚
- **Type 1 çš„çµæœæ‡‰è©²æ˜¯**:
  ```
  | id | name | city |
  |----|------|------|
  | 1 | Alice | LA |  â† åªæœ‰ä¸€ç­†è¨˜éŒ„ï¼ŒNYC è¢«è¦†è“‹
  ```
- **æ­¤ç¯„ä¾‹ä¿ç•™äº†æ­·å²**: æœ‰å…©ç­†è¨˜éŒ„ï¼Œé€™æ˜¯ Type 2 çš„ç‰¹å¾µã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€ŒType 1 è¦†è“‹ï¼ŒType 2 ç•™ã€**

- **Type 1**: ç›´æ¥æ›´æ–°ï¼Œè¦†è“‹èˆŠå€¼
- **Type 2**: æ–°å¢è¨˜éŒ„ï¼Œä¿ç•™æ­·å²

### SCD é¡å‹æ¯”è¼ƒè¡¨

| é¡å‹ | è¡Œç‚º | æ­·å²ä¿ç•™ | ç¯„ä¾‹çµæœ |
|------|------|----------|----------|
| **Type 0** | æ°¸ä¸æ›´æ–° | ç„¡è®Šæ›´ | åŸå§‹å€¼ä¸è®Š |
| **Type 1** | è¦†è“‹æ›´æ–° | **ä¸ä¿ç•™** | åªæœ‰æœ€æ–°å€¼ |
| **Type 2** | æ–°å¢è¨˜éŒ„ | **å®Œæ•´ä¿ç•™** | å¤šç­†è¨˜éŒ„ + æ——æ¨™ |
| **Type 3** | åŠ æ¬„ä½ | éƒ¨åˆ†ä¿ç•™ | previous_city æ¬„ä½ |

### Type 2 å¸¸è¦‹å¯¦ç¾æ¬„ä½

| æ¬„ä½é¡å‹ | ç¯„ä¾‹ | ç”¨é€” |
|----------|------|------|
| æ——æ¨™ | `is_current`, `is_active` | æ¨™è¨˜ç•¶å‰è¨˜éŒ„ |
| æ—¥æœŸ | `effective_date`, `end_date` | æœ‰æ•ˆæœŸé–“ |
| ç‰ˆæœ¬ | `version`, `scd_version` | ç‰ˆæœ¬åºè™Ÿ |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [SCD on Wikipedia](https://en.wikipedia.org/wiki/Slowly_changing_dimension)
- [Delta Lake SCD Type 2](https://docs.databricks.com/delta/delta-change-data-feed.html#use-change-data-feed-to-implement-scd-type-2)
- [DLT APPLY CHANGES](https://docs.databricks.com/delta-live-tables/cdc.html)

---

**[è¿”å›é¡Œç›®](#question-014)**
