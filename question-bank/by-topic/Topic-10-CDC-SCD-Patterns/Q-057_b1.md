# Question #057

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-057`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
Given the following two versions of a Delta Lake table before and after an update:

**Before:**
| customer_id | name | city |
|-------------|------|------|
| 1 | Alice | NYC |
| 2 | Bob | LA |

**After:**
| customer_id | name | city |
|-------------|------|------|
| 1 | Alice | Boston |
| 2 | Bob | LA |

Which SCD Type is this table?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** It's a combination of Type 0 and Type 2 SCDs
- **B.** SCD Type 1
- **C.** SCD Type 0
- **D.** SCD Type 2

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Data-Modeling`, `ETL-Patterns`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Data Modeling

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `B`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** B
- **ç¤¾ç¾¤å…±è­˜:** B

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Slowly Changing Dimension (SCD)
**é—œéµæ¦‚å¿µ:** SCD Type 0/1/2 çš„å·®ç•°
**é¡Œç›®é—œéµå­—ï¼š**
- **before and after**: æ›´æ–°å‰å¾Œå°æ¯”
- **city changed from NYC to Boston**: è³‡æ–™è¢«è¦†è“‹
- **no history preserved**: èˆŠå€¼æ²’æœ‰ä¿ç•™

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ B æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

å¾é¡Œç›®çš„ Before/After å°æ¯”å¯ä»¥çœ‹åˆ°ï¼š
- Alice çš„ city å¾ `NYC` è®Šæˆ `Boston`
- **èˆŠå€¼ `NYC` æ²’æœ‰è¢«ä¿ç•™**
- é€™æ­£æ˜¯ **SCD Type 1** çš„ç‰¹å¾µï¼šç›´æ¥è¦†è“‹

#### SCD Type 1 ç‰¹å¾µ
```
Before:
| customer_id | name  | city   |
|-------------|-------|--------|
| 1           | Alice | NYC    |  â† èˆŠå€¼

After:
| customer_id | name  | city   |
|-------------|-------|--------|
| 1           | Alice | Boston |  â† æ–°å€¼ç›´æ¥è¦†è“‹

ç‰¹é»ï¼š
- åªä¿ç•™æœ€æ–°å€¼
- æ­·å²è³‡æ–™ä¸Ÿå¤±
- ç„¡æ³•è¿½æº¯è®Šæ›´æ­·å²
```

#### SQL å¯¦ç¾ç¯„ä¾‹
```sql
-- SCD Type 1: ä½¿ç”¨ MERGE ç›´æ¥æ›´æ–°
MERGE INTO customers t
USING updates u
ON t.customer_id = u.customer_id
WHEN MATCHED THEN UPDATE SET *
WHEN NOT MATCHED THEN INSERT *
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A. It's a combination of Type 0 and Type 2 SCDs
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- æ²’æœ‰ Type 0 å’Œ Type 2 çš„ç‰¹å¾µ
- Type 0 ä¸æœƒè®Šæ›´ï¼ŒType 2 æœƒä¿ç•™æ­·å²
- é€™è£¡åªæœ‰å–®ç´”çš„è¦†è“‹

### C. SCD Type 0
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- Type 0 æ˜¯**æ°¸ä¸è®Šæ›´**çš„ç¶­åº¦
- é¡Œç›®ä¸­ city å¾ NYC è®Šæˆ Bostonï¼Œæœ‰è®Šæ›´
- Type 0 æœƒå¿½ç•¥æ‰€æœ‰æ›´æ–°

### D. SCD Type 2
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- Type 2 æœƒ**ä¿ç•™æ­·å²è¨˜éŒ„**
- æ‡‰è©²æœƒçœ‹åˆ°å…©è¡Œè³‡æ–™ï¼ˆèˆŠå€¼å’Œæ–°å€¼ï¼‰
- é¡Œç›®åªæœ‰ä¸€è¡Œï¼ŒèˆŠå€¼è¢«è¦†è“‹

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€ŒType 0 ä¸è®Šï¼ŒType 1 è¦†è“‹ï¼ŒType 2 ç•™æ­·å²ã€**

### SCD Types å®Œæ•´å°ç…§è¡¨
| Type | åç¨± | è¡Œç‚º | æ­·å²è¿½æº¯ |
|------|------|------|---------|
| **Type 0** | Retain Original | æ°¸ä¸æ›´æ–° | åªæœ‰åŸå§‹å€¼ |
| **Type 1** | Overwrite | ç›´æ¥è¦†è“‹ | âŒ ç„¡æ³•è¿½æº¯ |
| **Type 2** | Add New Row | æ–°å¢è¨˜éŒ„ | âœ… å®Œæ•´æ­·å² |
| **Type 3** | Add New Column | æ–°å¢æ¬„ä½ | éƒ¨åˆ†æ­·å² |
| **Type 4** | History Table | åˆ†é›¢æ­·å²è¡¨ | âœ… å®Œæ•´æ­·å² |

### SCD Type 2 å°æ¯”ç¤ºä¾‹
```
å¦‚æœæ˜¯ Type 2ï¼ŒAfter æ‡‰è©²æ˜¯é€™æ¨£ï¼š

| customer_id | name  | city   | start_date | end_date   | is_current |
|-------------|-------|--------|------------|------------|------------|
| 1           | Alice | NYC    | 2024-01-01 | 2024-06-01 | false      |
| 1           | Alice | Boston | 2024-06-01 | null       | true       |

æ³¨æ„ï¼šä¿ç•™äº†å…©å€‹ç‰ˆæœ¬çš„è¨˜éŒ„
```

### é¸æ“‡ SCD Type çš„æ±ºç­–æ¨¹
```
éœ€è¦è¿½æº¯æ­·å²è®Šæ›´ï¼Ÿ
â”œâ”€â”€ å¦ â†’ éœ€è¦è¨˜éŒ„åˆå§‹å€¼ï¼Ÿ
â”‚         â”œâ”€â”€ å¦ â†’ Type 1ï¼ˆè¦†è“‹ï¼‰
â”‚         â””â”€â”€ æ˜¯ â†’ Type 0ï¼ˆä¸è®Šï¼‰
â”‚
â””â”€â”€ æ˜¯ â†’ éœ€è¦å®Œæ•´æ­·å²ï¼Ÿ
          â”œâ”€â”€ æ˜¯ â†’ Type 2ï¼ˆæ–°å¢è¡Œï¼‰
          â””â”€â”€ å¦ â†’ Type 3ï¼ˆæ–°å¢æ¬„ï¼‰
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Slowly changing dimension - Wikipedia](https://en.wikipedia.org/wiki/Slowly_changing_dimension)
- [SCD Type 2 with Delta Lake](https://docs.databricks.com/en/delta/merge.html#slowly-changing-data-scd-type-2-operation)

---

**[è¿”å›é¡Œç›®](#question-057)**
