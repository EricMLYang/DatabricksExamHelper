# Question #053

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-053`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
A retail company stores sales data in Delta tables within Databricks Unity Catalog. They need to securely share specific tables with an external auditing firm, who uses Databricks on a different cloud provider.

Which of the following options enable achieving this task without data replication?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** Databricks-to-Databricks Delta Sharing
- **B.** Shallow clone
- **C.** External schema in Unity Catalog
- **D.** Databricks Connect

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `UC-Sharing`, `Unity-Catalog`, `Security`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`, `Similar-Function`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Data Architecture

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `A`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** A
- **ç¤¾ç¾¤å…±è­˜:** A

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Delta Sharing / Databricks-to-Databricks Sharing
**é—œéµæ¦‚å¿µ:** è·¨çµ„ç¹”è³‡æ–™å…±äº«ã€é›¶è¤‡è£½ã€è·¨é›²ç«¯å­˜å–
**é¡Œç›®é—œéµå­—ï¼š**
- **securely share**: å®‰å…¨åœ°åˆ†äº«è³‡æ–™
- **external auditing firm**: å¤–éƒ¨çµ„ç¹”
- **different cloud provider**: è·¨é›²ç«¯ç’°å¢ƒ
- **without data replication**: ä¸è¤‡è£½è³‡æ–™

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ A æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**Databricks-to-Databricks Delta Sharing** å°ˆç‚ºè·¨çµ„ç¹”ã€è·¨é›²ç«¯çš„å®‰å…¨è³‡æ–™å…±äº«è¨­è¨ˆã€‚

#### Delta Sharing æ¶æ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Provider                             â”‚
â”‚                (Retail Company - AWS)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Unity Catalogâ”‚â”€â”€â”€â†’â”‚ Delta Share â”‚â”€â”€â”€â†’â”‚ Share Object  â”‚  â”‚
â”‚  â”‚ Delta Tables â”‚    â”‚   (å®šç¾©)     â”‚    â”‚  (ç™¼å¸ƒ)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                          â†“ è·¨é›²ç«¯å®‰å…¨å‚³è¼¸
                                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Recipient                  â”‚         â”‚
â”‚                (Auditing Firm - Azure)             â”‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â†“â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Unity Catalogâ”‚â†â”€â”€â”€â”‚ å¤–éƒ¨ Catalog â”‚â†â”€â”€â”€â”‚ Shared Data    â”‚â”‚
â”‚  â”‚   (æŸ¥è©¢)     â”‚    â”‚   (æ›è¼‰)     â”‚    â”‚  (é›¶è¤‡è£½è®€å–)  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Delta Sharing çš„ç‰¹æ€§
| ç‰¹æ€§ | èªªæ˜ |
|------|------|
| **é›¶è¤‡è£½** | è³‡æ–™ä¿ç•™åœ¨ Provider ç«¯ï¼Œä¸éœ€è¦è¤‡è£½ |
| **è·¨é›²ç«¯** | AWS â†” Azure â†” GCP éƒ½æ”¯æ´ |
| **å®‰å…¨å­˜å–** | åŸºæ–¼ Unity Catalog çš„æ¬Šé™æ§åˆ¶ |
| **å³æ™‚æ›´æ–°** | Recipient è®€å–çš„æ°¸é æ˜¯æœ€æ–°è³‡æ–™ |
| **é–‹æ”¾å”å®š** | åŸºæ–¼ Delta Sharing é–‹æ”¾å”å®š |

#### ç‚ºä»€éº¼é©åˆæœ¬é¡Œå ´æ™¯ï¼Ÿ
```
é¡Œç›®éœ€æ±‚ï¼š
â”œâ”€â”€ åˆ†äº« Delta è¡¨æ ¼çµ¦å¤–éƒ¨çµ„ç¹”
â”œâ”€â”€ å¤–éƒ¨çµ„ç¹”ä½¿ç”¨ä¸åŒé›²ç«¯çš„ Databricks
â”œâ”€â”€ ä¸è¤‡è£½è³‡æ–™
â””â”€â”€ å®‰å…¨å…±äº«

Databricks-to-Databricks Delta Sharing æ»¿è¶³æ‰€æœ‰éœ€æ±‚ï¼š
â”œâ”€â”€ âœ… å°ˆç‚ºè·¨çµ„ç¹”å…±äº«è¨­è¨ˆ
â”œâ”€â”€ âœ… æ”¯æ´è·¨é›²ç«¯ï¼ˆä¸åŒ cloud providerï¼‰
â”œâ”€â”€ âœ… é›¶è¤‡è£½æ¶æ§‹
â””â”€â”€ âœ… Unity Catalog æ•´åˆæä¾›å®‰å…¨æ§åˆ¶
```

#### ä½¿ç”¨ç¯„ä¾‹
```sql
-- Provider ç«¯ï¼šå»ºç«‹ Share
CREATE SHARE audit_share;

-- åŠ å…¥è¡¨æ ¼åˆ° Share
ALTER SHARE audit_share ADD TABLE sales.transactions;

-- æˆæ¬Šçµ¦ Recipient
GRANT SELECT ON SHARE audit_share TO RECIPIENT auditing_firm;

-- Recipient ç«¯ï¼šå»ºç«‹å¤–éƒ¨ Catalog
CREATE CATALOG audit_data USING SHARE provider_name.audit_share;

-- æŸ¥è©¢å…±äº«è³‡æ–™
SELECT * FROM audit_data.sales.transactions;
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### B. Shallow clone
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- Shallow Clone æœƒ**è¤‡è£½ metadata**ï¼Œè³‡æ–™æª”æ¡ˆä»éœ€å­˜å–åŸè¡¨æ ¼
- åªèƒ½åœ¨**åŒä¸€å€‹ Workspace å…§**ä½¿ç”¨
- ä¸æ”¯æ´è·¨çµ„ç¹”æˆ–è·¨é›²ç«¯å…±äº«
- ä¸æ˜¯ç‚ºå¤–éƒ¨å…±äº«è¨­è¨ˆçš„åŠŸèƒ½

```sql
-- Shallow Clone åªèƒ½åœ¨åŒä¸€ Workspace
CREATE TABLE sales_clone SHALLOW CLONE sales.transactions;
-- ç„¡æ³•åˆ†äº«çµ¦å¤–éƒ¨çµ„ç¹”
```

### C. External schema in Unity Catalog
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- External Schema ç”¨æ–¼**é€£æ¥å¤–éƒ¨è³‡æ–™ä¾†æº**ï¼ˆå¦‚ S3ã€ADLSï¼‰
- æ˜¯ã€Œå‘å…§ã€æ•´åˆå¤–éƒ¨è³‡æ–™ï¼Œä¸æ˜¯ã€Œå‘å¤–ã€åˆ†äº«
- ç„¡æ³•å°‡ Delta è¡¨æ ¼åˆ†äº«çµ¦å¦ä¸€å€‹ Databricks ç’°å¢ƒ

### D. Databricks Connect
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- Databricks Connect ç”¨æ–¼å¾**æœ¬åœ° IDE é€£æ¥åˆ° Databricks å¢é›†**
- æ˜¯é–‹ç™¼å·¥å…·ï¼Œä¸æ˜¯è³‡æ–™å…±äº«æ©Ÿåˆ¶
- ç„¡æ³•å¯¦ç¾è·¨çµ„ç¹”çš„è³‡æ–™å…±äº«

```
Databricks Connect ç”¨é€”ï¼š
â”œâ”€â”€ æœ¬åœ° IDE (VSCode, PyCharm) â†’ Databricks Cluster
â”œâ”€â”€ ç”¨æ–¼é–‹ç™¼å’Œé™¤éŒ¯
â””â”€â”€ ä¸æ˜¯è³‡æ–™å…±äº«è§£æ±ºæ–¹æ¡ˆ
```

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€ŒDelta Sharing è·¨çµ„ç¹”ï¼Œé›¶è¤‡è£½æœ€å®‰å…¨ã€**

### Databricks è³‡æ–™å…±äº«æ–¹æ¡ˆæ¯”è¼ƒ
| åŠŸèƒ½ | ç”¨é€” | ç¯„åœ | è¤‡è£½è³‡æ–™ï¼Ÿ |
|------|------|------|-----------|
| **Delta Sharing** | åˆ†äº«çµ¦å¤–éƒ¨ | è·¨çµ„ç¹”/è·¨é›² | å¦ |
| Shallow Clone | è¡¨æ ¼è¤‡è£½ | åŒ Workspace | åƒ… metadata |
| External Schema | æ•´åˆå¤–éƒ¨è³‡æ–™ | å‘å…§é€£æ¥ | - |
| Databricks Connect | é–‹ç™¼å·¥å…· | IDE é€£æ¥ | - |

### é¸æ“‡æ±ºç­–æ¨¹
```
éœ€è¦åˆ†äº«è³‡æ–™çµ¦å¤–éƒ¨ï¼Ÿ
â”‚
â”œâ”€â”€ æ˜¯ï¼Œå¤–éƒ¨çµ„ç¹”ä¹Ÿç”¨ Databricks
â”‚   â””â”€â”€ Databricks-to-Databricks Delta Sharing â† æœ¬é¡Œç­”æ¡ˆ
â”‚
â”œâ”€â”€ æ˜¯ï¼Œå¤–éƒ¨çµ„ç¹”ä¸ç”¨ Databricks
â”‚   â””â”€â”€ Open Delta Sharing (é–‹æ”¾å”å®š)
â”‚
â”œâ”€â”€ å¦ï¼Œåªæ˜¯åŒä¸€ Workspace å…§è¤‡è£½
â”‚   â””â”€â”€ Clone (Deep/Shallow)
â”‚
â””â”€â”€ å¦ï¼Œéœ€è¦æŸ¥è©¢å¤–éƒ¨è³‡æ–™åº«
    â””â”€â”€ Lakehouse Federation
```

### Delta Sharing é¡å‹
| é¡å‹ | Recipient | èªªæ˜ |
|------|-----------|------|
| **D2D (Databricks-to-Databricks)** | Databricks ç”¨æˆ¶ | Unity Catalog æ•´åˆ |
| **Open Sharing** | ä»»ä½•å¹³å° | é–‹æ”¾å”å®šï¼Œæ›´å»£æ³› |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Delta Sharing](https://docs.databricks.com/data-sharing/index.html)
- [Databricks-to-Databricks Delta Sharing](https://docs.databricks.com/data-sharing/share-data-databricks.html)
- [Create and Manage Shares](https://docs.databricks.com/data-sharing/create-share.html)

---

**[è¿”å›é¡Œç›®](#question-053)**
