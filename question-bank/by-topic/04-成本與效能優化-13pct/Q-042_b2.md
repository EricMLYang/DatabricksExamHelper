# Question #042

---

## 題目資訊
### 題目編號
**ID:** `Q-042`
### 來源
**來源:** Community
### 難度等級
**難度:** `L1-Basic`

---

## 題目內容
### 題幹
<!-- ⚠️ 保持英文原文，不要翻譯 -->
Which of the following commands can a data engineer use to create a Delta table "orders" with Automatic Liquid Clustering enabled?

### 選項
<!-- ⚠️ 保持英文原文，不要翻譯 -->
- **A.**
```sql
CREATE OR REPLACE TABLE orders(id int, updated date, value double)
CLUSTER BY ALL;
```
- **B.**
```sql
CREATE OR REPLACE TABLE orders(id int, updated date, value double)
CLUSTER BY NONE;
```
- **C.**
```sql
CREATE OR REPLACE TABLE orders(id int, updated date, value double)
CLUSTER BY AUTO;
```
- **D.**
```sql
CREATE OR REPLACE TABLE orders(id int, updated date, value double)
CLUSTER BY (id, updated, value);
```

---

## 標籤系統
### Topic Tags (技術主題標籤)
**Topics:** `Delta-Lake`, `Spark-Performance`
### Trap Tags (陷阱類型標籤)
**Traps:** `Syntax-Confusion`
### Knowledge Domain (知識領域)
**Domain:** Data Engineering / Performance Optimization

---

## 答案與來源
### 正確答案
**正解:** `C`
### 答案來源
- **來源標註答案:** C
- **社群共識:** C

---

# 題目解析

---

## 📍 考點識別
**核心技術:** Delta Lake Liquid Clustering
**關鍵概念:** 自動叢集、CLUSTER BY 語法
**題目關鍵字：**
- **Automatic Liquid Clustering**: 自動液態叢集
- **CLUSTER BY**: 叢集設定語法
- **AUTO**: 自動模式關鍵字

---

## ✅ 正解說明
### 為什麼 C 是正確答案？

**`CLUSTER BY AUTO`** 是啟用自動液態叢集的正確語法。

#### 什麼是 Automatic Liquid Clustering？
| 特性 | 說明 |
|------|------|
| **自動分析** | Delta Lake 自動分析查詢模式 |
| **自動選擇** | 根據資料分佈自動選擇叢集欄位 |
| **動態調整** | 隨著查詢模式變化自動調整 |
| **免維護** | 不需手動指定或維護叢集欄位 |

#### 正確語法
```sql
-- 啟用自動液態叢集
CREATE OR REPLACE TABLE orders(
    id int,
    updated date,
    value double
)
CLUSTER BY AUTO;

-- Delta Lake 會自動：
-- 1. 分析查詢模式
-- 2. 選擇最佳叢集欄位
-- 3. 在背景優化資料佈局
```

#### Automatic vs Manual Clustering
```
手動指定 (CLUSTER BY columns):
├── 需要預先知道查詢模式
├── 固定的叢集欄位
└── 可能需要隨時間調整

自動模式 (CLUSTER BY AUTO):
├── 無需預先知道查詢模式
├── 動態調整叢集欄位
└── 自動適應查詢變化
```

---

## ❌ 錯誤選項排除

### A. CLUSTER BY ALL
**為什麼錯誤？**
- **`CLUSTER BY ALL` 不是有效的 Delta Lake 語法**
- 沒有這個關鍵字
- 容易與其他 SQL 語法混淆（如 `SELECT *`）

### B. CLUSTER BY NONE
**為什麼錯誤？**
- `CLUSTER BY NONE` 是**停用**液態叢集的語法
- 用於明確不使用任何叢集
- 與題目要求「啟用」相反

```sql
-- 停用叢集（與題目要求相反）
CREATE TABLE orders(...)
CLUSTER BY NONE;
```

### D. CLUSTER BY (id, updated, value)
**為什麼錯誤？**
- 這是**手動指定**叢集欄位的語法
- 不是「自動」叢集
- 需要使用者自己分析並指定最佳欄位

```sql
-- 手動叢集（不是自動）
CREATE TABLE orders(...)
CLUSTER BY (id, updated);  -- 使用者自己選擇欄位
```

---

## 🧠 記憶法
### 口訣
**「AUTO 自動選，NONE 全關閉，手動要括號」**

### CLUSTER BY 語法對照表
| 語法 | 作用 | 適用場景 |
|------|------|---------|
| `CLUSTER BY AUTO` | 自動叢集 | 不確定查詢模式 |
| `CLUSTER BY (cols)` | 手動指定欄位 | 已知查詢模式 |
| `CLUSTER BY NONE` | 停用叢集 | 不需要叢集優化 |
| `CLUSTER BY ALL` | ❌ 無效語法 | N/A |

### Liquid Clustering 優勢
```
傳統 Z-Order:
├── 需要手動執行 OPTIMIZE
├── 固定的 Z-Order 欄位
└── 需要定期維護

Liquid Clustering:
├── 自動增量叢集
├── 支援 AUTO 自動選擇
└── 寫入時自動優化
```

### 記憶技巧
- **AUTO** = Automatic = 自動 = 讓系統決定
- **NONE** = 無 = 不要叢集
- **括號** = 手動 = 使用者指定

### 決策樹
```
需要液態叢集嗎？
├── 否 → CLUSTER BY NONE
└── 是 → 知道最佳叢集欄位嗎？
          ├── 否 → CLUSTER BY AUTO ← 本題答案
          └── 是 → CLUSTER BY (column1, column2)
```

---

## 📚 官方文件
- [Use liquid clustering for Delta tables](https://docs.databricks.com/en/delta/clustering.html)
- [Automatic liquid clustering](https://docs.databricks.com/en/delta/clustering.html#automatic-liquid-clustering)

---

**[返回題目](#question-042)**
