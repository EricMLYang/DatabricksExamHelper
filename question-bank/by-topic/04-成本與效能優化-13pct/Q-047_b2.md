# Question #047

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-047`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
A data engineer is analyzing a Spark job via the Spark UI. They have the following summary metrics for 27 completed tasks in a particular stage.

*(é¡Œç›®é™„æœ‰ Summary Metrics è¡¨æ ¼ï¼Œé¡¯ç¤º Min å€¼æ¥è¿‘é›¶)*

Which conclusion can the data engineer draw from the above statistics?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** All task are operating over partitions with even amounts of data
- **B.** All task are operating over empty or near empty partitions
- **C.** Number of tasks are operating over near empty partitions
- **D.** Number of tasks are operating over partitions with larger skewed amounts of data.

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Spark-Performance`, `Databricks-SQL`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** (ç„¡)
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Performance Optimization

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `C`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** C
- **ç¤¾ç¾¤å…±è­˜:** C

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Spark UI Summary Metrics åˆ†æ
**é—œéµæ¦‚å¿µ:** è³‡æ–™å‚¾æ–œè¨ºæ–·ã€Partition åˆ†ä½ˆåˆ†æ
**é¡Œç›®é—œéµå­—ï¼š**
- **Summary metrics**: æ‘˜è¦æŒ‡æ¨™
- **Min values near zero**: æœ€å°å€¼æ¥è¿‘é›¶
- **near empty partitions**: æ¥è¿‘ç©ºçš„åˆ†å€

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ C æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

ç•¶ Summary Metrics é¡¯ç¤º **Min å€¼æ¥è¿‘é›¶**æ™‚ï¼Œè¡¨ç¤º**éƒ¨åˆ†** Task è™•ç†çš„è³‡æ–™é‡æ¥µå°‘ï¼ˆæ¥è¿‘ç©ºåˆ†å€ï¼‰ã€‚

#### Summary Metrics è§£è®€æ–¹æ³•
| æŒ‡æ¨™ | æ„ç¾© |
|------|------|
| **Min** | æœ€å°å€¼ - è™•ç†æœ€å°‘è³‡æ–™çš„ Task |
| **25th percentile** | ç¬¬ 25 ç™¾åˆ†ä½ |
| **Median (50th)** | ä¸­ä½æ•¸ - å…¸å‹ Task |
| **75th percentile** | ç¬¬ 75 ç™¾åˆ†ä½ |
| **Max** | æœ€å¤§å€¼ - è™•ç†æœ€å¤šè³‡æ–™çš„ Task |

#### æœ¬é¡Œæƒ…å¢ƒåˆ†æ
```
Summary Metrics é¡¯ç¤ºï¼š
â”œâ”€â”€ Min: æ¥è¿‘ 0 â† æœ‰äº› partition å¹¾ä¹æ˜¯ç©ºçš„
â”œâ”€â”€ 25th - 75th: åˆç†åˆ†ä½ˆ
â””â”€â”€ Max: æ­£å¸¸å€¼

çµè«–ï¼šéƒ¨åˆ† Task æ“ä½œè¿‘ä¹ç©ºçš„ partition
```

#### è³‡æ–™åˆ†ä½ˆåœ–ç¤º
```
Task è³‡æ–™é‡åˆ†ä½ˆï¼š

Task 1:  [â– â– â– â– â– â– â– â– â– â– ] æ­£å¸¸
Task 2:  [â– â– â– â– â– â– â– â– â– â– ] æ­£å¸¸
Task 3:  [â– â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡] è¿‘ä¹ç©º â† Min å€¼ä¾†æº
Task 4:  [â– â– â– â– â– â– â– â– â– â– ] æ­£å¸¸
Task 5:  [â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡] ç©º â† Min å€¼ä¾†æº
...
Task 27: [â– â– â– â– â– â– â– â– â– â– ] æ­£å¸¸
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A. All task are operating over partitions with even amounts of data
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- å¦‚æœè³‡æ–™å‡å‹»åˆ†ä½ˆï¼Œæ‰€æœ‰æŒ‡æ¨™æ‡‰è©²**æ¥è¿‘ä¸­ä½æ•¸**
- Min æ¥è¿‘é›¶è¡¨ç¤ºåˆ†ä½ˆ**ä¸å‡å‹»**
- **ä¸æ˜¯ã€Œæ‰€æœ‰ã€Task éƒ½å‡å‹»**

```
å‡å‹»åˆ†ä½ˆçš„ Summary Metricsï¼š
â”œâ”€â”€ Min: æ¥è¿‘ Median
â”œâ”€â”€ Median: X
â””â”€â”€ Max: æ¥è¿‘ Median

æœ¬é¡Œæƒ…æ³ï¼ˆä¸å‡å‹»ï¼‰ï¼š
â”œâ”€â”€ Min: æ¥è¿‘ 0 â† å·®ç•°å¤§
â”œâ”€â”€ Median: X
â””â”€â”€ Max: æ­£å¸¸
```

### B. All task are operating over empty or near empty partitions
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- é—œéµå­—æ˜¯ **ã€ŒAllã€ï¼ˆæ‰€æœ‰ï¼‰**
- å¦‚æœæ‰€æœ‰ partition éƒ½æ˜¯ç©ºçš„ï¼ŒMedian ä¹Ÿæœƒæ¥è¿‘é›¶
- æœ¬é¡Œåªæœ‰ Min æ¥è¿‘é›¶ï¼Œè¡¨ç¤ºåªæœ‰**éƒ¨åˆ†** Task æ˜¯ç©ºçš„

### D. Number of tasks are operating over partitions with larger skewed amounts of data
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- é€™æè¿°çš„æ˜¯ **Max å€¼ç•°å¸¸é«˜** çš„æƒ…æ³
- æœ¬é¡Œæƒ…å¢ƒæ˜¯ **Min å€¼æ¥è¿‘é›¶**
- ã€Œlarger skewed amountsã€æŒ‡çš„æ˜¯è³‡æ–™é‡éå¤§ï¼Œä¸æ˜¯éå°‘

```
é¸é … D æè¿°çš„æƒ…æ³ï¼ˆMax ç•°å¸¸é«˜ï¼‰ï¼š
â”œâ”€â”€ Min: æ­£å¸¸
â”œâ”€â”€ Median: X
â””â”€â”€ Max: éå¸¸å¤§ â† Data Skew

æœ¬é¡Œæƒ…æ³ï¼ˆMin æ¥è¿‘é›¶ï¼‰ï¼š
â”œâ”€â”€ Min: æ¥è¿‘ 0 â† Empty Partitions
â”œâ”€â”€ Median: X
â””â”€â”€ Max: æ­£å¸¸
```

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€ŒMin æ¥è¿‘é›¶æ˜¯ç©ºåˆ†å€ï¼ŒMax ç‰¹åˆ¥å¤§æ˜¯å‚¾æ–œã€**

### Summary Metrics è¨ºæ–·è¡¨
| Min å€¼ | Max å€¼ | è¨ºæ–·çµæœ |
|--------|--------|---------|
| æ¥è¿‘ 0 | æ­£å¸¸ | ç©ºåˆ†å€å•é¡Œ â† æœ¬é¡Œ |
| æ­£å¸¸ | ç•°å¸¸é«˜ | è³‡æ–™å‚¾æ–œå•é¡Œ |
| æ¥è¿‘ä¸­ä½æ•¸ | æ¥è¿‘ä¸­ä½æ•¸ | è³‡æ–™åˆ†ä½ˆå‡å‹» |

### Spark UI åˆ†ææ±ºç­–æ¨¹
```
æŸ¥çœ‹ Summary Metricsï¼š
â”‚
â”œâ”€â”€ Min æ¥è¿‘ 0ï¼Ÿ
â”‚   â””â”€â”€ æ˜¯ â†’ æœ‰ç©ºåˆ†å€ï¼ˆé¸ Cï¼‰
â”‚
â”œâ”€â”€ Max ç•°å¸¸é«˜ï¼Ÿ
â”‚   â””â”€â”€ æ˜¯ â†’ è³‡æ–™å‚¾æ–œ
â”‚
â””â”€â”€ æ‰€æœ‰å€¼æ¥è¿‘ Medianï¼Ÿ
    â””â”€â”€ æ˜¯ â†’ è³‡æ–™å‡å‹»åˆ†ä½ˆ
```

### å¸¸è¦‹æ•ˆèƒ½å•é¡Œèˆ‡æŒ‡æ¨™
| å•é¡Œé¡å‹ | Summary Metrics ç‰¹å¾µ |
|---------|---------------------|
| **ç©ºåˆ†å€** | Min æ¥è¿‘ 0 |
| **è³‡æ–™å‚¾æ–œ** | Max é å¤§æ–¼ Median |
| **å‡å‹»åˆ†ä½ˆ** | Min/Max æ¥è¿‘ Median |
| **å…¨ç©º** | æ‰€æœ‰å€¼éƒ½æ¥è¿‘ 0 |

### è¨˜æ†¶é—œéµå­—å°ç…§
| é—œéµå­— | å«ç¾© |
|-------|------|
| Min near zero | éƒ¨åˆ† partition æ˜¯ç©ºçš„ |
| Max very high | éƒ¨åˆ† partition è³‡æ–™éå¤šï¼ˆskewï¼‰|
| All near Median | è³‡æ–™å‡å‹»åˆ†ä½ˆ |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Spark UI](https://docs.databricks.com/en/compute/clusters-manage.html#spark-ui)
- [Diagnose data skew](https://docs.databricks.com/en/delta/data-skipping.html)

---

**[è¿”å›é¡Œç›®](#question-047)**
