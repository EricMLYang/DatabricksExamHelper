# Question #041

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-041`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
Which statement regarding Delta Lake File Statistics is correct?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** By default, Delta Lake captures statistics in the transaction log on the first 32 columns of each table.
- **B.** By default, Delta Lake captures statistics in the transaction log on the first 16 columns of each table.
- **C.** By default, Delta Lake captures statistics in the Hive metastore on the first 32 columns of each table.
- **D.** By default, Delta Lake captures statistics in the Hive metastore on the first 16 columns of each table.

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Delta-Lake`, `Delta-Optimization`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Number-Trap`, `Concept-Confusion`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Delta Lake Internals

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `A`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** A
- **ç¤¾ç¾¤å…±è­˜:** A

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Delta Lake æª”æ¡ˆçµ±è¨ˆæ©Ÿåˆ¶ (File Statistics)
**é—œéµæ¦‚å¿µ:** Transaction Logã€Data Skippingã€Column Statistics
**é¡Œç›®é—œéµå­—ï¼š**
- **File Statistics**: Delta Lake è‡ªå‹•æ”¶é›†çš„çµ±è¨ˆè³‡è¨Šï¼Œç”¨æ–¼æŸ¥è©¢å„ªåŒ–
- **Transaction Log**: Delta Lake çš„äº¤æ˜“æ—¥èªŒï¼Œå„²å­˜è¡¨æ ¼çš„æ‰€æœ‰è®Šæ›´ç´€éŒ„
- **First 32 columns**: é è¨­æ”¶é›†çµ±è¨ˆè³‡è¨Šçš„æ¬„ä½æ•¸é‡é™åˆ¶

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ A æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

Delta Lake è‡ªå‹•ç‚ºæ¯å€‹æ–°å¢çš„è³‡æ–™æª”æ¡ˆæ”¶é›†çµ±è¨ˆè³‡è¨Šï¼Œé€™äº›çµ±è¨ˆè³‡è¨Šå„²å­˜åœ¨ **Transaction Log**ï¼ˆ`_delta_log` ç›®éŒ„ï¼‰ä¸­ã€‚

#### é è¨­æ”¶é›†çš„çµ±è¨ˆè³‡è¨Šï¼ˆå‰ 32 æ¬„ï¼‰
| çµ±è¨ˆé¡å‹ | èªªæ˜ |
|---------|------|
| **numRecords** | æ¯å€‹æª”æ¡ˆçš„ç¸½è¨˜éŒ„æ•¸ |
| **minValues** | æ¯æ¬„çš„æœ€å°å€¼ |
| **maxValues** | æ¯æ¬„çš„æœ€å¤§å€¼ |
| **nullCount** | æ¯æ¬„çš„ NULL å€¼æ•¸é‡ |

#### çµ±è¨ˆè³‡è¨Šçš„å¯¦éš›æ‡‰ç”¨ï¼šData Skipping
```sql
-- ç•¶åŸ·è¡Œæ­¤æŸ¥è©¢æ™‚ï¼š
SELECT * FROM orders WHERE order_date = '2024-01-15'

-- Delta Lake æœƒï¼š
-- 1. è®€å– Transaction Log ä¸­çš„çµ±è¨ˆè³‡è¨Š
-- 2. æª¢æŸ¥æ¯å€‹æª”æ¡ˆçš„ min/max å€¼
-- 3. è·³éä¸åŒ…å« '2024-01-15' çš„æª”æ¡ˆ
-- 4. åªè®€å–å¯èƒ½åŒ…å«ç›®æ¨™è³‡æ–™çš„æª”æ¡ˆ
```

#### é…ç½®æ¬„ä½æ•¸é‡
```sql
-- ä¿®æ”¹æ”¶é›†çµ±è¨ˆè³‡è¨Šçš„æ¬„ä½æ•¸é‡
ALTER TABLE my_table
SET TBLPROPERTIES ('delta.dataSkippingNumIndexedCols' = 64)
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### B. ...on the first 16 columns...
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- é è¨­å€¼æ˜¯ **32** æ¬„ï¼Œä¸æ˜¯ 16 æ¬„
- é€™æ˜¯å¸¸è¦‹çš„æ•¸å­—é™·é˜±é¡Œ

### C. ...in the Hive metastore on the first 32 columns...
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- çµ±è¨ˆè³‡è¨Šå„²å­˜åœ¨ **Transaction Log**ï¼Œè€Œé Hive Metastore
- Hive Metastore ä¸»è¦å„²å­˜è¡¨æ ¼çš„ schema å’Œä½ç½®è³‡è¨Š
- Transaction Log æ˜¯ Delta Lake çš„æ ¸å¿ƒï¼ŒåŒ…å«æ‰€æœ‰å…ƒè³‡æ–™

### D. ...in the Hive metastore on the first 16 columns...
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- å„²å­˜ä½ç½®éŒ¯èª¤ï¼ˆæ‡‰ç‚º Transaction Logï¼‰
- æ¬„ä½æ•¸é‡ä¹ŸéŒ¯èª¤ï¼ˆæ‡‰ç‚º 32 æ¬„ï¼‰

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€ŒDelta çµ±è¨ˆä¸‰äºŒæ¬„ï¼ŒLog è£¡å­˜æ”¾ä¸åœ¨ Hiveã€**

### é—œéµæ•¸å­—è¨˜æ†¶
| é …ç›® | é è¨­å€¼ | èªªæ˜ |
|------|--------|------|
| çµ±è¨ˆæ¬„ä½æ•¸ | **32** | `delta.dataSkippingNumIndexedCols` |
| VACUUM ä¿ç•™æœŸ | **168 å°æ™‚** (7å¤©) | `delta.deletedFileRetentionDuration` |
| Checkpoint é–“éš” | **10** commits | æ¯ 10 æ¬¡æäº¤å»ºç«‹ä¸€å€‹ checkpoint |

### Delta Lake å„²å­˜æ¶æ§‹
```
my_table/
â”œâ”€â”€ _delta_log/           â† Transaction Log (çµ±è¨ˆè³‡è¨Šå­˜é€™è£¡!)
â”‚   â”œâ”€â”€ 00000000000000000000.json
â”‚   â”œâ”€â”€ 00000000000000000001.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ part-00000-xxx.parquet
â”œâ”€â”€ part-00001-xxx.parquet
â””â”€â”€ ...
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Delta Lake data skipping](https://docs.databricks.com/en/delta/data-skipping.html)
- [Delta Lake table properties](https://docs.databricks.com/en/delta/table-properties.html)

---

**[è¿”å›é¡Œç›®](#question-041)**
