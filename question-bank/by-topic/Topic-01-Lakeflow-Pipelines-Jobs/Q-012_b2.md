# Question #012

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-012`

### ä¾†æº
**ä¾†æº:** Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

A data engineer has defined the following data quality constraint in a LDP pipeline:

```sql
CONSTRAINT valid_id EXPECT (id IS NOT NULL) _____________
```

Which clause correctly fills in the blank so records violating this constraint will be written to the target table, but reported in metrics?

### é¸é …

- **A.** ON VIOLATION WARNING
- **B.** There is no need to add the ON VIOLATION clause. By default, records violating the constraint will be kept, and reported as invalid in the pipeline metrics.
- **C.** ON VIOLATION NULL
- **D.** ON VIOLATION ADD ROW

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Streaming`, `Data-Quality`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Default-Value`, `Syntax-Confusion`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Development

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `B`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** B
- **ç¤¾ç¾¤å…±è­˜:** B

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Delta Live Tables (DLT) / Lakeflow Declarative Pipelines (LDP)
**é—œéµæ¦‚å¿µ:** EXPECT constraint, Default behavior, ON VIOLATION clause

**é¡Œç›®é—œéµå­—ï¼š**
- **CONSTRAINT... EXPECT**: DLT çš„ SQL èªæ³•ç´„æŸæ¢ä»¶ã€‚
- **written to the target table**: è¨˜éŒ„ä»è¦å¯«å…¥ã€‚
- **reported in metrics**: éœ€è¦åœ¨æŒ‡æ¨™ä¸­å ±å‘Šã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ B æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

1. **EXPECT çš„é è¨­è¡Œç‚º**:
   åœ¨ DLT/LDP ä¸­ï¼Œ`EXPECT` ç´„æŸçš„é è¨­è¡Œç‚ºæ˜¯ï¼š
   - **ä¿ç•™æ‰€æœ‰è¨˜éŒ„**: é•åç´„æŸçš„è¨˜éŒ„ä»ç„¶æœƒå¯«å…¥ç›®æ¨™è¡¨
   - **è¨˜éŒ„æŒ‡æ¨™**: é•åç´„æŸçš„è¨˜éŒ„æ•¸æœƒè¢«è¨˜éŒ„åœ¨ pipeline metrics ä¸­
   - **ä¸æœƒé˜»æ–·è™•ç†**: ä¸æœƒå› ç‚ºé•åç´„æŸè€Œåœæ­¢ pipeline

2. **ç„¡éœ€é¡å¤–å­å¥**:
   å¦‚æœéœ€è¦çš„è¡Œç‚ºæ˜¯ã€Œä¿ç•™è¨˜éŒ„ + å ±å‘ŠæŒ‡æ¨™ã€ï¼Œåªéœ€è¦å¯«ï¼š
   ```sql
   CONSTRAINT valid_id EXPECT (id IS NOT NULL)
   ```
   ä¸éœ€è¦æ·»åŠ ä»»ä½• `ON VIOLATION` å­å¥ã€‚

**ç­‰æ•ˆçš„ Python èªæ³•ï¼š**

```python
@dlt.expect("valid_id", "id IS NOT NULL")
# é è¨­è¡Œç‚ºï¼šä¿ç•™é•åè¨˜éŒ„ï¼Œè¨˜éŒ„æŒ‡æ¨™
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A - ON VIOLATION WARNING

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **èªæ³•ä¸å­˜åœ¨**: DLT ä¸­æ²’æœ‰ `ON VIOLATION WARNING` é€™å€‹èªæ³•ã€‚
- **æœ‰æ•ˆçš„ ON VIOLATION å­å¥**: åªæœ‰ `ON VIOLATION DROP ROW` å’Œ `ON VIOLATION FAIL UPDATE`ã€‚

### C - ON VIOLATION NULL

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **èªæ³•ä¸å­˜åœ¨**: DLT ä¸­æ²’æœ‰ `ON VIOLATION NULL` é€™å€‹èªæ³•ã€‚
- **ä¸æ˜¯æœ‰æ•ˆé¸é …**: é€™æ˜¯ç·¨é€ çš„èªæ³•ã€‚

### D - ON VIOLATION ADD ROW

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **èªæ³•ä¸å­˜åœ¨**: DLT ä¸­æ²’æœ‰ `ON VIOLATION ADD ROW` é€™å€‹èªæ³•ã€‚
- **é‚è¼¯ä¸é€š**: è¨˜éŒ„å·²ç¶“å­˜åœ¨ï¼Œä¸éœ€è¦ã€Œæ·»åŠ ã€ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€ŒEXPECT é è¨­ç•™ï¼Œä¸åŠ å­å¥ä¹Ÿå ±å‘Šã€**

### DLT CONSTRAINT èªæ³•æ¯”è¼ƒ (SQL)

| è¡Œç‚º | SQL èªæ³• |
|------|----------|
| **ä¿ç•™ + å ±å‘Š** (é è¨­) | `CONSTRAINT name EXPECT (condition)` |
| **ä¸Ÿæ£„é•è¦è¨˜éŒ„** | `CONSTRAINT name EXPECT (condition) ON VIOLATION DROP ROW` |
| **Pipeline å¤±æ•—** | `CONSTRAINT name EXPECT (condition) ON VIOLATION FAIL UPDATE` |

### Python vs SQL å°ç…§

| Python API | SQL èªæ³• | è¡Œç‚º |
|------------|----------|------|
| `@dlt.expect` | `EXPECT (...)` | ä¿ç•™ + å ±å‘Š |
| `@dlt.expect_or_drop` | `EXPECT (...) ON VIOLATION DROP ROW` | ä¸Ÿæ£„ |
| `@dlt.expect_or_fail` | `EXPECT (...) ON VIOLATION FAIL UPDATE` | å¤±æ•— |

### æœ‰æ•ˆçš„ ON VIOLATION å­å¥

```sql
-- åªæœ‰é€™å…©å€‹æ˜¯æœ‰æ•ˆçš„ï¼š
ON VIOLATION DROP ROW     -- ä¸Ÿæ£„é•è¦è¨˜éŒ„
ON VIOLATION FAIL UPDATE  -- Pipeline å¤±æ•—

-- ä»¥ä¸‹éƒ½æ˜¯ç„¡æ•ˆçš„ï¼ˆä¸å­˜åœ¨ï¼‰ï¼š
ON VIOLATION WARNING      -- âŒ
ON VIOLATION NULL         -- âŒ
ON VIOLATION ADD ROW      -- âŒ
ON VIOLATION IGNORE       -- âŒ
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [DLT Expectations](https://docs.databricks.com/delta-live-tables/expectations.html)
- [SQL Constraint Syntax](https://docs.databricks.com/delta-live-tables/sql-ref.html#constraint)
- [Manage Data Quality](https://docs.databricks.com/delta-live-tables/expectations.html#manage-data-quality-with-delta-live-tables)

---

**[è¿”å›é¡Œç›®](#question-012)**
