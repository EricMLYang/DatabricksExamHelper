# Question #055

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-055`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
A junior data engineer has been tasked with implementing data quality validation in a Lakeflow Declarative Pipeline (LDP). They added several expectation functions to ensure that incoming datasets meet certain criteria before being processed further. After the junior engineer submitted a pull request, a senior data engineer began reviewing the code and noticed that one of the function calls used for validation was not correct.

As part of the review, the senior engineer wants to ensure that all expectation functions used in the pipeline are valid according to Databricks documentation.

Which of the following function calls is Not a valid expectation function in Lakeflow Declarative Pipelines?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** dlt.expect
- **B.** dlt.expect_or_warn
- **C.** dlt.expect_or_drop
- **D.** dlt.expect_or_fail

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Databricks-Workflows`, `Data-Quality`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Similar-Function`, `Syntax-Confusion`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Development

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `B`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** B
- **ç¤¾ç¾¤å…±è­˜:** B

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Lakeflow Declarative Pipelines (LDP) / Delta Live Tables (DLT) Expectations
**é—œéµæ¦‚å¿µ:** è³‡æ–™å“è³ªé©—è­‰å‡½æ•¸ã€Expectation é¡å‹
**é¡Œç›®é—œéµå­—ï¼š**
- **Not a valid expectation function**: å°‹æ‰¾ä¸å­˜åœ¨çš„å‡½æ•¸
- **Lakeflow Declarative Pipeline**: å³ Delta Live Tables (DLT)
- **data quality validation**: è³‡æ–™å“è³ªé©—è­‰

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ B æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**`dlt.expect_or_warn` ä¸å­˜åœ¨**ã€‚Lakeflow Declarative Pipelines (LDP) åªæ”¯æ´ä¸‰ç¨® expectation å‡½æ•¸ã€‚

#### LDP æ”¯æ´çš„ Expectation å‡½æ•¸
| å‡½æ•¸ | å­˜åœ¨ï¼Ÿ | é•è¦æ™‚çš„è¡Œç‚º |
|------|--------|--------------|
| `dlt.expect` | âœ… | è¨˜éŒ„é•è¦ï¼Œç¹¼çºŒå¯«å…¥ï¼ˆwarn èªç¾©ï¼‰ |
| `dlt.expect_or_drop` | âœ… | ä¸Ÿæ£„é•è¦è³‡æ–™åˆ— |
| `dlt.expect_or_fail` | âœ… | ç®¡ç·šå¤±æ•—ï¼Œåœæ­¢åŸ·è¡Œ |
| `dlt.expect_or_warn` | âŒ | **ä¸å­˜åœ¨ï¼** |

#### Expectation è¡Œç‚ºæ¯”è¼ƒ
```
è³‡æ–™æµå‘èˆ‡ Expectation è™•ç†ï¼š

è¼¸å…¥è³‡æ–™ â”€â”€â†’ Expectation æª¢æŸ¥ â”€â”€â†’ çµæœè™•ç†
                  â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â†“            â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ expect  â”‚  â”‚expect_orâ”‚  â”‚expect_orâ”‚
â”‚         â”‚  â”‚  _drop  â”‚  â”‚  _fail  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â†“            â†“            â†“
  è¨˜éŒ„é•è¦     ä¸Ÿæ£„é•è¦      ç®¡ç·šå¤±æ•—
  ç¹¼çºŒå¯«å…¥     ç¹¼çºŒåŸ·è¡Œ      åœæ­¢åŸ·è¡Œ
```

#### ä½¿ç”¨ç¯„ä¾‹
```python
import dlt

@dlt.table
@dlt.expect("valid_id", "id IS NOT NULL")  # âœ… æœ‰æ•ˆ
@dlt.expect_or_drop("positive_amount", "amount > 0")  # âœ… æœ‰æ•ˆ
@dlt.expect_or_fail("valid_date", "date <= current_date()")  # âœ… æœ‰æ•ˆ
# @dlt.expect_or_warn("...")  # âŒ é€™å€‹å‡½æ•¸ä¸å­˜åœ¨ï¼
def my_table():
    return spark.table("source")
```

#### ç‚ºä»€éº¼æ²’æœ‰ expect_or_warnï¼Ÿ
- **`dlt.expect` æœ¬èº«å°±æ˜¯ warn èªç¾©**
- é•è¦è³‡æ–™æœƒè¢«è¨˜éŒ„åˆ° event logï¼Œä½†ä»ç„¶å¯«å…¥ç›®æ¨™è¡¨
- æ‰€ä»¥ä¸éœ€è¦é¡å¤–çš„ `expect_or_warn` å‡½æ•¸

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A. dlt.expect
**ç‚ºä»€éº¼é€™æ˜¯æœ‰æ•ˆå‡½æ•¸ï¼Ÿ**
- é€™æ˜¯åŸºæœ¬çš„ expectation å‡½æ•¸
- é•è¦æ™‚ï¼šè¨˜éŒ„åˆ° event logï¼Œä½†**ç¹¼çºŒå¯«å…¥**è³‡æ–™
- é©ç”¨å ´æ™¯ï¼šéœ€è¦è¿½è¹¤è³‡æ–™å“è³ªï¼Œä½†ä¸é˜»æ“‹è³‡æ–™æµ

```python
@dlt.expect("valid_email", "email LIKE '%@%'")
# é•è¦è³‡æ–™ä»æœƒå¯«å…¥ï¼Œä½†æœƒè¨˜éŒ„é•è¦æ¬¡æ•¸
```

### C. dlt.expect_or_drop
**ç‚ºä»€éº¼é€™æ˜¯æœ‰æ•ˆå‡½æ•¸ï¼Ÿ**
- é•è¦æ™‚ï¼š**ä¸Ÿæ£„**ä¸ç¬¦åˆæ¢ä»¶çš„è³‡æ–™åˆ—
- è³‡æ–™ä¸æœƒå¯«å…¥ç›®æ¨™è¡¨
- é©ç”¨å ´æ™¯ï¼šç¢ºä¿ç›®æ¨™è¡¨åªæœ‰ä¹¾æ·¨è³‡æ–™

```python
@dlt.expect_or_drop("positive_quantity", "quantity > 0")
# è² æ•¸æˆ–é›¶çš„è³‡æ–™æœƒè¢«ä¸Ÿæ£„
```

### D. dlt.expect_or_fail
**ç‚ºä»€éº¼é€™æ˜¯æœ‰æ•ˆå‡½æ•¸ï¼Ÿ**
- é•è¦æ™‚ï¼šæ•´å€‹**ç®¡ç·šå¤±æ•—**ï¼Œåœæ­¢åŸ·è¡Œ
- æœ€åš´æ ¼çš„æª¢æŸ¥æ–¹å¼
- é©ç”¨å ´æ™¯ï¼šé—œéµè³‡æ–™å“è³ªå•é¡Œå¿…é ˆäººå·¥ä»‹å…¥

```python
@dlt.expect_or_fail("no_null_keys", "primary_key IS NOT NULL")
# ä»»ä½•ç©ºå€¼éƒ½æœƒå°è‡´ç®¡ç·šå¤±æ•—
```

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€Œexpect ä¸‰å…„å¼Ÿï¼šè¨˜éŒ„ã€ä¸Ÿæ£„ã€å¤±æ•—ï¼›warn æ˜¯å‡çš„ï¼ã€**

### Expectation å‡½æ•¸é€Ÿè¨˜
```
dlt.expect          â†’ åªè¨˜éŒ„ï¼ˆwarn èªç¾©ï¼‰
dlt.expect_or_drop  â†’ ä¸Ÿæ£„é•è¦
dlt.expect_or_fail  â†’ ç®¡ç·šå¤±æ•—

âŒ dlt.expect_or_warn â†’ ä¸å­˜åœ¨ï¼ˆå› ç‚º expect æœ¬èº«å°±æ˜¯ warnï¼‰
```

### åš´æ ¼ç¨‹åº¦æ¯”è¼ƒ
| å‡½æ•¸ | åš´æ ¼ç¨‹åº¦ | è³‡æ–™è™•ç† | ç®¡ç·šç‹€æ…‹ |
|------|----------|----------|----------|
| `expect` | ä½ | å…¨éƒ¨å¯«å…¥ | ç¹¼çºŒ |
| `expect_or_drop` | ä¸­ | ä¸Ÿæ£„é•è¦ | ç¹¼çºŒ |
| `expect_or_fail` | é«˜ | åœæ­¢è™•ç† | å¤±æ•— |

### é¸æ“‡æ±ºç­–æ¨¹
```
è³‡æ–™å“è³ªå•é¡Œçš„åš´é‡ç¨‹åº¦ï¼Ÿ
â”‚
â”œâ”€â”€ ä½ - åªéœ€è¿½è¹¤ï¼Œä¸å½±éŸ¿è³‡æ–™
â”‚   â””â”€â”€ dlt.expect
â”‚
â”œâ”€â”€ ä¸­ - ä¸è¦é«’è³‡æ–™ï¼Œä½†ä¸éœ€åœæ­¢
â”‚   â””â”€â”€ dlt.expect_or_drop
â”‚
â””â”€â”€ é«˜ - å¿…é ˆäººå·¥è™•ç†ï¼Œä¸èƒ½ç¹¼çºŒ
    â””â”€â”€ dlt.expect_or_fail
```

### å‘½åè¦å‰‡è¨˜æ†¶
```
expect_or_XXX è¡¨ç¤ºã€Œé•è¦æ™‚åš XXXã€ï¼š
â”œâ”€â”€ drop â†’ ä¸Ÿæ£„è³‡æ–™
â”œâ”€â”€ fail â†’ ç®¡ç·šå¤±æ•—
â””â”€â”€ warn â†’ âŒ ä¸éœ€è¦ï¼Œå› ç‚º expect æœ¬èº«å°±æ˜¯ warn
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Delta Live Tables Expectations](https://docs.databricks.com/delta-live-tables/expectations.html)
- [Manage Data Quality with Expectations](https://docs.databricks.com/delta-live-tables/expectations.html#manage-data-quality-with-expectations)
- [Lakeflow Declarative Pipelines](https://docs.databricks.com/delta-live-tables/index.html)

---

**[è¿”å›é¡Œç›®](#question-055)**
