# Question #046

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-046`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
A data engineer is working on a project that requires integrating data from an external API into a Databricks workspace. For security reasons, they decided not to hardcode the API key directly in their notebooks. Instead, they used Databricks Secrets to securely store and manage sensitive credentials, as follows:

```bash
databricks secrets create-scope api_scope
databricks secrets put-secret api_scope api_key
```

They now want to read the API key in order to query the external API endpoint from a Databricks notebook.

Which of the following code lines allows the data engineer to achieve this task?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** `api_key = dbutils.secrets.read("api_scope", "api_key")`
- **B.** `api_key = dbutils.secrets.get("api_scope", "api_key")`
- **C.** `api_key = dbutils.secrets.read("api_key", "api_scope")`
- **D.** `api_key = dbutils.secrets.get("api_key", "api_scope")`

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Security`, `Databricks-CLI`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Syntax-Confusion`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Security

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `B`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** B
- **ç¤¾ç¾¤å…±è­˜:** B

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Databricks Secrets
**é—œéµæ¦‚å¿µ:** dbutils.secrets èªæ³•ã€åƒæ•¸é †åº
**é¡Œç›®é—œéµå­—ï¼š**
- **dbutils.secrets**: Secrets å­˜å– API
- **scope/key**: ç¯„åœèˆ‡éµçš„é †åº
- **get vs read**: æ­£ç¢ºçš„æ–¹æ³•åç¨±

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ B æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

æ­£ç¢ºçš„èªæ³•æ˜¯ **`dbutils.secrets.get(scope, key)`**ã€‚

#### æ­£ç¢ºèªæ³•è§£æ
```python
# æ­£ç¢ºèªæ³•
api_key = dbutils.secrets.get("api_scope", "api_key")
#                             â†‘ scope     â†‘ key
#                             ç¬¬ä¸€åƒæ•¸    ç¬¬äºŒåƒæ•¸
```

#### åƒæ•¸é †åº
| åƒæ•¸ä½ç½® | åƒæ•¸åç¨± | èªªæ˜ |
|---------|---------|------|
| ç¬¬ä¸€åƒæ•¸ | scope | Secret çš„ç¯„åœåç¨± |
| ç¬¬äºŒåƒæ•¸ | key | Secret çš„éµåç¨± |

#### å®Œæ•´ä½¿ç”¨æµç¨‹
```python
# 1. è®€å– API Key
api_key = dbutils.secrets.get("api_scope", "api_key")

# 2. ä½¿ç”¨ API Key å‘¼å«å¤–éƒ¨ API
import requests
response = requests.get(
    "https://api.example.com/data",
    headers={"Authorization": f"Bearer {api_key}"}
)
```

#### dbutils.secrets å¯ç”¨æ–¹æ³•
| æ–¹æ³• | èªªæ˜ |
|------|------|
| `get(scope, key)` | å–å¾—æŒ‡å®š secret çš„å€¼ |
| `getBytes(scope, key)` | å–å¾— secret çš„ bytes å€¼ |
| `list(scope)` | åˆ—å‡ºæŒ‡å®š scope çš„æ‰€æœ‰ keys |
| `listScopes()` | åˆ—å‡ºæ‰€æœ‰ scopes |

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A. dbutils.secrets.read("api_scope", "api_key")
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **æ–¹æ³•åç¨±éŒ¯èª¤**ï¼šæ²’æœ‰ `read` æ–¹æ³•
- æ­£ç¢ºçš„æ–¹æ³•æ˜¯ `get`
- åƒæ•¸é †åºæ­£ç¢ºï¼Œä½†æ–¹æ³•åç¨±ä¸å°

```python
# éŒ¯èª¤ï¼šæ²’æœ‰ read æ–¹æ³•
dbutils.secrets.read(...)  # âŒ AttributeError

# æ­£ç¢ºï¼šä½¿ç”¨ get æ–¹æ³•
dbutils.secrets.get(...)   # âœ“
```

### C. dbutils.secrets.read("api_key", "api_scope")
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **æ–¹æ³•åç¨±éŒ¯èª¤**ï¼šæ²’æœ‰ `read` æ–¹æ³•
- **åƒæ•¸é †åºéŒ¯èª¤**ï¼škey å’Œ scope é †åºç›¸å
- å…©å€‹éŒ¯èª¤ï¼šæ–¹æ³• + é †åº

### D. dbutils.secrets.get("api_key", "api_scope")
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- æ–¹æ³•åç¨±æ­£ç¢ºï¼ˆ`get`ï¼‰
- **åƒæ•¸é †åºéŒ¯èª¤**ï¼šæ‡‰è©²æ˜¯ (scope, key)ï¼Œä¸æ˜¯ (key, scope)

```python
# éŒ¯èª¤é †åº
dbutils.secrets.get("api_key", "api_scope")  # âŒ æ‰¾ä¸åˆ° scope

# æ­£ç¢ºé †åº
dbutils.secrets.get("api_scope", "api_key")  # âœ“
```

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€ŒScope åœ¨å‰ Key åœ¨å¾Œï¼Œget æ–¹æ³•æ‰èƒ½æœ‰ã€**

### åƒæ•¸é †åºè¨˜æ†¶æ³•
```
è¨˜æ†¶æŠ€å·§ï¼šå…ˆã€Œå¤§ã€å¾Œã€Œå°ã€
â”œâ”€â”€ Scopeï¼ˆç¯„åœï¼‰â†’ å¤§ç¯„åœï¼Œæ”¾å‰é¢
â””â”€â”€ Keyï¼ˆéµï¼‰â†’ å…·é«”é …ç›®ï¼Œæ”¾å¾Œé¢

é¡æ¯”ï¼š
â”œâ”€â”€ å…ˆé¸ã€ŒæŠ½å±œã€ï¼ˆscopeï¼‰
â””â”€â”€ å†é¸ã€Œæ–‡ä»¶ã€ï¼ˆkeyï¼‰
```

### dbutils.secrets é€ŸæŸ¥è¡¨
| æ–¹æ³• | åƒæ•¸ | ç”¨é€” |
|------|------|------|
| `get(scope, key)` | scope, key | å–å€¼ |
| `getBytes(scope, key)` | scope, key | å– bytes |
| `list(scope)` | scope | åˆ—å‡º keys |
| `listScopes()` | ç„¡ | åˆ—å‡º scopes |

### é™·é˜±è­˜åˆ¥
```
æœ¬é¡Œé™·é˜±ï¼š
â”œâ”€â”€ æ–¹æ³•åç¨±é™·é˜±ï¼šread âŒ vs get âœ“
â””â”€â”€ åƒæ•¸é †åºé™·é˜±ï¼š(key, scope) âŒ vs (scope, key) âœ“

æ’åˆ—çµ„åˆï¼š
â”œâ”€â”€ A: read + æ­£ç¢ºé †åº â†’ âŒ
â”œâ”€â”€ B: get + æ­£ç¢ºé †åº â†’ âœ“ æ­£è§£
â”œâ”€â”€ C: read + éŒ¯èª¤é †åº â†’ âŒâŒ
â””â”€â”€ D: get + éŒ¯èª¤é †åº â†’ âŒ
```

### è¨˜æ†¶æŠ€å·§
- **get** = ã€Œå–ã€= å–å¾— secret å€¼
- **scope** = ã€Œç¯„åœã€= å…ˆç¢ºå®šç¯„åœ
- **key** = ã€Œéµã€= å†æŒ‡å®šå…·é«”çš„éµ

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Secret management](https://docs.databricks.com/en/security/secrets/index.html)
- [Secrets utility (dbutils.secrets)](https://docs.databricks.com/en/dev-tools/databricks-utils.html#secrets-utility-dbutilssecrets)

---

**[è¿”å›é¡Œç›®](#question-046)**
