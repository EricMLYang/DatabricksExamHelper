# Question #029

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-029`

### ä¾†æº
**ä¾†æº:** Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

A data engineering team manages a Delta Lake table in Unity Catalog called employees, with columns: id, name, salary, and region. They want to apply row filtering on this table so that only members of the HR team can access all records. If the table is queried by a non-HR team member, it should only show records in the France (FR) region. To achieve this, they implemented the following user-defined function:

```sql
CREATE FUNCTION fr_filter(region STRING)
RETURN IF(IS_ACCOUNT_GROUP_MEMBER('hr_team'), true, region='FR');
```

Which of the following commands can the team use to apply this function as a row filter to the table?

### é¸é …

- **A.** SET ROW FILTER fr_filter ON TABLE employees TO COLUMN region
- **B.** ALTER TABLE employees SET ROW FILTER fr_filter;
- **C.** ALTER TABLE employees SET ROW FILTER fr_filter ON (region);
- **D.** ALTER TABLE employees ALTER COLUMN region SET ROW FILTER fr_filter;

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Unity-Catalog`, `Row-Level-Security`, `Access-Control`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Syntax-Confusion`, `Similar-Options`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Security

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `C`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** C
- **ç¤¾ç¾¤å…±è­˜:** C

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Unity Catalog / Row Filter
**é—œéµæ¦‚å¿µ:** ALTER TABLE SET ROW FILTER, Row-level security, UDF binding

**é¡Œç›®é—œéµå­—ï¼š**
- **row filtering**: è¡Œç´šéæ¿¾ã€‚
- **user-defined function**: ä½¿ç”¨è€…å®šç¾©å‡½æ•¸ã€‚
- **apply this function as a row filter**: å°‡å‡½æ•¸ä½œç‚ºè¡Œéæ¿¾å™¨æ‡‰ç”¨ã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ C æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

1. **æ­£ç¢ºèªæ³•**:
   ```sql
   ALTER TABLE <table_name> SET ROW FILTER <function_name> ON (<column_list>);
   ```

2. **èªæ³•åˆ†æ**:
   - `ALTER TABLE employees`: ä¿®æ”¹ employees è¡¨
   - `SET ROW FILTER fr_filter`: è¨­å®šè¡Œéæ¿¾å™¨ç‚º fr_filter å‡½æ•¸
   - `ON (region)`: å°‡ region æ¬„ä½å‚³éçµ¦å‡½æ•¸ä½œç‚ºåƒæ•¸

3. **åŸ·è¡Œé‚è¼¯**:
   ```sql
   -- ç•¶æŸ¥è©¢ employees è¡¨æ™‚ï¼š
   SELECT * FROM employees
   -- å¯¦éš›åŸ·è¡Œï¼š
   SELECT * FROM employees WHERE fr_filter(region) = true
   ```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A - SET ROW FILTER ... ON TABLE ... TO COLUMN

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **èªæ³•ä¸å­˜åœ¨**: ä¸æ˜¯æœ‰æ•ˆçš„ SQL èªæ³•ã€‚
- **é—œéµå­—éŒ¯èª¤**: æ²’æœ‰ `TO COLUMN` é€™å€‹èªæ³•å…ƒç´ ã€‚

### B - ALTER TABLE ... SET ROW FILTER fr_filter;

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **ç¼ºå°‘åƒæ•¸ç¶å®š**: æ²’æœ‰æŒ‡å®šå°‡å“ªå€‹æ¬„ä½å‚³çµ¦å‡½æ•¸ã€‚
- **ä¸å®Œæ•´**: å¿…é ˆä½¿ç”¨ `ON (column_list)` æŒ‡å®šåƒæ•¸ã€‚

### D - ALTER COLUMN ... SET ROW FILTER

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **Row Filter ä¸æ˜¯ Column å±¬æ€§**: Row Filter æ˜¯è¡¨ç´šåˆ¥çš„è¨­å®šï¼Œä¸æ˜¯æ¬„ä½ç´šåˆ¥ã€‚
- **èªæ³•éŒ¯èª¤**: `ALTER COLUMN` ç”¨æ–¼ä¿®æ”¹æ¬„ä½å®šç¾©ï¼ˆå¦‚è³‡æ–™é¡å‹ï¼‰ï¼Œä¸æ˜¯è¨­å®šéæ¿¾å™¨ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€ŒALTER TABLE SET ROW FILTER ON æ¬„ä½ã€**

### Row Filter å®Œæ•´èªæ³•

```sql
-- å»ºç«‹ Row Filter å‡½æ•¸
CREATE FUNCTION <filter_name>(<params>)
RETURN <boolean_expression>;

-- å¥—ç”¨ Row Filter
ALTER TABLE <table_name> SET ROW FILTER <filter_name> ON (<column_list>);

-- ç§»é™¤ Row Filter
ALTER TABLE <table_name> DROP ROW FILTER;
```

### Unity Catalog å®‰å…¨åŠŸèƒ½æ¯”è¼ƒ

| åŠŸèƒ½ | ç”¨é€” | å±¤ç´š |
|------|------|------|
| **Row Filter** | æ§åˆ¶å¯è¦‹çš„**è¡Œ** | è¡¨å±¤ç´š |
| **Column Mask** | é®è”½ç‰¹å®š**æ¬„ä½**çš„å€¼ | æ¬„ä½å±¤ç´š |
| **Table ACL** | æ§åˆ¶è¡¨çš„å­˜å–æ¬Šé™ | è¡¨å±¤ç´š |

### å¸¸ç”¨ Row Filter å‡½æ•¸

| å‡½æ•¸ | ç”¨é€” |
|------|------|
| `IS_ACCOUNT_GROUP_MEMBER()` | æª¢æŸ¥æ˜¯å¦ç‚ºç‰¹å®šç¾¤çµ„æˆå“¡ |
| `CURRENT_USER()` | å–å¾—ç•¶å‰ä½¿ç”¨è€… |
| `IS_MEMBER()` | æª¢æŸ¥ç¾¤çµ„æˆå“¡èº«ä»½ |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [Row Filters and Column Masks](https://docs.databricks.com/data-governance/unity-catalog/row-and-column-filters.html)
- [CREATE FUNCTION for Row Filter](https://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-create-sql-function.html)

---

**[è¿”å›é¡Œç›®](#question-029)**
