# Question #051

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-051`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
A data engineer has been tasked with creating a Unity Catalog table containing customer information, including email addresses and phone numbers, across multiple regions. The organization wants to ensure that users can query the table, but personally identifiable information (PII) is not exposed to those without proper access.

Which method should the engineer use to efficiently enforce this requirement?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** Apply column masks to configure fine-grained access control
- **B.** Use table object privileges to revoke access on sensitive PII columns
- **C.** Use a dynamic view to redacting sensitive PII columns
- **D.** Use row-level filters to restrict access to region-specific customers

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Unity-Catalog`, `UC-Permissions`, `Access-Control`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Security & Governance

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `A`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** A
- **ç¤¾ç¾¤å…±è­˜:** A

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Unity Catalog Column Masks
**é—œéµæ¦‚å¿µ:** æ¬„ä½ç´šå­˜å–æ§åˆ¶ã€PII è³‡æ–™ä¿è­·ã€å‹•æ…‹é®ç½©
**é¡Œç›®é—œéµå­—ï¼š**
- **PII (Personally Identifiable Information)**: å€‹äººè­˜åˆ¥è³‡è¨Š
- **column masks**: æ¬„ä½é®ç½©ï¼Œå‹•æ…‹éš±è—æ•æ„Ÿè³‡æ–™
- **fine-grained access control**: ç´°ç²’åº¦å­˜å–æ§åˆ¶

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ A æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

Unity Catalog çš„ **Column Masks** æ˜¯å°ˆé–€è¨­è¨ˆç”¨æ–¼**æ¬„ä½ç´š**è³‡æ–™ä¿è­·çš„åŠŸèƒ½ï¼Œéå¸¸é©åˆ PII ä¿è­·å ´æ™¯ã€‚

#### Column Mask é‹ä½œåŸç†
```sql
-- æ­¥é©Ÿ 1: å»ºç«‹é®ç½©å‡½æ•¸
CREATE FUNCTION mask_email(email STRING)
RETURN CASE
  WHEN is_member('pii_access_group') THEN email
  ELSE CONCAT(LEFT(email, 2), '***@***.com')
END;

-- æ­¥é©Ÿ 2: å°‡é®ç½©å‡½æ•¸å¥—ç”¨åˆ°è¡¨æ ¼æ¬„ä½
ALTER TABLE customers ALTER COLUMN email SET MASK mask_email;

-- æˆ–åœ¨å»ºç«‹è¡¨æ ¼æ™‚ç›´æ¥å®šç¾©
CREATE TABLE customers (
  customer_id INT,
  name STRING,
  email STRING MASK mask_email,
  phone STRING MASK mask_phone
);
```

#### æŸ¥è©¢çµæœæ¯”è¼ƒ
| ç”¨æˆ¶é¡å‹ | email æ¬„ä½é¡¯ç¤º |
|---------|---------------|
| `pii_access_group` æˆå“¡ | `john.doe@company.com` |
| å…¶ä»–ç”¨æˆ¶ | `jo***@***.com` |

#### Column Mask çš„å„ªå‹¢
| ç‰¹é» | èªªæ˜ |
|------|------|
| **å…§å»ºåŠŸèƒ½** | Unity Catalog åŸç”Ÿæ”¯æ´ |
| **å‹•æ…‹åŸ·è¡Œ** | æŸ¥è©¢æ™‚å³æ™‚å¥—ç”¨ |
| **è²æ˜å¼** | ä¸€æ¬¡è¨­å®šï¼Œæ°¸ä¹…ç”Ÿæ•ˆ |
| **å¯ç¶­è­·** | é›†ä¸­ç®¡ç†é®ç½©é‚è¼¯ |
| **é€æ˜** | ç”¨æˆ¶æŸ¥è©¢èªæ³•ä¸è®Š |

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### B. Use table object privileges to revoke access on sensitive PII columns
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- è¡¨æ ¼ç‰©ä»¶æ¬Šé™æ§åˆ¶çš„æ˜¯**æ•´å¼µè¡¨æ ¼**çš„å­˜å–
- ç„¡æ³•åšåˆ°**æ¬„ä½ç´š**çš„å­˜å–æ§åˆ¶
- æœƒå®Œå…¨é˜»æ­¢ç”¨æˆ¶å­˜å–ï¼Œè€Œéé¸æ“‡æ€§éš±è—
- é¡Œç›®è¦æ±‚ã€Œç”¨æˆ¶å¯ä»¥æŸ¥è©¢è¡¨æ ¼ã€ï¼Œé€™å€‹æ–¹æ¡ˆæœƒé˜»æ­¢æŸ¥è©¢

### C. Use a dynamic view to redacting sensitive PII columns
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- Dynamic View é›–ç„¶å¯ä»¥é”æˆé¡ä¼¼æ•ˆæœ
- ä½†éœ€è¦**é¡å¤–å»ºç«‹å’Œç¶­è­·è¦–åœ–**
- Column Mask æ˜¯ Unity Catalog **åŸç”Ÿå…§å»º**çš„åŠŸèƒ½ï¼Œæ›´æœ‰æ•ˆç‡
- ä½¿ç”¨è¦–åœ–éœ€è¦æ”¹è®Šç”¨æˆ¶æŸ¥è©¢çš„è¡¨æ ¼åç¨±

### D. Use row-level filters to restrict access to region-specific customers
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- Row Filter æ§åˆ¶çš„æ˜¯**å“ªäº›è¡Œ**å¯è¦‹
- é¡Œç›®è¦æ±‚ä¿è­·çš„æ˜¯**ç‰¹å®šæ¬„ä½**ï¼ˆemail, phoneï¼‰
- Row Filter ç„¡æ³•éš±è—æ¬„ä½å…§å®¹
- é€™æ˜¯å…¸å‹çš„ã€Œè¡Œ vs æ¬„ã€æ¦‚å¿µæ··æ·†

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€Œä¿è­·è¡Œç”¨ Row Filterï¼Œä¿è­·æ¬„ç”¨ Column Maskã€**

### Row Filter vs Column Mask æ¯”è¼ƒ
```
è¡¨æ ¼ç¤ºæ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ region â”‚ name      â”‚ email           â”‚ phone        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ US     â”‚ John      â”‚ john@test.com   â”‚ 123-456-7890 â”‚
â”‚ EU     â”‚ Marie     â”‚ marie@test.com  â”‚ 987-654-3210 â”‚
â”‚ APAC   â”‚ Tanaka    â”‚ tanaka@test.com â”‚ 111-222-3333 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Row Filter (region='US'):
åªçœ‹åˆ° John é€™ä¸€è¡Œ â† æ§åˆ¶ã€Œè¡Œã€

Column Mask (email, phone):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ region â”‚ name      â”‚ email           â”‚ phone        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ US     â”‚ John      â”‚ jo***@***.com   â”‚ ***-***-7890 â”‚
â”‚ EU     â”‚ Marie     â”‚ ma***@***.com   â”‚ ***-***-3210 â”‚
â”‚ APAC   â”‚ Tanaka    â”‚ ta***@***.com   â”‚ ***-***-3333 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
çœ‹åˆ°æ‰€æœ‰è¡Œï¼Œä½†æ•æ„Ÿæ¬„ä½è¢«é®ç½© â† æ§åˆ¶ã€Œæ¬„ã€
```

### Unity Catalog å­˜å–æ§åˆ¶å±¤ç´š
| å±¤ç´š | æ©Ÿåˆ¶ | ç”¨é€” |
|------|------|------|
| è¡¨æ ¼ç´š | GRANT/REVOKE | æ•´è¡¨å­˜å–æ§åˆ¶ |
| è¡Œç´š | Row Filter | éæ¿¾å¯è¦‹è¡Œ |
| æ¬„ç´š | Column Mask | é®ç½©æ•æ„Ÿæ¬„ä½ |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Column masks](https://docs.databricks.com/en/data-governance/unity-catalog/column-masks.html)
- [Row filters and column masks](https://docs.databricks.com/en/data-governance/unity-catalog/row-and-column-filters.html)

---

**[è¿”å›é¡Œç›®](#question-051)**
