# Question #60

---

## 題目資訊

### 題目編號
**ID:** `Q-060`

### 來源
**來源:** Real Exam Recall

### 難度等級
**難度:** `L3-Advanced`

---

## 題目內容

### 題幹

The data engineering team maintains a table of aggregate statistics through batch nightly updates.

This includes total sales for the previous day alongside totals and averages for a variety of time periods including the 7 previous days, year-to-date, and quarter-to-date.

This table is named store_sales_summary and the schema is as follows:

```
store_id INT, total_sales_qtd FLOAT, avg_daily_sales_qtd FLOAT, total_sales_ytd FLOAT, avg_daily_sales_ytd FLOAT, previous_day_sales FLOAT, total_sales_7d FLOAT, avg_daily_sales_7d FLOAT, updated TIMESTAMP
```

The table daily_store_sales contains all the information needed to update store_sales_summary.

The schema for this table is:

```
store_id INT, sales_date DATE, total_sales FLOAT
```

If daily_store_sales is implemented as a Type 1 table and the total_sales column might be adjusted after manual data auditing, which approach is the safest to generate accurate reports in the store_sales_summary table?

### 選項

- **A.** Implement the appropriate aggregate logic as a batch read against the daily_store_sales table and overwrite the store_sales_summary table with each Update.
- **B.** Implement the appropriate aggregate logic as a batch read against the daily_store_sales table and append new rows nightly to the store_sales_summary table.
- **C.** Implement the appropriate aggregate logic as a batch read against the daily_store_sales table and use upsert logic to update results in the store_sales_summary table.
- **D.** Implement the appropriate aggregate logic as a Structured Streaming read against the daily_store_sales table and use upsert logic to update results in the store_sales_summary table.
- **E.** Use Structured Streaming to subscribe to the change data feed for daily_store_sales and apply changes to the aggregates in the store_sales_summary table with each update.

---

## 標籤系統

### Topic Tags (技術主題標籤)
**Topics:** `Aggregate-Tables`, `Type-1-SCD`, `Batch-Processing`, `Data-Auditing`

### Trap Tags (陷阱類型標籤)
**Traps:** `Update-Strategy`, `Batch-vs-Stream`

### Knowledge Domain (知識領域)
**Domain:** `Data Engineering`

---

## 答案與解析連結

### 正確答案
**正解:** `C`

### 解析檔案
**詳細解析:** [點此查看解析](../analysis/Q-060-analysis.md)

**備註:** Community discussion has splits between A and C/E.

---

## 相關資源

### 官方文件
- [MERGE INTO](https://docs.databricks.com/sql/language-manual/delta-merge-into.html)
- [Aggregate Tables Best Practices](https://docs.databricks.com/optimizations/semi-structured.html)
