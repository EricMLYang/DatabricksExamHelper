# Question #039

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-039`

### ä¾†æº
**ä¾†æº:** Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

A data engineer is testing a transformation pipeline that adds a new column to an existing DataFrame. They want to ensure the resulting DataFrame matches the expected output.

Which of the following functions can a data engineer use to verify equality?

### é¸é …

- **A.** verifyEquality(actual_df, expected_df)
- **B.** assert(actual_df = expected_df)
- **C.** assertDataFrameEqual(actual_df, expected_df)
- **D.** assertEqual(actual_df, expected_df)

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `PySpark-Testing`, `DataFrame-Operations`, `Unit-Testing`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Similar-Function`, `Syntax-Confusion`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Development

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `C`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** C
- **ç¤¾ç¾¤å…±è­˜:** C

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** PySpark Testing / DataFrame Comparison
**é—œéµæ¦‚å¿µ:** assertDataFrameEqual, pyspark.testing module

**é¡Œç›®é—œéµå­—ï¼š**
- **testing a transformation pipeline**: æ¸¬è©¦è½‰æ›ç®¡ç·šã€‚
- **ensure the resulting DataFrame matches**: ç¢ºä¿ DataFrame ç›¸ç¬¦ã€‚
- **verify equality**: é©—è­‰ç›¸ç­‰æ€§ã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ C æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

1. **assertDataFrameEqual æ˜¯ PySpark å®˜æ–¹æ¸¬è©¦å‡½æ•¸**:
   ```python
   from pyspark.testing import assertDataFrameEqual

   # åŸºæœ¬ç”¨æ³•
   assertDataFrameEqual(actual_df, expected_df)
   ```

2. **å‡½æ•¸åŠŸèƒ½**:
   - æ¯”è¼ƒå…©å€‹ DataFrame çš„çµæ§‹å’Œå…§å®¹
   - å¦‚æœä¸ç›¸ç­‰ï¼Œæ‹‹å‡º `PySparkAssertionError`
   - æä¾›è©³ç´°çš„å·®ç•°å ±å‘Š

3. **å¯é¸åƒæ•¸**:
   ```python
   assertDataFrameEqual(
       actual_df,
       expected_df,
       checkRowOrder=False,       # æ˜¯å¦æª¢æŸ¥è¡Œé †åº
       rtol=1e-5,                 # ç›¸å°èª¤å·®å®¹è¨±å€¼
       atol=1e-8,                 # çµ•å°èª¤å·®å®¹è¨±å€¼
       ignoreNullable=False,      # æ˜¯å¦å¿½ç•¥ nullable å·®ç•°
       ignoreColumnOrder=False    # æ˜¯å¦å¿½ç•¥æ¬„ä½é †åº
   )
   ```

4. **ä½¿ç”¨ç¯„ä¾‹**:
   ```python
   from pyspark.testing import assertDataFrameEqual

   # è½‰æ›ç®¡ç·š
   actual_df = source_df.withColumn("new_col", col("value") * 2)

   # é æœŸçµæœ
   expected_df = spark.createDataFrame([
       (1, 2), (2, 4), (3, 6)
   ], ["value", "new_col"])

   # é©—è­‰
   assertDataFrameEqual(actual_df, expected_df)
   ```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A - verifyEquality

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **å‡½æ•¸ä¸å­˜åœ¨**: PySpark ä¸­æ²’æœ‰ `verifyEquality` å‡½æ•¸ã€‚
- **è™›æ§‹åç¨±**: ä¸æ˜¯ä»»ä½•æ¨™æº–æ¸¬è©¦åº«çš„å‡½æ•¸ã€‚

### B - assert(actual_df = expected_df)

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **èªæ³•éŒ¯èª¤**: `=` æ˜¯è³¦å€¼ï¼Œæ‡‰è©²ç”¨ `==` æ¯”è¼ƒã€‚
- **DataFrame æ¯”è¼ƒå•é¡Œ**: å³ä½¿ç”¨ `==`ï¼Œä¹Ÿç„¡æ³•æ­£ç¢ºæ¯”è¼ƒ DataFrame å…§å®¹ã€‚
- **Python assert**: æ¨™æº– assert ä¸é©ç”¨æ–¼ DataFrame æ¯”è¼ƒã€‚

### D - assertEqual

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **unittest å‡½æ•¸**: `assertEqual` æ˜¯ `unittest.TestCase` çš„æ–¹æ³•ã€‚
- **ä¸é©ç”¨æ–¼ DataFrame**: ç„¡æ³•æ­£ç¢ºæ¯”è¼ƒ Spark DataFrame çš„å…§å®¹ã€‚
- **éœ€è¦æ¸¬è©¦é¡**: å¿…é ˆåœ¨ TestCase å­é¡ä¸­ä½¿ç”¨ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€ŒDataFrame æ¸¬è©¦ç”¨ assertDataFrameEqualã€**

### PySpark Testing æ¨¡çµ„

| å‡½æ•¸ | ç”¨é€” |
|------|------|
| **assertDataFrameEqual** | æ¯”è¼ƒå…©å€‹ DataFrame |
| assertSchemaEqual | åªæ¯”è¼ƒ Schema |
| assertPandasOnSparkEqual | æ¯”è¼ƒ pandas-on-Spark DataFrame |

### DataFrame æ¸¬è©¦æœ€ä½³å¯¦è¸

```python
from pyspark.testing import assertDataFrameEqual

class TestTransformations:
    def test_add_column(self):
        # Arrange
        source_df = spark.createDataFrame([(1,), (2,)], ["id"])
        expected_df = spark.createDataFrame([(1, 2), (2, 4)], ["id", "doubled"])

        # Act
        actual_df = source_df.withColumn("doubled", col("id") * 2)

        # Assert
        assertDataFrameEqual(actual_df, expected_df)
```

### å¸¸è¦‹æ¯”è¼ƒéœ€æ±‚

| éœ€æ±‚ | åƒæ•¸è¨­å®š |
|------|----------|
| å¿½ç•¥è¡Œé †åº | `checkRowOrder=False` |
| å¿½ç•¥æ¬„ä½é †åº | `ignoreColumnOrder=True` |
| å…è¨±æµ®é»æ•¸èª¤å·® | `rtol=0.01, atol=0.001` |
| å¿½ç•¥ nullable å·®ç•° | `ignoreNullable=True` |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [PySpark Testing](https://spark.apache.org/docs/latest/api/python/reference/pyspark.testing.html)
- [assertDataFrameEqual](https://spark.apache.org/docs/latest/api/python/reference/pyspark.testing/api/pyspark.testing.assertDataFrameEqual.html)

---

**[è¿”å›é¡Œç›®](#question-039)**
