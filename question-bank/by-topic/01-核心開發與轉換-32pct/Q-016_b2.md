# Question #016

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-016`

### ä¾†æº
**ä¾†æº:** Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L2-Intermediate`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

A data engineering team is managing a Delta Lake table called orders. They want to ensure that they can access the table's historical data using time travel for the same duration as Delta Lake's default transaction log retention.

Which of the following commands meet this requirement?

### é¸é …

- **A.** `ALTER TABLE orders SET TBLPROPERTIES ('delta.deletedFileRetentionDuration' = 'interval 90 days')`
- **B.** `ALTER TABLE orders SET TBLPROPERTIES ('delta.deletedFileRetentionDuration' = 'interval 30 days')`
- **C.** `ALTER TABLE orders SET TBLPROPERTIES ('delta.deletedFileRetentionDuration' = 'interval 7 days')`
- **D.** `ALTER TABLE orders SET TBLPROPERTIES ('delta.deletedFileRetentionDuration' = 'interval 365 days')`

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Delta-Lake`, `Data-Retention`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Default-Value`, `Number-Trap`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Data Management

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `B`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** B
- **ç¤¾ç¾¤å…±è­˜:** B

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Delta Lake / Data Retention / Time Travel
**é—œéµæ¦‚å¿µ:** Transaction log retention, deletedFileRetentionDuration, VACUUM

**é¡Œç›®é—œéµå­—ï¼š**
- **time travel**: æ™‚é–“æ—…è¡ŒåŠŸèƒ½ï¼Œå­˜å–æ­·å²ç‰ˆæœ¬è³‡æ–™ã€‚
- **default transaction log retention**: é è¨­çš„äº¤æ˜“æ—¥èªŒä¿ç•™æœŸé™ã€‚
- **same duration**: éœ€è¦åŒ¹é…é è¨­å€¼ã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ B æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

1. **Delta Lake é è¨­ä¿ç•™æœŸé™**:
   - **Transaction log retention**: é è¨­ **30 å¤©**
   - é€™æ±ºå®šäº†å¯ä»¥ä½¿ç”¨ Time Travel å­˜å–çš„æ­·å²ç¯„åœ

2. **å…©å€‹é—œéµè¨­å®šçš„é—œä¿‚**:
   | è¨­å®š | é è¨­å€¼ | æ§åˆ¶é …ç›® |
   |------|--------|----------|
   | `delta.logRetentionDuration` | 30 å¤© | Transaction log ä¿ç•™æœŸé™ |
   | `delta.deletedFileRetentionDuration` | 7 å¤© | å·²åˆªé™¤æª”æ¡ˆä¿ç•™æœŸé™ |

3. **ç‚ºä»€éº¼éœ€è¦èª¿æ•´ deletedFileRetentionDuration**:
   - Transaction log ä¿ç•™ 30 å¤©ï¼Œè¡¨ç¤ºå¯ä»¥æŸ¥è©¢ 30 å¤©å‰çš„ç‰ˆæœ¬
   - ä½†å¦‚æœ deletedFileRetentionDuration åªæœ‰ 7 å¤©ï¼ŒVACUUM æœƒåˆªé™¤ 7 å¤©å‰çš„èˆŠæª”æ¡ˆ
   - çµæœï¼š7 å¤©å¾Œçš„ Time Travel æœƒå› ç‚ºæª”æ¡ˆä¸å­˜åœ¨è€Œå¤±æ•—
   - è¦è®“ Time Travel èƒ½ç”¨åˆ° 30 å¤©ï¼Œéœ€è¦å°‡å…©è€…è¨­ç‚ºç›¸åŒ

**è¨­å®šæŒ‡ä»¤ï¼š**

```sql
ALTER TABLE orders
SET TBLPROPERTIES ('delta.deletedFileRetentionDuration' = 'interval 30 days');
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A - 90 å¤©

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **è¶…éé è¨­å€¼**: é¡Œç›®è¦æ±‚èˆ‡é è¨­ transaction log retentionï¼ˆ30 å¤©ï¼‰ç›¸åŒã€‚
- **å¯ä»¥ä½¿ç”¨ä½†ä¸ç¬¦åˆé¡Œæ„**: 90 å¤©å¯ä»¥é‹ä½œï¼Œä½†ä¸æ˜¯ã€ŒåŒ¹é…é è¨­å€¼ã€çš„ç­”æ¡ˆã€‚

### C - 7 å¤©

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **é€™æ˜¯ deletedFileRetentionDuration çš„é è¨­å€¼**: ä¸æ˜¯ transaction log retention çš„é è¨­å€¼ã€‚
- **æœƒé€ æˆ Time Travel å¤±æ•—**: 7 å¤©å¾Œçš„æ­·å²æŸ¥è©¢æœƒå› æª”æ¡ˆè¢«åˆªé™¤è€Œç„¡æ³•åŸ·è¡Œã€‚

### D - 365 å¤©

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **é è¶…éé è¨­å€¼**: é¡Œç›®è¦æ±‚åŒ¹é… 30 å¤©çš„é è¨­å€¼ã€‚
- **å„²å­˜æˆæœ¬é«˜**: ä¿ç•™ä¸€å¹´çš„åˆªé™¤æª”æ¡ˆæœƒä½”ç”¨å¤§é‡å„²å­˜ç©ºé–“ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€ŒLog ä¸‰åå¤©ï¼Œæª”æ¡ˆè¦è·Ÿä¸Šã€**

- Transaction log é è¨­ 30 å¤©
- deletedFileRetentionDuration è¦è¨­ç‚º 30 å¤©æ‰èƒ½é…åˆ

### Delta Lake ä¿ç•™è¨­å®šä¸€è¦½

| è¨­å®š | é è¨­å€¼ | èªªæ˜ |
|------|--------|------|
| `delta.logRetentionDuration` | **30 å¤©** | Transaction log ä¿ç•™æœŸé™ |
| `delta.deletedFileRetentionDuration` | **7 å¤©** | å·²åˆªé™¤æª”æ¡ˆä¿ç•™æœŸé™ |
| VACUUM é è¨­ | 7 å¤© | `VACUUM RETAIN 168 HOURS` |

### Time Travel æˆåŠŸæ¢ä»¶

```
Time Travel æˆåŠŸéœ€è¦ï¼š
1. Transaction log å­˜åœ¨ï¼ˆlogRetentionDurationï¼‰
2. è³‡æ–™æª”æ¡ˆå­˜åœ¨ï¼ˆdeletedFileRetentionDurationï¼‰

å…©è€…éƒ½è¦æ»¿è¶³ï¼
```

### å¸¸è¦‹é è¨­å€¼é€Ÿè¨˜

| é …ç›® | å¤©æ•¸ | å°æ™‚æ•¸ |
|------|------|--------|
| Log retention | 30 å¤© | 720 å°æ™‚ |
| File retention | 7 å¤© | **168 å°æ™‚** |
| VACUUM æœ€å°å€¼ | 7 å¤© | 168 å°æ™‚ |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [Delta Lake Table Properties](https://docs.databricks.com/delta/table-properties.html)
- [Time Travel](https://docs.databricks.com/delta/history.html)
- [VACUUM](https://docs.databricks.com/delta/vacuum.html)

---

**[è¿”å›é¡Œç›®](#question-016)**
