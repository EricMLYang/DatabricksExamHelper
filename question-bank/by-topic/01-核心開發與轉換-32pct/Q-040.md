# Question #40

---

## 題目資訊

### 題目編號
**ID:** `Q-040`

### 來源
**來源:** Real Exam Recall

### 難度等級
**難度:** `L3-Advanced`

---

## 題目內容

### 題幹

The view updates represents an incremental batch of all newly ingested data to be inserted or updated in the customers table.

The following logic is used to process these records.

```sql
MERGE INTO customers
USING (
    SELECT updates.customer_id as merge_key, updates.*
    FROM updates
    UNION ALL
    SELECT NULL as merge_key, updates.*
    FROM updates JOIN customers
    ON updates.customer_id = customers.customer_id
    WHERE customers.current = true AND updates.address <> customers.address
) staged_updates
ON customers.customer_id = merge_key
WHEN MATCHED AND customers.current = true AND customers.address <> staged_updates.address THEN
    UPDATE SET current = false, end_date = staged_updates.effective_date
WHEN NOT MATCHED THEN
    INSERT (customer_id, address, current, effective_date, end_date)
    VALUES (staged_updates.customer_id, staged_updates.address, true, staged_updates.effective_date, null)
```

Which statement describes this implementation?

### 選項

- **A.** The customers table is implemented as a Type 3 table; old values are maintained as a new column alongside the current value.
- **B.** The customers table is implemented as a Type 2 table; old values are maintained but marked as no longer current and new values are inserted.
- **C.** The customers table is implemented as a Type 0 table; all writes are append only with no changes to existing values.
- **D.** The customers table is implemented as a Type 1 table; old values are overwritten by new values and no history is maintained.
- **E.** The customers table is implemented as a Type 2 table; old values are overwritten and new customers are appended.

---

## 標籤系統

### Topic Tags (技術主題標籤)
**Topics:** `Type-2-SCD`, `MERGE`, `Slowly-Changing-Dimensions`, `History-Tracking`

### Trap Tags (陷阱類型標籤)
**Traps:** `SCD-Types`, `MERGE-Logic-Pattern`

### Knowledge Domain (知識領域)
**Domain:** `Data Engineering`

---

## 答案與解析連結

### 正確答案
**正解:** `B`

### 解析檔案
**詳細解析:** [點此查看解析](../analysis/Q-040-analysis.md)

---

## 相關資源

### 官方文件
- [Slowly Changing Dimensions](https://docs.databricks.com/delta/merge.html#slowly-changing-data-scd-type-2)
- [MERGE INTO](https://docs.databricks.com/sql/language-manual/delta-merge-into.html)
- [SCD Type 2 Implementation](https://docs.databricks.com/delta/merge.html#slowly-changing-data)
