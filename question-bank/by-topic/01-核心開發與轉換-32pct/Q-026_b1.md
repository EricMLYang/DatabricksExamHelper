# Question #026

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-026`

### ä¾†æº
**ä¾†æº:** Sample / Batch 1

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
The data engineering team has a Delta Lake table created with following query:

```sql
CREATE TABLE target
AS SELECT * FROM source
```

A data engineer wants to drop the source table with the following query:

```sql
DROP TABLE source
```

Which statement describes the result of running this drop command?

### é¸é …
- **A.** Only the source table will be dropped, but the target table will be no more queryable.

- **B.** Both the target and source tables will be dropped.

- **C.** An error will occur indicating that other tables are based on this source table.

- **D.** Only the source table will be dropped, while the target table will not be affected.

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Delta-Lake`, `Spark-SQL`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / SQL DDL

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `D`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** D
- **ç¤¾ç¾¤å…±è­˜:** D

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** CTAS (Create Table As Select) çš„è³‡æ–™ç¨ç«‹æ€§

**é—œéµæ¦‚å¿µ:**
- CTAS å»ºç«‹çš„æ˜¯**è³‡æ–™è¤‡æœ¬**ï¼Œä¸æ˜¯åƒç…§
- ä¾†æºè¡¨èˆ‡ç›®æ¨™è¡¨ä¹‹é–“**æ²’æœ‰ä¾è³´é—œä¿‚**
- DROP TABLE åªå½±éŸ¿æŒ‡å®šçš„è¡¨æ ¼

**é¡Œç›®é—œéµå­—ï¼š**
- **CREATE TABLE ... AS SELECT**: CTAS èªæ³•
- **DROP TABLE**: åˆªé™¤è¡¨æ ¼
- **will not be affected**: ä¸å—å½±éŸ¿

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ D æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

`CREATE TABLE AS SELECT` (CTAS) æœƒ**è¤‡è£½è³‡æ–™**åˆ°æ–°è¡¨æ ¼ï¼Œå»ºç«‹ä¸€å€‹å®Œå…¨ç¨ç«‹çš„è³‡æ–™é›†ã€‚ç›®æ¨™è¡¨æ ¼æ“æœ‰è‡ªå·±çš„è³‡æ–™æª”æ¡ˆï¼Œèˆ‡ä¾†æºè¡¨æ ¼**æ²’æœ‰ä»»ä½•é—œè¯**ã€‚

#### CTAS çš„é‹ä½œæ–¹å¼

```
åŸ·è¡Œ CREATE TABLE target AS SELECT * FROM source æ™‚ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   source è¡¨æ ¼    â”‚   è¤‡è£½    â”‚   target è¡¨æ ¼    â”‚
â”‚ â”œâ”€â”€ data_1.parquetâ”‚ â”€â”€â”€â”€â†’  â”‚ â”œâ”€â”€ data_a.parquetâ”‚
â”‚ â”œâ”€â”€ data_2.parquetâ”‚        â”‚ â”œâ”€â”€ data_b.parquetâ”‚
â”‚ â””â”€â”€ _delta_log/  â”‚         â”‚ â””â”€â”€ _delta_log/  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                            â†‘
    ç¨ç«‹çš„è³‡æ–™                    ç¨ç«‹çš„è³‡æ–™

åˆªé™¤ source å¾Œï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   source è¡¨æ ¼    â”‚          â”‚   target è¡¨æ ¼    â”‚
â”‚     (å·²åˆªé™¤)     â”‚          â”‚ â”œâ”€â”€ data_a.parquetâ”‚ â† ä»ç„¶å­˜åœ¨ï¼
â”‚                 â”‚          â”‚ â”œâ”€â”€ data_b.parquetâ”‚
â”‚                 â”‚          â”‚ â””â”€â”€ _delta_log/  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é©—è­‰ç¯„ä¾‹

```sql
-- 1. å»ºç«‹ä¾†æºè¡¨æ ¼
CREATE TABLE source (id INT, name STRING);
INSERT INTO source VALUES (1, 'Alice'), (2, 'Bob');

-- 2. ä½¿ç”¨ CTAS å»ºç«‹ç›®æ¨™è¡¨æ ¼
CREATE TABLE target AS SELECT * FROM source;

-- 3. é©—è­‰ç›®æ¨™è¡¨æ ¼æœ‰è³‡æ–™
SELECT * FROM target;
-- çµæœ: (1, 'Alice'), (2, 'Bob')

-- 4. åˆªé™¤ä¾†æºè¡¨æ ¼
DROP TABLE source;

-- 5. ç›®æ¨™è¡¨æ ¼ä»ç„¶å¯ä»¥æŸ¥è©¢
SELECT * FROM target;
-- çµæœ: (1, 'Alice'), (2, 'Bob') â† ä¸å—å½±éŸ¿ï¼
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### é¸é … A
**Only the source table will be dropped, but the target table will be no more queryable.**

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

1. **CTAS å»ºç«‹çš„æ˜¯ç¨ç«‹è¡¨æ ¼ï¼Œä¸æ˜¯ View**ï¼š
   - View æœƒä¾è³´ä¾†æºè¡¨æ ¼ï¼Œåˆªé™¤ä¾†æºæœƒå½±éŸ¿ View
   - CTAS å»ºç«‹çš„æ˜¯**å¯¦é«”è¡¨æ ¼**ï¼Œæœ‰è‡ªå·±çš„è³‡æ–™

2. **å°æ¯” CTAS å’Œ View**ï¼š
```sql
-- CTAS: è¤‡è£½è³‡æ–™ï¼ˆç¨ç«‹ï¼‰
CREATE TABLE target AS SELECT * FROM source;
DROP TABLE source;  -- target ä¸å—å½±éŸ¿ âœ…

-- View: åƒç…§ä¾†æºï¼ˆä¾è³´ï¼‰
CREATE VIEW target_view AS SELECT * FROM source;
DROP TABLE source;  -- target_view ç„¡æ³•æŸ¥è©¢ âŒ
```

---

### é¸é … B
**Both the target and source tables will be dropped.**

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

1. **DROP TABLE åªåˆªé™¤æŒ‡å®šçš„è¡¨æ ¼**ï¼š
   - `DROP TABLE source` åªæœƒåˆªé™¤ source
   - ä¸æœƒé€£å¸¶åˆªé™¤å…¶ä»–è¡¨æ ¼

2. **æ²’æœ‰ç´šè¯åˆªé™¤**ï¼š
   - Delta Lake æ²’æœ‰è‡ªå‹•çš„ç´šè¯åˆªé™¤æ©Ÿåˆ¶
   - å³ä½¿æœ‰ä¾è³´é—œä¿‚ï¼Œä¹Ÿä¸æœƒè‡ªå‹•åˆªé™¤ä¾è³´ç‰©ä»¶

---

### é¸é … C
**An error will occur indicating that other tables are based on this source table.**

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

1. **CTAS ä¸å»ºç«‹ä¾è³´é—œä¿‚**ï¼š
   - ç³»çµ±ä¸æœƒè¿½è¹¤ã€Œå“ªäº›è¡¨æ ¼æ˜¯å¾é€™å€‹è¡¨æ ¼ CTAS ä¾†çš„ã€
   - å› ç‚º CTAS å¾Œå…©å€‹è¡¨æ ¼å®Œå…¨ç¨ç«‹

2. **æ²’æœ‰åƒç…§å®Œæ•´æ€§æª¢æŸ¥**ï¼š
   - Delta Lake çš„ DROP TABLE ä¸æœƒæª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–è¡¨æ ¼æ›¾ç¶“åƒç…§
   - é€™èˆ‡ View çš„è¡Œç‚ºä¸åŒ

```sql
-- View æœƒæœ‰éŒ¯èª¤æç¤ºï¼ˆæŸäº›æƒ…æ³ï¼‰
CREATE VIEW my_view AS SELECT * FROM source;
DROP TABLE source;
-- å¯èƒ½è­¦å‘Šæˆ– View å¤±æ•ˆ

-- CTAS ä¸æœƒæœ‰ä»»ä½•éŒ¯èª¤
CREATE TABLE target AS SELECT * FROM source;
DROP TABLE source;
-- æ²’æœ‰éŒ¯èª¤ï¼Œç›´æ¥æˆåŠŸ âœ…
```

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£
**ã€ŒCTAS è¤‡è£½è³‡æ–™ï¼Œä¾†æºåˆªäº†æ²’é—œä¿‚ã€**
â†’ CTAS å»ºç«‹ç¨ç«‹è³‡æ–™è¤‡æœ¬ï¼Œä¾†æºè¡¨æ ¼çš„åˆªé™¤ä¸å½±éŸ¿ç›®æ¨™è¡¨æ ¼

### CTAS vs View vs Clone æ¯”è¼ƒ

| ç‰¹æ€§ | CTAS | View | CLONE |
|------|------|------|-------|
| **è³‡æ–™å„²å­˜** | è¤‡è£½è³‡æ–™ | ç„¡è³‡æ–™ï¼ˆåƒç…§ï¼‰ | è¤‡è£½ metadataï¼ˆæ·ºå±¤ï¼‰æˆ–è³‡æ–™ï¼ˆæ·±å±¤ï¼‰ |
| **ä¾†æºåˆªé™¤å½±éŸ¿** | âŒ ç„¡å½±éŸ¿ | âœ… å¤±æ•ˆ | âŒ ç„¡å½±éŸ¿ï¼ˆæ·±å±¤ï¼‰/ âœ… æœ‰å½±éŸ¿ï¼ˆæ·ºå±¤ï¼‰ |
| **è³‡æ–™åŒæ­¥** | âŒ ä¸åŒæ­¥ | âœ… å³æ™‚åŒæ­¥ | âŒ ä¸åŒæ­¥ |
| **å„²å­˜ç©ºé–“** | ä½”ç”¨ç©ºé–“ | ä¸ä½”ç”¨ | æ·ºå±¤ä¸ä½”ç”¨ / æ·±å±¤ä½”ç”¨ |

### å¸¸è¦‹å»ºè¡¨æ–¹å¼

```sql
-- 1. CTAS: è¤‡è£½è³‡æ–™ï¼Œå®Œå…¨ç¨ç«‹
CREATE TABLE target AS SELECT * FROM source;

-- 2. View: é‚è¼¯è¦–åœ–ï¼Œä¾è³´ä¾†æº
CREATE VIEW target_view AS SELECT * FROM source;

-- 3. SHALLOW CLONE: è¤‡è£½ metadataï¼Œå…±äº«è³‡æ–™æª”æ¡ˆ
CREATE TABLE target SHALLOW CLONE source;

-- 4. DEEP CLONE: å®Œæ•´è¤‡è£½ï¼ˆåŒ…å«è³‡æ–™ï¼‰
CREATE TABLE target DEEP CLONE source;
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [CREATE TABLE AS SELECT](https://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-create-table-using.html)
- [DROP TABLE](https://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-drop-table.html)
- [CLONE](https://docs.databricks.com/sql/language-manual/delta-clone.html)

---

**[è¿”å›é¡Œç›®](#question-026)**
