# Question #019

---

## é¡Œç›®è³‡è¨Š

### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-019`

### ä¾†æº
**ä¾†æº:** Community

### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹

### é¡Œå¹¹

The data engineering team has a Delta Lake table created with following query:

```sql
CREATE TABLE customers_clone
AS SELECT * FROM customers
```

A data engineer wants to drop the table with the following query:

```sql
DROP TABLE customers_clone
```

Which statement describes the result of running this drop command?

### é¸é …

- **A.** The table will not be dropped until VACUUM command is run.
- **B.** Both the table's metadata and the data files will be deleted.
- **C.** An error will occur as the table is deep cloned from the customers table.
- **D.** Only the table's metadata will be deleted from the catalog, while the data files will be kept in the storage.

---

## æ¨™ç±¤ç³»çµ±

### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Delta-Lake`, `Unity-Catalog`

### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Concept-Confusion`

### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Data Management

---

## ç­”æ¡ˆèˆ‡ä¾†æº

### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `B`

### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** B
- **ç¤¾ç¾¤å…±è­˜:** B

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥

**æ ¸å¿ƒæŠ€è¡“:** Delta Lake / Managed Tables
**é—œéµæ¦‚å¿µ:** Managed vs External tables, DROP TABLE behavior, CTAS

**é¡Œç›®é—œéµå­—ï¼š**
- **CREATE TABLE ... AS SELECT**: CTAS èªæ³•ï¼Œå»ºç«‹ Managed Tableã€‚
- **æ²’æœ‰ LOCATION**: è¡¨ç¤ºæ˜¯ Managed Tableã€‚
- **DROP TABLE**: åˆªé™¤è¡¨æ ¼çš„è¡Œç‚ºã€‚

---

## âœ… æ­£è§£èªªæ˜

### ç‚ºä»€éº¼ B æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**æŠ€è¡“åŸç†ï¼š**

1. **Managed Table vs External Table**:
   - ä½¿ç”¨ CTASï¼ˆæ²’æœ‰ LOCATION å­å¥ï¼‰å»ºç«‹çš„æ˜¯ **Managed Table**
   - Databricks ç®¡ç†é€™ç¨®è¡¨çš„ metadata å’Œè³‡æ–™æª”æ¡ˆ

2. **DROP TABLE å° Managed Table çš„è¡Œç‚º**:
   - **åˆªé™¤ metadata**: å¾ catalog ä¸­ç§»é™¤è¡¨æ ¼å®šç¾©
   - **åˆªé™¤è³‡æ–™æª”æ¡ˆ**: åŒæ™‚åˆªé™¤åº•å±¤çš„è³‡æ–™æª”æ¡ˆ
   - é€™æ˜¯ Managed Table çš„è¨­è¨ˆè¡Œç‚º

3. **åˆ¤æ–·ä¾æ“š**:
   ```sql
   -- Managed Tableï¼ˆç„¡ LOCATIONï¼‰
   CREATE TABLE t1 AS SELECT * FROM source;
   DROP TABLE t1;  -- åˆªé™¤ metadata + è³‡æ–™

   -- External Tableï¼ˆæœ‰ LOCATIONï¼‰
   CREATE TABLE t2 LOCATION '/path' AS SELECT * FROM source;
   DROP TABLE t2;  -- åªåˆªé™¤ metadataï¼Œä¿ç•™è³‡æ–™
   ```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A - éœ€è¦å…ˆåŸ·è¡Œ VACUUM

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **DROP TABLE æ˜¯å³æ™‚æ“ä½œ**: ä¸éœ€è¦ VACUUM é…åˆã€‚
- **VACUUM ç”¨é€”ä¸åŒ**: VACUUM æ˜¯æ¸…ç†éæœŸæª”æ¡ˆï¼Œä¸æ˜¯åˆªé™¤è¡¨æ ¼çš„å‰ç½®æ¢ä»¶ã€‚

### C - é€™æ˜¯ Deep Clone æœƒå ±éŒ¯

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **CTAS ä¸æ˜¯ Clone**: `CREATE TABLE ... AS SELECT` æ˜¯ CTASï¼Œä¸æ˜¯ Clone æ“ä½œã€‚
- **Clone èªæ³•ä¸åŒ**: Clone ä½¿ç”¨ `CREATE TABLE ... CLONE source`ã€‚
- **CTAS å»ºç«‹ç¨ç«‹è¡¨æ ¼**: å¯ä»¥æ­£å¸¸åˆªé™¤ã€‚

### D - åªåˆªé™¤ metadata

**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**

- **é€™æ˜¯ External Table çš„è¡Œç‚º**: åªæœ‰ External Table åœ¨ DROP æ™‚åªåˆªé™¤ metadataã€‚
- **æ­¤è¡¨æ˜¯ Managed Table**: æ²’æœ‰ LOCATIONï¼Œæ‰€ä»¥æ˜¯ Managed Tableï¼ŒæœƒåŒæ™‚åˆªé™¤è³‡æ–™ã€‚

---

## ğŸ§  è¨˜æ†¶æ³•

### å£è¨£

**ã€ŒManaged å…¨åˆªï¼ŒExternal ç•™æª”ã€**

### è¡¨æ ¼é¡å‹æ¯”è¼ƒ

| é¡å‹ | å»ºç«‹æ–¹å¼ | DROP TABLE è¡Œç‚º |
|------|----------|----------------|
| **Managed** | ç„¡ LOCATION | **åˆªé™¤ metadata + è³‡æ–™** |
| **External** | æœ‰ LOCATION | åªåˆªé™¤ metadata |

### åˆ¤æ–·æ˜¯å¦ç‚º Managed Table

```sql
-- Managed Table ç¯„ä¾‹
CREATE TABLE t1 AS SELECT ...;
CREATE TABLE t2 (id INT, name STRING);

-- External Table ç¯„ä¾‹
CREATE TABLE t3 LOCATION '/path/to/data' AS SELECT ...;
CREATE TABLE t4 (id INT) LOCATION '/path';
```

### Unity Catalog ä¸­çš„è¡Œç‚º

| æ“ä½œ | Managed Table | External Table |
|------|--------------|----------------|
| DROP TABLE | åˆªé™¤å…¨éƒ¨ | åªåˆª metadata |
| UNDROP | å¯æ¢å¾©ï¼ˆ30å¤©å…§ï¼‰ | å¯æ¢å¾© metadata |
| è³‡æ–™ä½ç½® | ç³»çµ±ç®¡ç† | ä½¿ç”¨è€…æŒ‡å®š |

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶

- [Managed Tables](https://docs.databricks.com/lakehouse/data-objects.html#what-is-a-managed-table)
- [External Tables](https://docs.databricks.com/lakehouse/data-objects.html#what-is-an-external-table)
- [DROP TABLE](https://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-drop-table.html)

---

**[è¿”å›é¡Œç›®](#question-019)**
