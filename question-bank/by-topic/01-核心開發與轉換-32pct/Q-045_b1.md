# Question #045

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-045`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
A data engineering team is tasked with anonymizing sensitive customer data in their ETL pipeline. They need to generate a SHA-2 hash for a column holding customer credit card numbers. The team is aware that Spark's sha2 function supports certain bit lengths but not all arbitrary numbers.

Which of the following SHA-2 function calls would fail due to an invalid bit length?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** sha2(credit_card, 256)
- **B.** sha2(credit_card, 128)
- **C.** sha2(credit_card, 512)
- **D.** sha2(credit_card, 0)

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `PySpark`, `Spark-SQL`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Number-Trap`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Data Transformation

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `B`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** B
- **ç¤¾ç¾¤å…±è­˜:** B

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Spark `sha2()` å‡½æ•¸
**é—œéµæ¦‚å¿µ:** SHA-2 é›œæ¹Šæ¼”ç®—æ³•ã€ä½å…ƒé•·åº¦é™åˆ¶
**é¡Œç›®é—œéµå­—ï¼š**
- **sha2()**: Spark å…§å»ºçš„ SHA-2 é›œæ¹Šå‡½æ•¸
- **bit length**: SHA-2 æ”¯æ´çš„è¼¸å‡ºä½å…ƒé•·åº¦
- **anonymizing**: è³‡æ–™åŒ¿ååŒ–ï¼Œå¸¸ç”¨é›œæ¹Šè™•ç†

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ B æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

Spark çš„ `sha2()` å‡½æ•¸åªæ”¯æ´ç‰¹å®šçš„ SHA-2 ä½å…ƒé•·åº¦ï¼š

#### æ”¯æ´çš„ä½å…ƒé•·åº¦
| ä½å…ƒé•·åº¦ | èªªæ˜ | è¼¸å‡ºå­—å…ƒæ•¸ |
|---------|------|-----------|
| **0** | ç­‰åŒæ–¼ 256 | 64 |
| **224** | SHA-224 | 56 |
| **256** | SHA-256ï¼ˆæœ€å¸¸ç”¨ï¼‰| 64 |
| **384** | SHA-384 | 96 |
| **512** | SHA-512 | 128 |

#### ä¸æ”¯æ´çš„ä½å…ƒé•·åº¦
- **128** - é€™æ˜¯ **MD5** çš„é•·åº¦ï¼Œä¸æ˜¯ SHA-2
- å…¶ä»–ä»»æ„æ•¸å­—

#### ç¨‹å¼ç¢¼ç¤ºç¯„
```python
from pyspark.sql.functions import sha2

# âœ… æ­£ç¢ºç”¨æ³•
df.withColumn("hash_256", sha2("credit_card", 256))
df.withColumn("hash_512", sha2("credit_card", 512))
df.withColumn("hash_0", sha2("credit_card", 0))  # ç­‰åŒæ–¼ 256

# âŒ æœƒå¤±æ•—
df.withColumn("hash_128", sha2("credit_card", 128))
# Error: java.lang.IllegalArgumentException:
# The second argument of sha2 must be 0, 224, 256, 384 or 512
```

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A. sha2(credit_card, 256)
**ç‚ºä»€éº¼æ­£ç¢ºï¼ˆä¸æœƒå¤±æ•—ï¼‰ï¼Ÿ**
- 256 æ˜¯ SHA-2 æœ€å¸¸ç”¨çš„ä½å…ƒé•·åº¦ï¼ˆSHA-256ï¼‰
- å®Œå…¨æ”¯æ´

### C. sha2(credit_card, 512)
**ç‚ºä»€éº¼æ­£ç¢ºï¼ˆä¸æœƒå¤±æ•—ï¼‰ï¼Ÿ**
- 512 æ˜¯ SHA-512 çš„ä½å…ƒé•·åº¦
- å®Œå…¨æ”¯æ´

### D. sha2(credit_card, 0)
**ç‚ºä»€éº¼æ­£ç¢ºï¼ˆä¸æœƒå¤±æ•—ï¼‰ï¼Ÿ**
- 0 æ˜¯ç‰¹æ®Šå€¼ï¼Œ**ç­‰åŒæ–¼ 256**
- é€™æ˜¯ Spark çš„è¨­è¨ˆé¸æ“‡ï¼Œæ–¹ä¾¿ä½¿ç”¨é è¨­å€¼

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€ŒSHA-2 å››é•·åº¦ï¼š224, 256, 384, 512ï¼›0 ç•¶é è¨­ç”¨ã€**

### SHA å®¶æ—æ¯”è¼ƒ
| æ¼”ç®—æ³• | å‡½æ•¸ | ä½å…ƒé•·åº¦ | è¼¸å‡ºå­—å…ƒæ•¸ |
|--------|------|---------|-----------|
| MD5 | `md5()` | 128 | 32 |
| SHA-1 | `sha1()` | 160 | 40 |
| SHA-2 | `sha2()` | 224/256/384/512 | 56/64/96/128 |

### å¸¸è¦‹é™·é˜±
| é™·é˜± | èªªæ˜ |
|------|------|
| **128 ä½å…ƒ** | æ˜¯ MD5 çš„é•·åº¦ï¼Œä¸æ˜¯ SHA-2 |
| **160 ä½å…ƒ** | æ˜¯ SHA-1 çš„é•·åº¦ï¼Œä¸æ˜¯ SHA-2 |
| **ä½¿ç”¨ sha2() ä½†å‚³ 128** | æœƒå ±éŒ¯ |

### Spark é›œæ¹Šå‡½æ•¸é¸æ“‡æŒ‡å—
```python
# å¿«é€Ÿé›œæ¹Šï¼ˆå®‰å…¨æ€§è¼ƒä½ï¼‰
df.withColumn("hash", md5("col"))        # 32 å­—å…ƒ

# å®‰å…¨é›œæ¹Šï¼ˆæ¨è–¦ç”¨æ–¼æ•æ„Ÿè³‡æ–™ï¼‰
df.withColumn("hash", sha2("col", 256))  # 64 å­—å…ƒ

# æœ€é«˜å®‰å…¨æ€§
df.withColumn("hash", sha2("col", 512))  # 128 å­—å…ƒ
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [sha2 function - Databricks SQL](https://docs.databricks.com/en/sql/language-manual/functions/sha2.html)
- [Spark SQL Built-in Functions](https://spark.apache.org/docs/latest/api/sql/index.html#sha2)

---

**[è¿”å›é¡Œç›®](#question-045)**
