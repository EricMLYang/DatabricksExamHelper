# Question #054

---

## é¡Œç›®è³‡è¨Š
### é¡Œç›®ç·¨è™Ÿ
**ID:** `Q-054`
### ä¾†æº
**ä¾†æº:** Community
### é›£åº¦ç­‰ç´š
**é›£åº¦:** `L1-Basic`

---

## é¡Œç›®å…§å®¹
### é¡Œå¹¹
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
A data engineering team wants to ensure that a specific Python library is available every time a cluster starts.

Which approach best achieves this goal?

### é¸é …
<!-- âš ï¸ ä¿æŒè‹±æ–‡åŸæ–‡ï¼Œä¸è¦ç¿»è­¯ -->
- **A.** Install the library when running a Python notebook
- **B.** Use an init script to install the library during cluster startup
- **C.** Manually install the library on the driver node each time the cluster starts
- **D.** Use Databricks CLI to upload the library files to the cluster after startup

---

## æ¨™ç±¤ç³»çµ±
### Topic Tags (æŠ€è¡“ä¸»é¡Œæ¨™ç±¤)
**Topics:** `Cluster-Management`, `Databricks-CLI`
### Trap Tags (é™·é˜±é¡å‹æ¨™ç±¤)
**Traps:** `Execution-Behavior`
### Knowledge Domain (çŸ¥è­˜é ˜åŸŸ)
**Domain:** Data Engineering / Operations

---

## ç­”æ¡ˆèˆ‡ä¾†æº
### æ­£ç¢ºç­”æ¡ˆ
**æ­£è§£:** `B`
### ç­”æ¡ˆä¾†æº
- **ä¾†æºæ¨™è¨»ç­”æ¡ˆ:** B
- **ç¤¾ç¾¤å…±è­˜:** B

---

# é¡Œç›®è§£æ

---

## ğŸ“ è€ƒé»è­˜åˆ¥
**æ ¸å¿ƒæŠ€è¡“:** Cluster Init Scripts / å¢é›†åˆå§‹åŒ–è…³æœ¬
**é—œéµæ¦‚å¿µ:** å¢é›†å•Ÿå‹•è‡ªå‹•åŒ–ã€ç¨‹å¼åº«å®‰è£ã€å¯é‡è¤‡æ€§é…ç½®
**é¡Œç›®é—œéµå­—ï¼š**
- **every time a cluster starts**: æ¯æ¬¡å¢é›†å•Ÿå‹•
- **ensure**: ç¢ºä¿ä¸€è‡´æ€§
- **specific Python library**: ç‰¹å®šç¨‹å¼åº«

---

## âœ… æ­£è§£èªªæ˜
### ç‚ºä»€éº¼ B æ˜¯æ­£ç¢ºç­”æ¡ˆï¼Ÿ

**Init Scripts** åœ¨å¢é›†å•Ÿå‹•æ™‚è‡ªå‹•åŸ·è¡Œï¼Œç¢ºä¿ç¨‹å¼åº«åœ¨ä»»ä½•å·¥ä½œè² è¼‰åŸ·è¡Œå‰å°±å·²å®‰è£ã€‚

#### Init Script åŸ·è¡Œæ™‚æ©Ÿ
```
Cluster Lifecycle:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cluster     â”‚
â”‚ Created     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Init Script â”‚ â† åœ¨æ­¤éšæ®µå®‰è£ç¨‹å¼åº«
â”‚ Execution   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cluster     â”‚
â”‚ Ready       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Notebooks/  â”‚ â† ç¨‹å¼åº«å·²å¯ç”¨
â”‚ Jobs Run    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Init Script çš„å„ªé»
| å„ªé» | èªªæ˜ |
|------|------|
| **è‡ªå‹•åŒ–** | æ¯æ¬¡å¢é›†å•Ÿå‹•è‡ªå‹•åŸ·è¡Œ |
| **ä¸€è‡´æ€§** | æ‰€æœ‰ç¯€é»ï¼ˆDriver + Workersï¼‰éƒ½æœƒåŸ·è¡Œ |
| **å¯é‡è¤‡æ€§** | ä¸éœ€æ‰‹å‹•ä»‹å…¥ |
| **æ—©æœŸåŸ·è¡Œ** | åœ¨ä»»ä½•å·¥ä½œè² è¼‰ä¹‹å‰å®Œæˆ |

#### Init Script ç¯„ä¾‹
```bash
#!/bin/bash
# init_script.sh

# å®‰è£ Python ç¨‹å¼åº«
pip install pandas==2.0.0
pip install scikit-learn==1.3.0

# å®‰è£ç³»çµ±å¥—ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
apt-get update && apt-get install -y libssl-dev

echo "Library installation completed"
```

#### Init Script è¨­å®šæ–¹å¼
```
è¨­å®šä½ç½®ï¼š
â”œâ”€â”€ Cluster è¨­å®šé é¢ â†’ Advanced Options â†’ Init Scripts
â”œâ”€â”€ æ”¯æ´çš„å„²å­˜ä½ç½®ï¼š
â”‚   â”œâ”€â”€ Workspace Files
â”‚   â”œâ”€â”€ Unity Catalog Volumes
â”‚   â”œâ”€â”€ Cloud Storage (S3, ADLS, GCS)
â”‚   â””â”€â”€ DBFS (å³å°‡æ£„ç”¨)
```

#### Init Script é¡å‹
| é¡å‹ | ç¯„åœ | é©ç”¨å ´æ™¯ |
|------|------|----------|
| **Cluster-scoped** | å–®ä¸€å¢é›† | ç‰¹å®šå¢é›†éœ€æ±‚ |
| **Global** | æ‰€æœ‰å¢é›† | çµ„ç¹”ç´šæ¨™æº–é…ç½® |

---

## âŒ éŒ¯èª¤é¸é …æ’é™¤

### A. Install the library when running a Python notebook
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **åŸ·è¡Œæ™‚æ©Ÿå¤ªæ™š**: æ¯æ¬¡åŸ·è¡Œ notebook æ‰å®‰è£
- **ä¸ä¸€è‡´**: ä¸åŒ notebook å¯èƒ½å¿˜è¨˜å®‰è£
- **é‡è¤‡å·¥ä½œ**: æ¯æ¬¡åŸ·è¡Œéƒ½è¦ç­‰å¾…å®‰è£
- **éè‡ªå‹•åŒ–**: ä¾è³´äººå·¥è¨˜å¾—åŸ·è¡Œ

```python
# åœ¨ notebook ä¸­å®‰è£ - ä¸æ˜¯æœ€ä½³åšæ³•
%pip install pandas  # æ¯æ¬¡éƒ½è¦åŸ·è¡Œï¼Œå®¹æ˜“éºæ¼
```

### C. Manually install the library on the driver node each time the cluster starts
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **å®Œå…¨æ‰‹å‹•**: éœ€è¦äººå·¥ä»‹å…¥
- **å®¹æ˜“éºæ¼**: äººç‚ºç–å¤±é¢¨éšªé«˜
- **åªè£ Driver**: Workers ç¯€é»å¯èƒ½æ²’å®‰è£
- **ä¸å¯æ“´å±•**: å¢é›†æ•¸é‡å¤šæ™‚ç„¡æ³•ç®¡ç†

### D. Use Databricks CLI to upload the library files to the cluster after startup
**ç‚ºä»€éº¼éŒ¯èª¤ï¼Ÿ**
- **å•Ÿå‹•å¾Œæ‰åŸ·è¡Œ**: ä¸æ˜¯å•Ÿå‹•æ™‚è‡ªå‹•å®‰è£
- **éœ€è¦å¤–éƒ¨è§¸ç™¼**: ä¾è³´å¤–éƒ¨è…³æœ¬æˆ–äººå·¥æ“ä½œ
- **æ™‚æ©Ÿå•é¡Œ**: Jobs å¯èƒ½åœ¨ç¨‹å¼åº«å®‰è£å‰å°±é–‹å§‹åŸ·è¡Œ
- **ä¸é©åˆè‡ªå‹•åŒ–**: éœ€è¦é¡å¤–çš„å”èª¿æ©Ÿåˆ¶

---

## ğŸ§  è¨˜æ†¶æ³•
### å£è¨£
**ã€ŒInit Script å•Ÿå‹•è£ï¼Œè‡ªå‹•ä¸€è‡´ä¸æœƒå¿˜ã€**

### ç¨‹å¼åº«å®‰è£æ–¹å¼æ¯”è¼ƒ
| æ–¹å¼ | æ™‚æ©Ÿ | è‡ªå‹•åŒ– | ä¸€è‡´æ€§ | æ¨è–¦ç¨‹åº¦ |
|------|------|--------|--------|----------|
| **Init Script** | å¢é›†å•Ÿå‹• | âœ… | âœ… | â­â­â­ |
| Cluster Libraries | å¢é›†å•Ÿå‹• | âœ… | âœ… | â­â­â­ |
| %pip install | Notebook åŸ·è¡Œ | âŒ | âŒ | â­ |
| æ‰‹å‹•å®‰è£ | äººå·¥æ“ä½œ | âŒ | âŒ | âŒ |

### Init Script vs Cluster Libraries
```
ä½•æ™‚ç”¨ Init Scriptï¼š
â”œâ”€â”€ éœ€è¦å®‰è£ç³»çµ±å¥—ä»¶ (apt-get)
â”œâ”€â”€ éœ€è¦åŸ·è¡Œè‡ªè¨‚ shell å‘½ä»¤
â”œâ”€â”€ éœ€è¦è¨­å®šç’°å¢ƒè®Šæ•¸
â””â”€â”€ éœ€è¦è¤‡é›œçš„å®‰è£é‚è¼¯

ä½•æ™‚ç”¨ Cluster Librariesï¼š
â”œâ”€â”€ åªéœ€å®‰è£ Python/Scala/R å¥—ä»¶
â”œâ”€â”€ ä½¿ç”¨ PyPIã€Mavenã€CRAN å¥—ä»¶
â””â”€â”€ ä¸éœ€è¦é¡å¤–çš„ç³»çµ±é…ç½®
```

### Init Script æœ€ä½³å¯¦è¸
```
æœ€ä½³å¯¦è¸ï¼š
â”œâ”€â”€ å°‡è…³æœ¬å­˜æ”¾åœ¨ç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰
â”œâ”€â”€ ä½¿ç”¨ Unity Catalog Volumes å„²å­˜
â”œâ”€â”€ åŠ å…¥éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„
â”œâ”€â”€ æ¸¬è©¦è…³æœ¬åœ¨æ–°å¢é›†ä¸Šçš„åŸ·è¡Œ
â””â”€â”€ é¿å…åœ¨è…³æœ¬ä¸­ç¡¬ç·¨ç¢¼æ•æ„Ÿè³‡è¨Š
```

---

## ğŸ“š å®˜æ–¹æ–‡ä»¶
- [Cluster Init Scripts](https://docs.databricks.com/clusters/init-scripts.html)
- [Install Libraries on Clusters](https://docs.databricks.com/libraries/cluster-libraries.html)
- [Best Practices for Init Scripts](https://docs.databricks.com/clusters/init-scripts.html#best-practices)

---

**[è¿”å›é¡Œç›®](#question-054)**
